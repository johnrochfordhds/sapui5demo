// Copyright (c) 2009-2014 SAP SE, All Rights Reserved
(function(){"use strict";jQuery.sap.declare("sap.ovp.cards.AnnotationHelper");sap.ovp.cards.AnnotationHelper={};sap.ovp.cards.AnnotationHelper.formatFunctions={count:0};sap.ovp.cards.AnnotationHelper.NumberFormatFunctions={};sap.ovp.cards.AnnotationHelper.criticalityConstants={StateValues:{None:"None",Negative:"Error",Critical:"Warning",Positive:"Success"},ColorValues:{None:"Neutral",Negative:"Error",Critical:"Critical",Positive:"Good"}};function g(i,k){if(i.getSetting){var a=i.getSetting("_ovpCache");return a[k];}return undefined;}function s(i,k,V){if(i.getSetting){var a=i.getSetting("_ovpCache");a[k]=V;}}function c(a,b){var S=b.None;if(a&&a.EnumMember){var i=a.EnumMember;if(e(i,'Negative')){S=b.Negative;}else if(e(i,'Critical')){S=b.Critical;}else if(e(i,'Positive')){S=b.Positive;}}return S;}function e(S,a){return S&&S.indexOf(a,S.length-a.length)!==-1;}function d(a,b){return function(i){i=Number(i);var j=a.ImprovementDirection.EnumMember;var k={};var S=I(a.DeviationRangeLowValue);var T=I(a.DeviationRangeHighValue);var U=I(a.ToleranceRangeLowValue);var V=I(a.ToleranceRangeHighValue);if(e(j,"Minimize")||e(j,"Minimizing")){if(i<=V){k.EnumMember="Positive";}else if(i>T){k.EnumMember="Negative";}else{k.EnumMember="Critical";}}else if(e(j,"Maximize")||e(j,"Maximizing")){if(i>=U){k.EnumMember="Positive";}else if(i<S){k.EnumMember="Negative";}else{k.EnumMember="Critical";}}else if(e(j,"Target")){if(i>=U&&i<=V){k.EnumMember="Positive";}else if(i<S||i>T){k.EnumMember="Negative";}else{k.EnumMember="Critical";}}return c(k,b);};}function f(i,a){var b=i.getPath()+"-DataFields-Sorted";var S=g(i,b);if(!S){var j=h(i,a);var k=j.map(function(T){return T.Value.Path;});k=k.filter(function(T){return!!T;});S=a.filter(function(T){if(T.RecordType==="com.sap.vocabularies.UI.v1.DataField"&&k.indexOf(T.Value.Path)===-1){return true;}return false;});o(S);s(i,b,S);}return S;}function h(a,b){var j=a.getPath()+"-DataPoints-Sorted";var S=g(a,j);if(!S){S=b.filter(l);o(S);var k;for(var i=0;i<S.length;i++){k=a.getPath().substr(0,a.getPath().lastIndexOf("/")+1);S[i]=a.getModel().getProperty(m(k,S[i]));k="";}s(a,j,S);}return S;}function l(i){if(i.RecordType==="com.sap.vocabularies.UI.v1.DataFieldForAnnotation"&&i.Target.AnnotationPath.match(/@com.sap.vocabularies.UI.v1.DataPoint.*/)){return true;}return false;}function m(a,b){if(a&&!e(a,'/')){a+='/';}return a+b.Target.AnnotationPath.slice(1);}function n(a){var i;if(a["com.sap.vocabularies.UI.v1.Importance"]){i=a["com.sap.vocabularies.UI.v1.Importance"].EnumMember;}return i;}function o(i){i.sort(function(a,b){var j=n(a),k=n(b);if(j===k){return 0;}if(j==="com.sap.vocabularies.UI.v1.ImportanceType/High"){return-1;}else if(k==="com.sap.vocabularies.UI.v1.ImportanceType/High"){return 1;}else if(j==="com.sap.vocabularies.UI.v1.ImportanceType/Medium"){return-1;}else if(k==="com.sap.vocabularies.UI.v1.ImportanceType/Medium"){return 1;}else if(j==="com.sap.vocabularies.UI.v1.ImportanceType/Low"){return-1;}else if(k==="com.sap.vocabularies.UI.v1.ImportanceType/Low"){return 1;}return-1;});return i;}function p(i,a,b){var j=f(i,a)[b];if(j){return u(i,j);}return"";}function q(i,a,b){var j=f(i,a)[b];if(j){return j.Label.String;}return"";}function r(i,a,b){var j=h(i,a)[b];if(j&&j.Title){return j.Title.String;}return"";}function t(i,a,b){var j=h(i,a)[b];if(!j){return"";}var k=i.getSetting('ovpCardProperties');var S=k.getProperty("/entityType");var T=k.getProperty("/metaModel");return _(i,j,S,T);}function _(i,a,b,j){if(!a||!a.Value){return"";}var k=j.getODataProperty(b,a.Value.Path);if(k&&k["sap:text"]){k=j.getODataProperty(b,k["sap:text"]);a={Value:{Path:k.name}};}return u(i,a);}function u(i,a,b,j){if(a.Value.Apply){return sap.ui.model.odata.AnnotationHelper.format(i,a.Value);}var k=i.getSetting('ovpCardProperties');var S=k.getProperty("/entityType");var T=k.getProperty("/metaModel");return v(i,a,S,T,b,j);}function v(i,a,b,j,k,S){if(a.Value.Apply){return sap.ui.model.odata.AnnotationHelper.format(i,a.Value);}var T=j.getODataProperty(b,a.Value.Path);var U="";var V;if(!S){if(a.Value.Path.split("/").length>1){T=y(j,b,a.Value.Path);}if(!T){return"";}if(a.ValueFormat&&a.ValueFormat.NumberOfFractionalDigits){V=w(a.ValueFormat.NumberOfFractionalDigits.Int);U="{path:'"+a.Value.Path+"', formatter: '"+V+"'}";}else if(T["scale"]){V=w(T["scale"]);U="{path:'"+T.name+"', formatter: '"+V+"'}";}else{U=sap.ui.model.odata.AnnotationHelper.format(i,a.Value);}}if(!k){if(T["Org.OData.Measures.V1.ISOCurrency"]){var W=T["Org.OData.Measures.V1.ISOCurrency"];if(W.Path){U=U+" {path: '"+W.Path+"'}";}else if(W.String){U=U+" "+W.String;}}if(T["Org.OData.Measures.V1.Unit"]){var X=T["Org.OData.Measures.V1.Unit"];if(X.Path){U=U+" {path: '"+X.Path+"'}";}else if(X.String){U=U+" "+X.String;}}}if(U[0]===" "){U=U.substring(1);}return U;}function w(a){var b="formatNumberCalculation"+a;if(!sap.ovp.cards.AnnotationHelper.NumberFormatFunctions[b]){sap.ovp.cards.AnnotationHelper.NumberFormatFunctions[b]=x(Number(a));}return"sap.ovp.cards.AnnotationHelper.NumberFormatFunctions."+b;}function x(a){return function(b){jQuery.sap.require("sap.ui.core.format.NumberFormat");var i=sap.ui.core.format.NumberFormat.getFloatInstance({style:'short',showMeasure:false,minFractionDigits:a,maxFractionDigits:a});return i.format(Number(b));};}function y(a,b,j){var k=j.split("/");if(k.length>1){for(var i=0;i<(k.length-1);i++){var S=a.getODataAssociationEnd(b,k[i]);if(S){b=a.getODataEntityType(S.type);}}return a.getODataProperty(b,k[k.length-1]);}}function z(i,a,b){var j=h(i,a);var S="None";if(j.length>b){var k=j[b];S=A(i,k,sap.ovp.cards.AnnotationHelper.criticalityConstants.StateValues);}return S;}function A(i,a,b){var S=b.None;if(a.Criticality){S=c(a.Criticality,b);}else if(a.CriticalityCalculation){var j=sap.ui.model.odata.AnnotationHelper.format(i,a.Value);var k=j.match(/path *: *'.*?',/g);if(k){var T=d(a.CriticalityCalculation,b);sap.ovp.cards.AnnotationHelper.formatFunctions.count++;var U="formatCriticalityCalculation"+sap.ovp.cards.AnnotationHelper.formatFunctions.count;sap.ovp.cards.AnnotationHelper.formatFunctions[U]=T;S="{"+k+" formatter: 'sap.ovp.cards.AnnotationHelper.formatFunctions."+U+"'}";}}return S;}function B(a,b,j){var k="";var S=j.split("/");if(S.length>1){for(var i=0;i<(S.length-1);i++){var T=a.getODataAssociationEnd(b,S[i]);if(T){b=a.getODataEntityType(T.type);if(k){k=k+"/";}k=k+S[i];}else{return k;}}}return k;}sap.ovp.cards.AnnotationHelper.formatField=function(i,a){return u(i,a);};sap.ovp.cards.AnnotationHelper.formatItems=function(i,a){var b=i.getSetting('ovpCardProperties');var j=b.getProperty("/addODataSelect");var k=b.getProperty("/metaModel");var S=k.getODataEntityType(a.entityType);var T=S[b.getProperty('/selectionAnnotationPath')];var U=S[b.getProperty('/presentationAnnotationPath')];var V="/"+a.name;var W=Array.prototype.slice.call(arguments,2);if(T){if(T&&T.Parameters){V=sap.ovp.cards.AnnotationHelper.resolveParameterizedEntitySet(i.getSetting('dataModel'),a,T);}}var X="{path: '"+V+"', length: "+L(b);var Y=[];if(j){Y=D(i,k,S,W);}var Z=C(k,S,W);if(Y.length>0||Z.length>0){X=X+", parameters: {";if(Y.length>0){X=X+"select: '"+Y.join(',')+"'";}if(Z.length>0){if(Y.length>0){X=X+", ";}X=X+"expand: '"+Z.join(',')+"'";}X=X+"}";}var $=F(b,U);if($.length>0){X=X+", sorter:"+JSON.stringify($);}var a1=G(b,T);if(a1.length>0){X=X+", filters:"+JSON.stringify(a1);}X=X+"}";return X;};function C(a,b,k){var S=[];var T,U,V,W;for(var i=0;i<k.length;i++){if(!k[i]){continue;}T=b.$path+"/"+k[i];U=a.createBindingContext(T);V=U.getObject();V=V?V:[];for(var j=0;j<V.length;j++){if(V[j].Value&&V[j].Value.Path){W=B(a,b,V[j].Value.Path);if(W&&S.indexOf(W)===-1){S.push(W);}}}}return S;}function D(a,b,S,T){var U=[];var V,W,X;for(var i=0;i<T.length;i++){if(!T[i]){continue;}V=S.$path+"/"+T[i];W=b.createBindingContext(V);X=W.getObject();X=X?X:[];var Y;var Z;var $;var a1;for(var j=0;j<X.length;j++){Z=[];Y=X[j];$="";a1=Y.RecordType;if(a1==="com.sap.vocabularies.UI.v1.DataField"){$=v(a,Y,S,b);}else if(a1==="com.sap.vocabularies.UI.v1.DataFieldForAnnotation"){var b1=m(S.$path,Y);$=_(a,b.getProperty(b1),S,b);}else if(a1==="com.sap.vocabularies.UI.v1.DataFieldWithUrl"&&Y.Url){var c1;if(!Y.Url.UrlRef){c1=sap.ui.model.odata.AnnotationHelper.format(a,Y.Url);}if(c1&&c1.substring(0,2)==="{="){$=c1;}}if($){Z=E($);}if(Z&&Z.length>0){var d1;for(var k=0;k<Z.length;k++){d1=Z[k];if(!U[d1]){U[d1]=true;var e1=O(d1,S);if(e1&&e1!==d1){U[e1]=true;}var f1=Q(b,S,d1);if(f1&&f1!==d1){U[f1]=true;}}}}}}return Object.keys(U);}function E(b){var a=/\${([a-zA-Z0-9|\/]*)/g;var i=/[^[{]*[a-zA-Z0-9]/g;var j=/path *\: *\'([a-zA-Z0-9]+)*\'/g;var k,S,T=[];if(b.substring(0,2)==="{="){k=a;S=1;}else if(b.indexOf("path")!==-1){var U=i.exec(b);while(U){if(U[0].indexOf("path")===-1){T.push(U[0]);}U=i.exec(b);}k=j;S=1;}else{k=i;S=0;}var V=k.exec(b);while(V){if(V[S]){T.push(V[S]);}V=k.exec(b);}return T;}function F(a,b){var S=[];var j,k;var T=a.getProperty("/sortBy");if(T){var U=a.getProperty('/sortOrder');if(U&&U.toLowerCase()!=='descending'){k=false;}else{k=true;}j={path:T,descending:k};S.push(j);}var V=b&&b.SortOrder||undefined;var W,T;if(V){for(var i=0;i<V.length;i++){W=V[i];T=W.Property.PropertyPath;k=H(W.Descending,true);j={path:T,descending:k};S.push(j);}}return S;}sap.ovp.cards.AnnotationHelper.getCardFilters=function(a){var b=a.getProperty('/entityType');var S=b[a.getProperty('/selectionAnnotationPath')];return G(a,S);};function G(a,S){var b=[];var k=a.getProperty("/filters");if(k){b=b.concat(k);}var T=S&&S.SelectOptions;var U,V,W;if(T){for(var i=0;i<T.length;i++){U=T[i];V=U.PropertyName.PropertyPath;for(var j=0;j<U.Ranges.length;j++){W=U.Ranges[j];if(W.Sign.EnumMember==="com.sap.vocabularies.UI.v1.SelectionRangeSignType/I"){var X={path:V,operator:W.Option.EnumMember.split("/")[1],value1:J(W.Low),value2:J(W.High)};b.push(X);}}}}return b;}function H(V,b){if(V&&V.Boolean){if(V.Boolean.toLowerCase()==="true"){return true;}else if(V.Boolean.toLowerCase()==="false"){return false;}}return b;}function I(V){var a;if(V){if(V.String){a=Number(V.String);}else if(V.Int){a=Number(V.Int);}else if(V.Decimal){a=Number(V.Decimal);}else if(V.Double){a=Number(V.Double);}else if(V.Single){a=Number(V.Single);}}return a;}function J(V){var a;if(V){if(V.String){a=V.String;}else if(V.Boolean){a=H(V);}else{a=I(V);}}return a;}var K={"List_condensed":{phone:5,tablet:5,desktop:5},"List_extended":{phone:3,tablet:3,desktop:3},"List_condensed_bar":{phone:5,tablet:5,desktop:5},"List_extended_bar":{phone:3,tablet:3,desktop:3},"Table":{phone:5,tablet:5,desktop:5},"Stack_simple":{phone:20,tablet:20,desktop:20},"Stack_complex":{phone:5,tablet:5,desktop:5}};function L(a){var b=a.getProperty('/contentFragment');var i=a.getProperty('/listType');var j=a.getProperty('/listFlavor');var k;var S="desktop";if(sap.ui.Device.system.phone){S="phone";}else if(sap.ui.Device.system.tablet){S="tablet";}if(b=="sap.ovp.cards.list.List"){if(i=="extended"){if(j=="bar"){k=K["List_extended_bar"];}else{k=K["List_extended"];}}else if(j=="bar"){k=K["List_condensed_bar"];}else{k=K["List_condensed"];}}else if(b=="sap.ovp.cards.table.Table"){k=K["Table"];}else if(b=="sap.ovp.cards.stack.Stack"){if(a.getProperty('/objectStreamCardsNavigationProperty')){k=K["Stack_complex"];}else{k=K["Stack_simple"];}}if(k){return k[S];}return 5;}sap.ovp.cards.AnnotationHelper.formatUrl=function(i,U){if(U.charAt(0)==='/'||U.indexOf("http")===0){return U;}var b=i.getModel().getProperty("/baseUrl");if(b){return b+"/"+U;}return U;};sap.ovp.cards.AnnotationHelper.getDataPointsCount=function(i,a){var b=h(i,a);return b.length;};sap.ovp.cards.AnnotationHelper.getFirstDataPointValue=function(i,a){return sap.ovp.cards.AnnotationHelper.getDataPointValue(i,a,0);};sap.ovp.cards.AnnotationHelper.getSecondDataPointValue=function(i,a){return sap.ovp.cards.AnnotationHelper.getDataPointValue(i,a,1);};sap.ovp.cards.AnnotationHelper.getDataPointValue=function(i,a,b){var j=h(i,a),k=j[b];if(k&&k.Value&&k.Value.Path){return k.Value.Path;}return"";};sap.ovp.cards.AnnotationHelper.getFirstDataFieldName=function(i,a){return q(i,a,0);};sap.ovp.cards.AnnotationHelper.getSecondDataFieldName=function(i,a){return q(i,a,1);};sap.ovp.cards.AnnotationHelper.getThirdDataFieldName=function(i,a){return q(i,a,2);};sap.ovp.cards.AnnotationHelper.formatFirstDataFieldValue=function(i,a){return p(i,a,0);};sap.ovp.cards.AnnotationHelper.formatSecondDataFieldValue=function(i,a){return p(i,a,1);};sap.ovp.cards.AnnotationHelper.formatThirdDataFieldValue=function(i,a){return p(i,a,2);};sap.ovp.cards.AnnotationHelper.formatFourthDataFieldValue=function(i,a){return p(i,a,3);};sap.ovp.cards.AnnotationHelper.formatFifthDataFieldValue=function(i,a){return p(i,a,4);};sap.ovp.cards.AnnotationHelper.formatSixthDataFieldValue=function(i,a){return p(i,a,5);};sap.ovp.cards.AnnotationHelper.getFirstDataPointName=function(i,a){return r(i,a,0);};sap.ovp.cards.AnnotationHelper.getSecondDataPointName=function(i,a){return r(i,a,1);};sap.ovp.cards.AnnotationHelper.getThirdDataPointName=function(i,a){return r(i,a,2);};sap.ovp.cards.AnnotationHelper.formatFirstDataPointValue=function(i,a){return t(i,a,0);};sap.ovp.cards.AnnotationHelper.formatSecondDataPointValue=function(i,a){return t(i,a,1);};sap.ovp.cards.AnnotationHelper.formatThirdDataPointValue=function(i,a){return t(i,a,2);};sap.ovp.cards.AnnotationHelper.formatFirstDataPointState=function(i,a){return z(i,a,0);};sap.ovp.cards.AnnotationHelper.formatSecondDataPointState=function(i,a){return z(i,a,1);};sap.ovp.cards.AnnotationHelper.formatThirdDataPointState=function(i,a){return z(i,a,2);};sap.ovp.cards.AnnotationHelper.formatKPIHeaderState=function(i,a){return A(i,a,sap.ovp.cards.AnnotationHelper.criticalityConstants.ColorValues);};sap.ovp.cards.AnnotationHelper.hasActions=function(a,b){var j;for(var i=0;i<b.length;i++){j=b[i];if(j.RecordType==="com.sap.vocabularies.UI.v1.DataFieldForIntentBasedNavigation"||j.RecordType==="com.sap.vocabularies.UI.v1.DataFieldForAction"||j.RecordType==="com.sap.vocabularies.UI.v1.DataFieldWithUrl"){return 1;}}return 0;};sap.ovp.cards.AnnotationHelper.isFirstDataPointPercentageUnit=function(i,a){var b=h(i,a)[0];if(b&&b.Value&&b.Value.Path){var j=i.getPath().substr(0,i.getPath().lastIndexOf("/")+1);var k=i.getModel();var S=k.getProperty(j);var T=k.getODataProperty(S,b.Value.Path);if(T&&T["Org.OData.Measures.V1.Unit"]){return T["Org.OData.Measures.V1.Unit"].String==="%";}}return false;};sap.ovp.cards.AnnotationHelper.resolveEntityTypePath=function(a){var b=a.getObject();var i=a.getModel();var j=i.getProperty("/metaModel");var k=j.getODataEntitySet(i.getProperty("/entitySet"));var S=j.getODataEntityType(k.entityType);b=S.$path+"/"+b;return j.createBindingContext(b);};sap.ovp.cards.AnnotationHelper.resolveParameterizedEntitySet=function(a,b,S){jQuery.sap.require("sap.ui.model.analytics.odata4analytics");var i="";var j=new sap.ui.model.analytics.odata4analytics.Model(sap.ui.model.analytics.odata4analytics.Model.ReferenceByModel(a));var k=j.findQueryResultByName(b.name);var T=new sap.ui.model.analytics.odata4analytics.QueryResultRequest(k);var U=k.getParameterization();if(U){T.setParameterizationRequest(new sap.ui.model.analytics.odata4analytics.ParameterizationRequest(U));jQuery.each(S.Parameters,function(){if(this.RecordType==="com.sap.vocabularies.UI.v1.IntervalParameter"){T.getParameterizationRequest().setParameterValue(this.PropertyName.PropertyPath,this.PropertyValueFrom.String,this.PropertyValueTo.String);}else{T.getParameterizationRequest().setParameterValue(this.PropertyName.PropertyPath,this.PropertyValue.String);}});}try{i=T.getURIToQueryResultEntitySet();}catch(V){k=T.getQueryResult();i="/"+k.getEntitySet().getQName();jQuery.sap.log.error("getEntitySetPathWithParameters","binding path with parameters failed - "+V||V.message);}return i;};sap.ovp.cards.AnnotationHelper.getAssociationObject=function(a,b,j){var k=a.getServiceMetadata().dataServices.schema[0].association;for(var i=0;i<k.length;i++){if(j+"."+k[i].name===b){return k[i];}}};sap.ovp.cards.AnnotationHelper.getAggregateNumber=function(i,a,b,S){var j=b.Value.Path;var k="";var T=S&&S.Parameters;var U="";if(T){var V=i.getSetting("dataModel");var W=sap.ovp.cards.AnnotationHelper.resolveParameterizedEntitySet(V,a,S);k+="{path: '"+W+"'";}else{k+="{path: '/"+a.name+"'";}k+=", length: 1";var X=i.getSetting('ovpCardProperties');var Y=X.getProperty("/entityType");var Z=O(j,Y);var $=G(X,S);if($.length>0){U+=", filters: "+JSON.stringify($);}var a1=[];a1.push(j);if(Z){a1.push(Z);}if(b.TrendCalculation&&b.TrendCalculation.ReferenceValue&&b.TrendCalculation.ReferenceValue.Path){a1.push(b.TrendCalculation.ReferenceValue.Path);}return k+", parameters:{select:'"+a1.join(",")+"'}"+U+"}";};sap.ovp.cards.AnnotationHelper.formThePathForAggregateNumber=function(i,a){if(!a||!a.Value||!a.Value.Path){return"";}return u(i,a,true,false);};sap.ovp.cards.AnnotationHelper.formThePathForTrendIcon=function(a){if(!a||!a.Value||!a.Value.Path||!a.TrendCalculation){return"";}if(a.TrendCalculation&&a.TrendCalculation.ReferenceValue&&a.TrendCalculation.ReferenceValue.Path){return"{parts: [{path:'"+a.Value.Path+"'}, {path:'"+a.TrendCalculation.ReferenceValue.Path+"'}], formatter: 'sap.ovp.cards.AnnotationHelper.returnTrendDirection'}";}else{return"{parts: [{path:'"+a.Value.Path+"'}], formatter: 'sap.ovp.cards.AnnotationHelper.returnTrendDirection'}";}};sap.ovp.cards.AnnotationHelper.returnTrendDirection=function(a,b){a=Number(a);var i=this.getModel("ovpCardProperties");if(!i){return;}var j=i.getProperty("/dataPointAnnotationPath");var k=i.getProperty("/entityType")[j];var S,T,U;if(k.TrendCalculation.ReferenceValue){if(k.TrendCalculation.ReferenceValue.Path){S=Number(b);}else{S=I(k.TrendCalculation.ReferenceValue);}}if(k.TrendCalculation.UpDifference){T=I(k.TrendCalculation.UpDifference);}if(k.TrendCalculation.DownDifference){U=I(k.TrendCalculation.DownDifference);}if(!k.TrendCalculation.UpDifference&&(a-S>=0)){return"Up";}if(!k.TrendCalculation.DownDifference&&(a-S<=0)){return"Down";}if(S&&T&&(a-S>=T)){return"Up";}if(S&&U&&(a-S<=U)){return"Down";}};sap.ovp.cards.AnnotationHelper.formThePathForUOM=function(i,a){if(!a||!a.Value||!a.Value.Path){return"";}return u(i,a,false,true);};sap.ovp.cards.AnnotationHelper.formPathForPercentageChange=function(a){if(!a||!a.TrendCalculation||!a.TrendCalculation.ReferenceValue){return"";}if(a.TrendCalculation.ReferenceValue.Path){return"{parts: [{path:'"+a.Value.Path+"'}, {path:'"+a.TrendCalculation.ReferenceValue.Path+"'}], formatter: 'sap.ovp.cards.AnnotationHelper.returnPercentageChange'}";}else{return"{parts: [{path:'"+a.Value.Path+"'}], formatter: 'sap.ovp.cards.AnnotationHelper.returnPercentageChange'}";}};sap.ovp.cards.AnnotationHelper.returnPercentageChange=function(a,b){jQuery.sap.require("sap.ui.core.format.NumberFormat");var i="";a=Number(a);var j=this.getModel("ovpCardProperties");if(!j){return i;}var k=j.getProperty("/dataPointAnnotationPath");var S=j.getProperty("/entityType")[k];var T;if(!S.TrendCalculation){return i;}if(S.TrendCalculation.ReferenceValue){if(S.TrendCalculation.ReferenceValue.String){T=Number(S.TrendCalculation.ReferenceValue.String);}if(S.TrendCalculation.ReferenceValue.Path){T=Number(b);}if(!T||T==0){return i;}var U=((Number(a)-T)/T);var V=sap.ui.core.format.NumberFormat.getPercentInstance({style:'short',minFractionDigits:2,maxFractionDigits:2});return V.format(U);}};sap.ovp.cards.AnnotationHelper.listGroupBy=function(a){var b="";var i=a&&a.GroupBy;if(!i){return b;}var j=this.getModel('ovpCardProperties').getProperty("/metaModel");var k=this.getModel('ovpCardProperties').getProperty("/entityType");var S;if(a.GroupBy.constructor===Array){S=a.GroupBy;}else if(!a.GroupBy.Collection){return b;}else{S=a.GroupBy.Collection;}var T;jQuery.each(S,function(){T=P(j,k,this.PropertyPath);if(!T){return;}b+=T;b+=", ";});if(b[b.length-1]===" "&&b[b.length-2]===","){b=b.substring(0,b.length-2);}return b==""?"":sap.ui.getCore().getLibraryResourceBundle("sap.ovp").getText("By",[b]);};sap.ovp.cards.AnnotationHelper.formTheFilterByString=function(a,S){var b=a.getSetting('ovpCardProperties');var k=b.getProperty("/entityType");var T=b.getProperty("/metaModel");var U=G(b,S);var V;var W;for(var i=0;i<U.length;i++){V=U[i].path;W=Q(T,k,V);if(W!==V){for(var j=0;j<U.length;j++){if((U[j].path==W)){U.splice(i,1);break;}}}}return M(U);};function M(a){var b=[];for(var i=0;i<a.length;i++){b.push(N(a[i]));}return b.join(', ');}function N(a){var b=false;var i=a.value1;if(a.operator[0]==="N"){b=true;}if(a.value2){i+=" - "+a.value2;}if(b){i=sap.ui.getCore().getLibraryResourceBundle("sap.ovp").getText("kpiHeader_Filter_NotOperator",[i]);}return i;}function O(a,b){var j=b.property;for(var i=0,k=j.length;i<k;i++){if(j[i].name==a){if(j[i].hasOwnProperty("sap:unit")){return j[i]["sap:unit"];}break;}}return null;}function P(a,b,i){return R(a,b,i,"com.sap.vocabularies.Common.v1.Label");}function Q(a,b,i){return R(a,b,i,"sap:text");}function R(a,b,i,j){var k=a.getODataProperty(b,i);if(!k){jQuery.sap.log.error("No Property Found for with Name '"+i+" For Entity-Type '"+b.name+"'");return;}var S=k[j];if(S){if(j==="com.sap.vocabularies.Common.v1.Label"){return S.String;}return S;}return k.name;}sap.ovp.cards.AnnotationHelper._criticality2state=c;sap.ovp.cards.AnnotationHelper._generateCriticalityCalculationStateFunction=d;sap.ovp.cards.AnnotationHelper._getPropertiesFromBindingString=E;sap.ovp.cards.AnnotationHelper.sortCollectionByImportance=o;sap.ovp.cards.AnnotationHelper.formatField.requiresIContext=true;sap.ovp.cards.AnnotationHelper.formThePathForAggregateNumber.requiresIContext=true;sap.ovp.cards.AnnotationHelper.formThePathForUOM.requiresIContext=true;sap.ovp.cards.AnnotationHelper.formTheFilterByString.requiresIContext=true;sap.ovp.cards.AnnotationHelper.getAggregateNumber.requiresIContext=true;sap.ovp.cards.AnnotationHelper.getFirstDataFieldName.requiresIContext=true;sap.ovp.cards.AnnotationHelper.getSecondDataFieldName.requiresIContext=true;sap.ovp.cards.AnnotationHelper.getThirdDataFieldName.requiresIContext=true;sap.ovp.cards.AnnotationHelper.formatFirstDataFieldValue.requiresIContext=true;sap.ovp.cards.AnnotationHelper.formatSecondDataFieldValue.requiresIContext=true;sap.ovp.cards.AnnotationHelper.formatThirdDataFieldValue.requiresIContext=true;sap.ovp.cards.AnnotationHelper.formatFourthDataFieldValue.requiresIContext=true;sap.ovp.cards.AnnotationHelper.formatFifthDataFieldValue.requiresIContext=true;sap.ovp.cards.AnnotationHelper.formatSixthDataFieldValue.requiresIContext=true;sap.ovp.cards.AnnotationHelper.getDataPointsCount.requiresIContext=true;sap.ovp.cards.AnnotationHelper.getFirstDataPointName.requiresIContext=true;sap.ovp.cards.AnnotationHelper.getSecondDataPointName.requiresIContext=true;sap.ovp.cards.AnnotationHelper.getThirdDataPointName.requiresIContext=true;sap.ovp.cards.AnnotationHelper.formatFirstDataPointValue.requiresIContext=true;sap.ovp.cards.AnnotationHelper.formatSecondDataPointValue.requiresIContext=true;sap.ovp.cards.AnnotationHelper.formatThirdDataPointValue.requiresIContext=true;sap.ovp.cards.AnnotationHelper.formatFirstDataPointState.requiresIContext=true;sap.ovp.cards.AnnotationHelper.formatSecondDataPointState.requiresIContext=true;sap.ovp.cards.AnnotationHelper.formatThirdDataPointState.requiresIContext=true;sap.ovp.cards.AnnotationHelper.formatKPIHeaderState.requiresIContext=true;sap.ovp.cards.AnnotationHelper.formatItems.requiresIContext=true;sap.ovp.cards.AnnotationHelper.formatUrl.requiresIContext=true;sap.ovp.cards.AnnotationHelper.hasActions.requiresIContext=true;sap.ovp.cards.AnnotationHelper.getFirstDataPointValue.requiresIContext=true;sap.ovp.cards.AnnotationHelper.getSecondDataPointValue.requiresIContext=true;sap.ovp.cards.AnnotationHelper.isFirstDataPointPercentageUnit.requiresIContext=true;}());
