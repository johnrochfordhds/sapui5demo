/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 */
sap.ui.define(["sap/ui/core/Core","sap/ui/Device","sap/gantt/misc/Format","sap/ui/core/format/DateFormat","sap/gantt/drawer/Drawer","sap/ui/thirdparty/d3"],function(C,D,F,a,b){"use strict";var c=b.extend("sap.gantt.drawer.CursorLine");c.prototype.drawSvg=function(s,S,l,o){this._oLocale=l;var i=jQuery('#'+o.svgId).offset().left;var A=[];s.each(function(d,e){var f=jQuery(this),g=f.offset();A.push({x:o.x+i-g.left,y:o.y,svgId:f.attr("id"),svgHeight:f.height()});});var t=this;S.each(function(d,e){var h=t._createHeaderTopG(d3.select(this));t._drawHeaderLabel(h,A[e]);});s.each(function(d,e){var B=t._createBodyTopG(d3.select(this));t._drawCursorLine(B,A[e]);});};c.prototype._createBodyTopG=function(s){var B=s.selectAll(".cursorline-top").data(function(){return[{svgHeight:jQuery(this.parentNode).height()}];});B.enter().append("g").classed("cursorline-top",true);B.exit().remove();return B;};c.prototype._drawCursorLine=function(g,s){var p=g.selectAll("path").data(function(d){return[{svgHeight:d.svgHeight,x:s.x,y:s.y}];});p.enter().append("path").classed("sapGanttCursorLineBody",true);p.attr("d",function(d){return"M"+d.x+",0v"+d.svgHeight+"h1h-1";});p.exit().remove();};c.prototype._createHeaderTopG=function(s){var h=s.selectAll(".cursorline-header-top").data(function(){return[{svgHeight:jQuery(this.parentNode).height()}];});h.enter().append("g").classed("cursorline-header-top",true);h.exit().remove();return h;};c.prototype._drawHeaderLabel=function(g,s){var t=this;var A=this._getAxisTime(s.svgId);var r=g.selectAll("rect").data(function(d){return[{svgHeight:d.svgHeight,svgId:d.svgId,x:s.x,y:s.y}];});r.enter().append("rect").classed("sapGanttCursorLineHeader",true);r.attr("width",function(d){return 64;}).attr("height",function(d){return d.svgHeight>80?30:25;}).attr("x",function(d){return d.x-parseFloat(r.attr('width'))/2;}).attr("y",function(d){return d.svgHeight-parseFloat(r.attr('height'))-5;});r.exit().remove();var T=g.selectAll("text").data(function(d){return[{x:parseFloat(r.attr('x'))+parseFloat(r.attr('width')/2),y:parseFloat(r.attr('y'))+parseFloat(r.attr('height')/2)}];});T.enter().append("text").classed("sapGanttCursorLineLabel",true);T.attr("x",function(d){return d.x;}).attr("y",function(d){return d.y;}).text(function(d){return t._getTimeLabel(F.dateToAbapTimestamp(A.viewToTime(d.x)),t._oLocale,A);});if(D.browser.msie){T.attr("dy",".35em");}T.exit().remove();};c.prototype.destroySvg=function(s,S){s.selectAll(".cursorline-top").remove();S.selectAll(".cursorline-header-top").remove();};c.prototype._getAxisTime=function(e){var $=jQuery("#"+e);var A=null;if($&&$.control()){A=$.control()[0].getAxisTime();}return A;};c.prototype._getTimeLabel=function(t,l,A){var L=F._convertUTCToLocalTime(t,l);var d=(sap.ui.getCore().getConfiguration().getLanguage()).toLowerCase();var f=a.getDateTimeInstance({pattern:A.getZoomStrategy()[A.getCurrentTickTimeIntervalKey()].smallInterval.format},new sap.ui.core.Locale(d));return f.format(L);};return c;},true);
