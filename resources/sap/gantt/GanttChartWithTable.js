/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 */
sap.ui.define(["sap/gantt/GanttChartBase","sap/ui/table/Column","sap/ui/table/TreeTable","sap/ui/core/ScrollBar","sap/ui/layout/Splitter","sap/ui/layout/SplitterLayoutData","sap/gantt/GanttChart","sap/gantt/control/Cell","sap/gantt/control/Toolbar","sap/gantt/control/AssociateContainer","sap/gantt/drawer/SelectionPanel","./misc/TreeTableHelper","sap/gantt/misc/Utility","sap/gantt/misc/AxisOrdinal","sap/ui/thirdparty/d3"],function(G,C,T,S,a,b,c,d,e,A,f,g,U,h){"use strict";var k=G.extend("sap.gantt.GanttChartWithTable",{metadata:{properties:{cellCallback:{type:"object"},fixedColumnCount:{type:"int"}},aggregations:{customToolbarItems:{type:"sap.ui.core.Control",multiple:true,visibility:"public",singularName:"customToolbarItem",bindable:"bindable"},columns:{type:"sap.ui.table.Column",multiple:true,visibility:"public",singularName:"column"},_selectionPanel:{type:"sap.ui.table.TreeTable",multiple:false,visibility:"hidden"},_chart:{type:"sap.gantt.GanttChart",multiple:false,visibility:"hidden"}}}});k.prototype.init=function(){jQuery.sap.measure.start("GanttChartWithTable Init","GanttPerf:GanttChartWithTable Init function");this._oGanttChart=new c();this.setAggregation("_chart",this._oGanttChart);this._oGanttChartCnt=new A({enableRootDiv:true,content:this._oGanttChart});this._oTC=this._oGanttChart._oTT;this._oTT=new T({visibleRowCountMode:"Auto",minAutoRowCount:1,fixedColumnCount:this.getFixedColumnCount(),selectionBehavior:sap.ui.table.SelectionBehavior.Row,selectionMode:sap.ui.table.SelectionMode.Multi});this._oTT.attachFilter(function(E){if(this.canExpandGanttChart()){g.filter(E);}}.bind(this));this._oTT.attachSort(function(E){if(this.canExpandGanttChart()){g.sort(E);}}.bind(this));this._oTT.attachToggleOpenState(function(E){var B=this.getBinding();if(B&&B.getModel()instanceof sap.ui.model.json.JSONModel){var s=E.getSource(),i=E.getParameter("expanded"),r=E.getParameter("rowIndex"),o=B.getContextByIndex(r);if(B.hasChildren&&B.hasChildren(o)){g.toggleOpenStateWithRowIndex(s,r,i);}}});this.setAggregation("_selectionPanel",this._oTT);this._oToolbar=new e({type:sap.gantt.control.ToolbarType.Local,sourceId:sap.gantt.config.DEFAULT_HIERARCHY_KEY});this._oToolbar.data("holder",this);this._oToolbar.attachSourceChange(this._onToolbarSourceChange,this);this._oToolbar.attachExpandTreeChange(this._onToolbarExpandTreeChange,this);this._oToolbar.attachModeChange(this._onToolbarModeChange,this);this._oTT.addExtension(this._oToolbar);this._oSelectionPanelCnt=new A({enableRootDiv:true,content:this._oTT,layoutData:new b({size:"30%"})});this._oSplitter=new a({width:"100%",height:"100%",orientation:sap.ui.core.Orientation.Horizontal,contentAreas:[this._oSelectionPanelCnt,this._oGanttChartCnt]}).addStyleClass("sapGanttViewSplitterH");this._oSplitter.attachResize(this._onSplitterResize,this);this._oTC._oHSb.attachScroll(this._onChartHSbScroll,this);this._oTC._oVSb.attachScroll(this._onChartVSbScroll,this);this._oTT._oVSb.attachScroll(this._onSelectionPanelVSbScroll,this);this._oGanttChart.attachRowSelectionChange(this._onRowSelectionChange,this);this._oGanttChart.attachShapeSelectionChange(this._onShapeSelectionChange,this);this._oGanttChart.attachChartMouseOver(this._onChartMouseOver,this);this._oGanttChart.attachRelationshipSelectionChange(this._onRelationshipSelectionChange,this);this._oGanttChart.attachChartDoubleClick(this._onDoubleClick,this);this._oGanttChart.attachChartRightClick(this._onRightClick,this);this._oGanttChart.attachEvent("_shapesUpdated",this._onChartShapesUpdated,this);this._oGanttChart.attachChartDragEnter(this._onChartDragEnter,this);this._oGanttChart.attachChartDragLeave(this._onChartDragLeave,this);this._oGanttChart.attachShapeDragEnd(this._onShapeDragEnd,this);this._oModesConfigMap={};this._oModesConfigMap[sap.gantt.config.DEFAULT_MODE_KEY]=sap.gantt.config.DEFAULT_MODE;this._oToolbarSchemeConfigMap={};this._oToolbarSchemeConfigMap[sap.gantt.config.DEFAULT_GANTTCHART_TOOLBAR_SCHEME_KEY]=sap.gantt.config.DEFAULT_GANTTCHART_TOOLBAR_SCHEME;this._oToolbarSchemeConfigMap[sap.gantt.config.EMPTY_TOOLBAR_SCHEME_KEY]=sap.gantt.config.EMPTY_TOOLBAR_SCHEME;this._oHierarchyConfigMap={};this._oHierarchyConfigMap[sap.gantt.config.DEFAULT_HIERARCHY_KEY]=sap.gantt.config.DEFAULT_HIERARCHY;this._oDefaultExpansionStatus={};this._oTT.addEventDelegate({onAfterRendering:this._appendMaskSvg},this);this._oTT.addEventDelegate({onAfterRendering:this._updateCSSForDummyRow},this);this._oSelectionPanelDrawer=new f();this.attachEvent("collapseDummyRow",this._onRowCollapse);this._oGanttChartSchemesConfigMap={};this._oGanttChartSchemesConfigMap[sap.gantt.config.DEFAULT_CHART_SCHEME_KEY]=sap.gantt.config.DEFAULT_CHART_SCHEME;this._oObjectTypesConfigMap={};this._oObjectTypesConfigMap[sap.gantt.config.DEFAULT_OBJECT_TYPE_KEY]=sap.gantt.config.DEFAULT_OBJECT_TYPE;this._oShapesConfigMap={};jQuery.sap.measure.end("GanttChartWithTable Init");};k.prototype.setFixedColumnCount=function(F){this.setProperty("fixedColumnCount",F);this._oTT.setFixedColumnCount(F);return this;};k.prototype.setTimeAxis=function(t){this.setProperty("timeAxis",t);this._oGanttChart.setTimeAxis(t);return this;};k.prototype.setMode=function(m){this.setProperty("mode",m);this._oGanttChart.setMode(m);this._oToolbar.setMode(m);return this;};k.prototype.setModes=function(m){this.setProperty("modes",m);this._oToolbar.setModes(m);this._oGanttChart.setModes(m);this._oModesConfigMap={};if(m){for(var i=0;i<m.length;i++){this._oModesConfigMap[m[i].getKey()]=m[i];}}return this;};k.prototype.setSelectionMode=function(s){this.setProperty("selectionMode",s);if(this._oTT){if(s==sap.gantt.SelectionMode.None){this._oTT.setSelectionMode(sap.ui.table.SelectionMode.None);this._oTT.setSelectionBehavior(sap.ui.table.SelectionBehavior.RowOnly);}else if(s==sap.gantt.SelectionMode.MultiWithKeyboard){this._oTT.setSelectionMode(sap.ui.table.SelectionMode.Multi);this._oTT.setSelectionBehavior(sap.ui.table.SelectionBehavior.Row);}else{if(s==sap.gantt.SelectionMode.Single){this._oTT.setSelectionMode(sap.ui.table.SelectionMode.Single);}else{this._oTT.setSelectionMode(sap.ui.table.SelectionMode.MultiToggle);}this._oTT.setSelectionBehavior(sap.ui.table.SelectionBehavior.RowSelector);}}if(this._oGanttChart){this._oGanttChart.setSelectionMode(s);}return this;};k.prototype.setToolbarSchemes=function(t){this.setProperty("toolbarSchemes",t);this._oToolbar.setToolbarSchemes(t);this._oToolbarSchemeConfigMap={};if(t){for(var i=0;i<t.length;i++){this._oToolbarSchemeConfigMap[t[i].getKey()]=t[i];}}return this;};k.prototype.setHierarchyKey=function(H){this.setProperty("hierarchyKey",H);this._oToolbar.setSourceId(H);this._hierarchyChange();return this;};k.prototype.setHierarchies=function(H){this.setProperty("hierarchies",H);this._oToolbar.setHierarchies(H);this._oGanttChart.setHierarchies(H);this._oHierarchyConfigMap={};if(H){for(var i=0;i<H.length;i++){this._oHierarchyConfigMap[H[i].getKey()]=H[i];}}this._hierarchyChange();return this;};k.prototype.setCalendarDef=function(o){this.setAggregation("calendarDef",o);var p=o.getBindingInfo("defs");if(p){p.templateShareable=true;}this._oGanttChart.setCalendarDef(o.clone());return this;};k.prototype._hierarchyChange=function(){var H=this.getHierarchyKey();if(H&&this._oHierarchyConfigMap[H]){if(this._oHierarchyConfigMap[H].getColumns()&&this._oHierarchyConfigMap[H].getColumns().length>0){this._buildColumnFromCellCallback();}var m=this.getMode();if(m===sap.gantt.config.DEFAULT_MODE_KEY&&this._oHierarchyConfigMap[this.getHierarchyKey()]){m=this._oHierarchyConfigMap[this.getHierarchyKey()].getActiveModeKey();}this.setMode(m);this.setSelectionMode(this.getSelectionMode());}};k.prototype._buildColumnFromCellCallback=function(){this._oTT.removeAllColumns();var H,j;H=this._oHierarchyConfigMap[this.getHierarchyKey()];if(H){j=H.getColumns();}if(j){for(var i=0;i<j.length;i++){var o=new C({label:j[i].getTitle(),sortProperty:j[i].getSortAttribute(),filterProperty:j[i].getFilterAttribute(),width:j[i].getWidth(),template:new d({cellCallback:this.getCellCallback(),columnConfig:j[i]})});this._oTT.addColumn(o);}}this._oTT._bCallUpdateTableCell=true;};k.prototype.setObjectTypes=function(o){this.setProperty("objectTypes",o);this._oGanttChart.setObjectTypes(o);this._oObjectTypesConfigMap={};if(o){for(var i=0;i<o.length;i++){this._oObjectTypesConfigMap[o[i].getKey()]=o[i];}}return this;};k.prototype.setChartSchemes=function(j){this.setProperty("chartSchemes",j);this._oGanttChart.setChartSchemes(j);this._oGanttChartSchemesConfigMap={};if(j){for(var i=0;i<j.length;i++){this._oGanttChartSchemesConfigMap[j[i].getKey()]=j[i];}}return this;};k.prototype.setShapeDataNames=function(s){this.setProperty("shapeDataNames",s);this._oGanttChart.setShapeDataNames(s);return this;};k.prototype.setLocale=function(l){this.setProperty("locale",l);this._oGanttChart.setLocale(l);return this;};k.prototype.setShapes=function(s){this.setProperty("shapes",s);this._oGanttChart.setShapes(s);this._oShapesConfigMap={};if(s){for(var i=0;i<s.length;i++){this._oShapesConfigMap[s[i].getKey()]=s[i];}}return this;};k.prototype.setSvgDefs=function(s){this.setProperty("svgDefs",s);this._oGanttChart.setSvgDefs(s);return this;};k.prototype.setEnableCursorLine=function(E){this.setProperty("enableCursorLine",E);this._oGanttChart.setEnableCursorLine(E);this._oToolbar.setEnableCursorLine(E);return this;};k.prototype.setEnableNowLine=function(E){this.setProperty("enableNowLine",E);this._oGanttChart.setEnableNowLine(E);this._oToolbar.setEnableNowLine(E);return this;};k.prototype.setEnableVerticalLine=function(E){this.setProperty("enableVerticalLine",E);this._oGanttChart.setEnableVerticalLine(E);this._oToolbar.setEnableVerticalLine(E);return this;};k.prototype.setTimeZoomRate=function(t){this.setProperty("timeZoomRate",t);this._oGanttChart.setTimeZoomRate(t);return this;};k.prototype.addRelationship=function(r){this._oGanttChart.addRelationship(r);};k.prototype.insertRelationship=function(i,r){this._oGanttChart.insertRelationship(i,r);};k.prototype.removeRelationship=function(r){this._oGanttChart.removeRelationship(r);};k.prototype.getRelationships=function(){this._oGanttChart.getRelationships();};k.prototype.destroyRelationships=function(){this._oGanttChart.destroyRelationships();};k.prototype.indexOfRelationship=function(r){this._oGanttChart.indexOfRelationship(r);};k.prototype.removeAllRelationships=function(){this._oGanttChart.removeAllRelationships();};k.prototype.updateRelationships=function(r){this._oGanttChart.updateRelationships(r);};k.prototype.setSelectionPanelSize=function(s,i){this.setProperty("selectionPanelSize",s,i);this._oSelectionPanelCnt.setLayoutData(new b({size:s}));return this;};k.prototype.addCustomToolbarItem=function(o){this._oToolbar.addCustomToolbarItem(o);};k.prototype.insertCustomToolbarItem=function(o,i){this._oToolbar.insertCustomToolbarItem(o,i);};k.prototype.removeCustomToolbarItem=function(o){this._oToolbar.removeCustomToolbarItem(o);};k.prototype.removeAllCustomToolbarItems=function(){this._oToolbar.removeAllCustomToolbarItems();};k.prototype.addColumn=function(o){this._oTT.addColumn(o);};k.prototype.insertColumn=function(o,i){this._oTT.insertColumn(o,i);};k.prototype.removeColumn=function(o){this._oTT.removeColumn(o);};k.prototype.removeAllColumns=function(){this._oTT.removeAllColumns();};k.prototype.getColumns=function(){return this._oTT.getColumns();};k.prototype._bindAggregation=function(n,B){var m,o;if(n=="rows"&&B){m=this.getModel(B.model);o=this.getBindingContext(B.model);if(o&&m){B.path=m.resolve(B.path,o);}this._oTT.bindRows(B);this._oGanttChart.bindRows(B);this._oTC.updateRows=this._updateRows.bind(this);}else if(n=="relationships"&&B){m=this.getModel(B.model);o=this.getBindingContext(B.model);if(o&&m){B.path=m.resolve(B.path,o);}this._oGanttChart.bindRelationships(B);}else{return sap.ui.core.Control.prototype._bindAggregation.apply(this,arguments);}};k.prototype._updateRows=function(){sap.ui.table.Table.prototype.updateRows.apply(this._oTT,arguments);sap.ui.table.Table.prototype.updateRows.apply(this._oTC,arguments);};k.prototype._detachToolbarEvents=function(){this._oToolbar.detachSourceChange(this._onToolbarSourceChange,this);this._oToolbar.detachExpandTreeChange(this._onToolbarExpandTreeChange,this);};k.prototype.onAfterRendering=function(){this._attachEvents();this._oTT._oHSb.setContentSize(this._oTT.$().find(".sapUiTableCtrlScroll").width()+"px");};k.prototype._attachEvents=function(){var D={onAfterRendering:this._onTTandTCafterRendering};this._oTT.removeEventDelegate(D);this._oTT.addEventDelegate(D,this);this._oTC.removeEventDelegate(D);this._oTC.addEventDelegate(D,this);};k.prototype._onRowSelectionChange=function(E){this.fireRowSelectionChange({originEvent:E.getParameter("originEvent")});this._oTT._oSelection.fireSelectionChanged();};k.prototype._onChartMouseOver=function(E){var p=E.getParameters();this.fireChartMouseOver({objectInfo:p.objectInfo,leadingRowInfo:p.leadingRowInfo,timestamp:p.timestamp,svgId:p.svgId,svgCoordinate:p.svgCoordinate,effectingMode:p.effectingMode,originEvent:p.originEvent});};k.prototype._onShapeSelectionChange=function(E){this.fireShapeSelectionChange({originEvent:E.getParameter("originEvent")});};k.prototype._onRelationshipSelectionChange=function(E){this.fireRelationshipSelectionChange({originEvent:E.getParameter("originEvent")});};k.prototype._onDoubleClick=function(E){var p=E.getParameters();this.fireChartDoubleClick({objectInfo:p.objectInfo,leadingRowInfo:p.leadingRowInfo,timestamp:p.timestamp,svgId:p.svgId,svgCoordinate:p.svgCoordinate,effectingMode:p.effectingMode,originEvent:p.originEvent});};k.prototype._onRightClick=function(E){var p=E.getParameters();this.fireChartRightClick({objectInfo:p.objectInfo,leadingRowInfo:p.leadingRowInfo,timestamp:p.timestamp,svgId:p.svgId,svgCoordinate:p.svgCoordinate,effectingMode:p.effectingMode,originEvent:p.originEvent});};k.prototype._onChartDragEnter=function(E){this.fireChartDragEnter({originEvent:E.getParameter("originEvent")});};k.prototype._onChartDragLeave=function(E){this.fireChartDragLeave({originEvent:E.getParameter("originEvent"),draggingSource:E.getParameter("draggingSource")});};k.prototype._onShapeDragEnd=function(E){var p=E.getParameters();this.fireShapeDragEnd({originEvent:p.originEvent,sourceShapeData:p.sourceShapeData,targetData:p.targetData,sourceSvgId:p.sourceSvgId,targetSvgId:p.targetSvgId});};k.prototype._onChartHSbScroll=function(E){var n=this._oTC._oHSb.getScrollPosition();this.fireHorizontalScroll({scrollSteps:n,leftOffsetRate:this._oGanttChart.updateLeftOffsetRate(n)});};k.prototype._onChartVSbScroll=function(E){this.fireVerticalScroll({scrollSteps:this._oTC._oVSb.getScrollPosition()});this._oTT.setFirstVisibleRow(this._oTC._oVSb.getScrollPosition()||0,true);};k.prototype._onChartShapesUpdated=function(E){this._appendMaskSvg();this._updateCSSForDummyRow();this.fireEvent("_shapesUpdated",{aSvg:E.mParameters.aSvg});};k.prototype._onSelectionPanelVSbScroll=function(E){this._oTC._oVSb.setScrollPosition(this._oTT.getFirstVisibleRow());};k.prototype._onSplitterResize=function(E){var p=E.getParameters();p.zoomInfo=this._oGanttChart.calculateZoomInfoFromChartWidth(p.newSizes[1]);this.fireSplitterResize(p);};k.prototype._onToolbarSourceChange=function(E){var o=this.getHierarchyKey();this.setHierarchyKey(E.getParameter("id"));this.notifySourceChange();this.fireGanttChartSwitchRequested({hierarchyKey:E.getParameter("id"),oldHierarchyKey:o});};k.prototype._onToolbarExpandTreeChange=function(E){var s=E.getParameter("action");if(s){var j=this._oTT.getSelectedIndices();for(var i=j.length-1;i>-1;i--){this._oTT[s](j[i]);j=this._oTT.getSelectedIndices();}}};k.prototype._onToolbarModeChange=function(E){var B=this.getBinding("mode");if(B){B.setValue(E.getParameter("mode"));}this.setMode(E.getParameter("mode"));};k.prototype.expandChartChange=function(E){var p=E.getParameters();this._oGanttChart.expandChartChange(p.isExpand,p.expandedChartSchemes,p.aExpandedIndices);};k.prototype.getBaseRowHeight=function(){if(this._oTT.getRows()[0]){return this._oTT.getRows()[0].getDomRef().scrollHeight;}};k.prototype._onTTandTCafterRendering=function(E){var t=this._oTT;var l=jQuery(t.getDomRef());var o=this._oTC;var m=jQuery(o.getDomRef());var O=t.getId();var s=o.getId();var n=E.srcControl;var I,p;if(n===t){o.setRowHeight(this.getBaseRowHeight());I=s;p=o;l.find(".sapUiTableRowHdr").hover(function(v){var w=v.type,x=l.find(".sapUiTableRowHdr").index(this),y;if(g.isMultipleSpanMainRow(t,x,false)){var z=g.getMultipleSpanMainRowGroupIndices(t,x,false);for(var i=0;i<z.length;i++){y=t.getRows()[z[i]];if(y){jQuery(y.getDomRef()).trigger(w,[t.getId()]);}}}else{y=o.getRows()[x];if(y){jQuery(y.getDomRef()).trigger(w,[t.getId()]);}}});}else if(n===o){I=O;p=t;m.find(".sapUiTableRowHdr").hover(function(v){var w=v.type,x=m.find(".sapUiTableRowHdr").index(this),y;if(g.isMultipleSpanMainRow(o,x)){var z=g.getMultipleSpanMainRowGroupIndices(o,x);for(var i=0;i<z.length;i++){y=o.getRows()[z[i]];if(y){jQuery(y.getDomRef()).trigger(w,[o.getId()]);}}}else{y=t.getRows()[x];if(y){jQuery(y.getDomRef()).trigger(w,[o.getId()]);}}});}var q=function(v,F,M){var w=v.type;var x=jQuery(this).control(0);var y=n.indexOfRow(x);if(M===undefined&&g.isMultipleSpanMainRow(n,y,false)){var z=g.getMultipleSpanMainRowGroupIndices(n,y,false);if(F!==I){if(F===s&&w!=="mouseleave"){var B=p.getRows()[y];if(B){jQuery(B.getDomRef()).trigger(w,[n.getId()],true);}}else{for(var i=0;i<z.length;i++){var D=n.getRows()[z[i]];var H=p.getRows()[z[i]];if(D&&H){jQuery(D.getDomRef()).trigger(w,[p.getId()],true);jQuery(H.getDomRef()).trigger(w,[n.getId()],true);}}}}}else if(F!==I){if(y>-1){x=p.getRows()[y];if(x){jQuery(x.getDomRef()).trigger(w,[n.getId()],true);}}}};var r=n.getRows();var R=r.length;var j=0;for(j=0;j<R;j++){var u=jQuery(r[j].getDomRef());if(jQuery._data(u[0],"events")===undefined||jQuery._data(u[0],"events").mouseover.length<2){u.mouseenter(q);u.mouseleave(q);}}this._expandDefaultLevel();};k.prototype._onRowCollapse=function(E){this.expandChartChange(E);};k.prototype.getToolbarSchemeKey=function(){return this._oToolbar.getToolbarSchemeKey();};k.prototype.jumpToPosition=function(D){this._oGanttChart.jumpToPosition(D);};k.prototype.selectShapes=function(i,j){return this._oGanttChart.selectShapes(i,j);};k.prototype.deselectShapes=function(i){return this._oGanttChart.deselectShapes(i);};k.prototype.selectRelationships=function(i,j){return this._oGanttChart.selectRelationships(i,j);};k.prototype.deselectRelationships=function(i){return this._oGanttChart.deselectRelationships(i);};k.prototype.selectRows=function(i,j){return this._oGanttChart.selectRows(i,j);};k.prototype.deselectRows=function(i){return this._oGanttChart.deselectRows(i);};k.prototype.selectRowsAndShapes=function(i,I){return this._oGanttChart.selectRowsAndShapes(i,I);};k.prototype.getAllSelections=function(){return this._oGanttChart.getAllSelections();};k.prototype.getSelectedShapes=function(){var s=this._oGanttChart.getSelectedShapes();return s;};k.prototype.getSelectedRows=function(){var s=this._oGanttChart.getSelectedRows();return s;};k.prototype.getSelectedRelationships=function(){var s=this._oGanttChart.getSelectedRelationships();return s;};k.prototype.setDraggingData=function(D){this._oGanttChart.setDraggingData(D);};k.prototype._updateCSSForDummyRow=function(){var r=this._oTT.getRows();var R=this._oTT.$().find(".sapUiTableRowHdrScr").children();for(var i=0;i<r.length;i++){var o=r[i];var j=o.getIndex();if(j!==-1&&g.isMultipleSpanMainRow(this._oTT,i)){var l=g.getContextObject(this._oTT,j);if(l.afterNodeNum>0){r[i].$().addClass("sapGanttTrNoBorder");$(R[i]).addClass("sapGanttTHeaderNoBorder");}else{r[i].$().removeClass("sapGanttTrNoBorder");$(R[i]).removeClass("sapGanttTHeaderNoBorder");}}else{r[i].$().removeClass("sapGanttTrNoBorder");$(R[i]).removeClass("sapGanttTHeaderNoBorder");}}};k.prototype._drawSelectionPanel=function(){var t=d3.select("#"+this.getId()+"-spm-svg-table");var s=d3.select("#"+this.getId()+"-spm-svg-selection");var D=this._oGanttChart.getShapeData();if(D!==undefined){this._oSelectionPanelDrawer.drawSvg(t,s,D,this);}};k.prototype._appendMaskSvg=function(){var i=this.$().find("#"+this.getId()+"-spm-svg-table-ctn");var j=this.$().find("#"+this.getId()+"-spm-svg-slecetion-ctn");if(i.length==0&&j.length==0){i=$("<div id='"+this.getId()+"-spm-svg-table-ctn' class='sapGanttChartSPMSvgCtn' >"+"<svg id='"+this.getId()+"-spm-svg-table' class='sapGanttSPMaskSvg'>"+"</svg>"+"</div>");j=$("<div id='"+this.getId()+"-spm-svg-slecetion-ctn' class='sapGanttChartSPMSvgCtn' >"+"<svg id='"+this.getId()+"-spm-svg-selection' class='sapGanttSPMaskSvg'>"+"</svg>"+"</div>");this._oTT.$().find("table").parent().append(i);this._oTT.$().find("table").parent().parent().prev().append(j);}$(i).attr("style",this._oTT.$().find("table").attr("style"));this._drawSelectionPanel();};k.prototype.getAxisOrdinal=function(){return this._oGanttChart.getAxisOrdinal();};k.prototype.getAxisTime=function(){return this._oGanttChart.getAxisTime();};k.prototype._expandDefaultLevel=function(){var E;var H=this.getHierarchyKey();if(this._oDefaultExpansionStatus){if(this._oDefaultExpansionStatus[H]===true){return;}}if(this._oHierarchyConfigMap[H]&&this._oHierarchyConfigMap[H].getExpandedLevels()){E=this._oHierarchyConfigMap[this.getHierarchyKey()].getExpandedLevels();var B=this._oTT.getBinding("rows");var t=B.getModel().getObject(B.getPath());var l=0;var r=0;var m=[];var n=this._oTT.getBindingInfo("rows").parameters.arrayNames;var I;var o=function(N){for(var i=0;i<n.length;i++){if(N[n[i]]){return true;}}return false;};if(E.length<=0){this._oDefaultExpansionStatus[H]=true;return;}else{var p=function(i,N){if(l>E.length){if(l===(E.length+1)){r++;}return;}if(o(N)===true){if(!($.inArray(N.type,E[l])>-1)){if(m){m.push(r);}else{m=[r];}}r++;if(l<=E.length){l++;for(var j=0;j<n.length;j++){if(N[n[j]]){jQuery.each(N[n[j]],p);}}l--;}}else{r++;}};var q=function(){B.detachChange(q,this);for(var i=0;i<n.length;i++){if(t[n[i]]){jQuery.each(t[n[i]],p);}}B.getContexts(this._oTT.getFirstVisibleRow(),0);for(I=0;I<m.length;I++){this._oTT.collapse(m[I]);}};B.attachChange(q,this);this._oTT.expandToLevel(E.length);}}this._oDefaultExpansionStatus[H]=true;};k.prototype.canExpandGanttChart=function(){var i=false;var s=this.getHierarchyKey(),j=this.getHierarchies(),l=this.getToolbarSchemes();var F=j.filter(function(H){return H.getKey()===s;})||[];F.forEach(function(H){i=l.filter(function(p){return p.getKey()===H.getToolbarSchemeKey();}).some(function(t){return t.getExpandChart();});});var o=this.getParent();if(!i&&o.getToolbarSchemes){var L=o.getContainerLayoutKey(),m=o.getContainerLayouts(),n=m.filter(function(I){return I.getKey()===L;})||[];n.forEach(function(p){i=o.getToolbarSchemes().filter(function(I){return I.getKey()===n[0].getToolbarSchemeKey();}).some(function(I){return I.getExpandChart();});});}return i;};k.prototype.expand=function(r){this._oTT.expand(r);return this;};k.prototype.collapse=function(r){this._oTT.collapse(r);return this;};k.prototype.setSelectedIndex=function(r){this._oTT.setSelectedIndex(r);return this;};k.prototype.getSelectedIndex=function(){return this._oTT.getSelectedIndex();};k.prototype.getFirstVisibleRow=function(){return this._oTT.getFirstVisibleRow();};k.prototype.setFirstVisibleRow=function(r){this._oTT.setFirstVisibleRow(r);return this;};k.prototype.getVisibleRowCount=function(){return this._oTT.getVisibleRowCount();};k.prototype.getRows=function(){return this._oTT.getRows();};k.prototype.exit=function(){this._detachToolbarEvents();this._oSplitter.destroy();};G.prototype.notifySourceChange=function(){this._oTT.data(g.JSONDataKey,null);};return k;},true);
