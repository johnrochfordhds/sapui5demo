/*!
 * 
 * 		SAP UI development toolkit for HTML5 (SAPUI5)
 * 		(c) Copyright 2009-2015 SAP SE. All rights reserved
 * 	
 */
jQuery.sap.declare("sap.suite.ui.commons.ProcessFlow");jQuery.sap.require("sap.suite.ui.commons.library");jQuery.sap.require("sap.ui.core.Control");sap.ui.core.Control.extend("sap.suite.ui.commons.ProcessFlow",{metadata:{publicMethods:["getZoomLevel","setZoomLevel","zoomIn","zoomOut","updateModel","getFocusedNode","updateNodesOnly","setSelectedPath"],library:"sap.suite.ui.commons",properties:{"foldedCorners":{type:"boolean",group:"Misc",defaultValue:false},"scrollable":{type:"boolean",group:"Misc",defaultValue:true},"wheelZoomable":{type:"boolean",group:"Behavior",defaultValue:true},"showLabels":{type:"boolean",group:"Appearance",defaultValue:false}},defaultAggregation:"lanes",aggregations:{"_connections":{type:"sap.suite.ui.commons.ProcessFlowConnection",multiple:true,singularName:"_connection",visibility:"hidden"},"nodes":{type:"sap.suite.ui.commons.ProcessFlowNode",multiple:true,singularName:"node"},"lanes":{type:"sap.suite.ui.commons.ProcessFlowLaneHeader",multiple:true,singularName:"lane"}},events:{"nodeTitlePress":{deprecated:true},"nodePress":{},"labelPress":{},"headerPress":{},"onError":{}}}});sap.suite.ui.commons.ProcessFlow.M_EVENTS={'nodeTitlePress':'nodeTitlePress','nodePress':'nodePress','labelPress':'labelPress','headerPress':'headerPress','onError':'onError'};jQuery.sap.require("sap.m.Image");sap.suite.ui.commons.ProcessFlow.prototype._resBundle=null;sap.suite.ui.commons.ProcessFlow.prototype._zoomLevel=sap.suite.ui.commons.ProcessFlowZoomLevel.Two;sap.suite.ui.commons.ProcessFlow.prototype._wheelTimeout=null;sap.suite.ui.commons.ProcessFlow.prototype._isFocusChanged=false;sap.suite.ui.commons.ProcessFlow.prototype._wheelTimestamp=null;sap.suite.ui.commons.ProcessFlow.prototype._wheelCalled=false;sap.suite.ui.commons.ProcessFlow.prototype._internalCalcMatrix=false;sap.suite.ui.commons.ProcessFlow.prototype._internalConnectionMap=null;sap.suite.ui.commons.ProcessFlow.prototype._internalLanes=false;sap.suite.ui.commons.ProcessFlow.prototype._jumpOverElements=5;sap.suite.ui.commons.ProcessFlow.prototype._lastNavigationFocusNode=false;sap.suite.ui.commons.ProcessFlow.prototype._defaultCursorClass="sapSuiteUiDefaultCursorPF";if(sap.ui.Device.browser.msie){sap.suite.ui.commons.ProcessFlow.prototype._grabCursorClass="sapSuiteUiGrabCursorIEPF";sap.suite.ui.commons.ProcessFlow.prototype._grabbingCursorClass="sapSuiteUiGrabbingCursorIEPF";}else{sap.suite.ui.commons.ProcessFlow.prototype._grabCursorClass="sapSuiteUiGrabCursorPF";sap.suite.ui.commons.ProcessFlow.prototype._grabbingCursorClass="sapSuiteUiGrabbingCursorPF";}sap.suite.ui.commons.ProcessFlow.prototype._mousePreventEvents='contextmenu dblclick';sap.suite.ui.commons.ProcessFlow.prototype._mouseEvents='contextmenu mousemove mouseleave mousedown mouseup mouseenter';sap.suite.ui.commons.ProcessFlow.prototype._mouseWheelEvent=(sap.ui.Device.browser.mozilla)?'DOMMouseScroll MozMousePixelScroll':'mousewheel wheel';sap.suite.ui.commons.ProcessFlow.prototype._headerHasFocus=false;sap.suite.ui.commons.ProcessFlow.prototype._isInitialZoomLevelNeeded=true;sap.suite.ui.commons.ProcessFlow.prototype._bDoScroll=!sap.ui.Device.system.desktop||(sap.ui.Device.os.windows&&sap.ui.Device.os.version===8);sap.suite.ui.commons.ProcessFlow.prototype._scrollStep=192;sap.suite.ui.commons.ProcessFlow.prototype._bPreviousScrollForward=false;sap.suite.ui.commons.ProcessFlow.prototype._bPreviousScrollBack=false;sap.suite.ui.commons.ProcessFlow.prototype._iInitialArrowTop=undefined;sap.suite.ui.commons.ProcessFlow.prototype._iInitialCounterTop=undefined;sap.suite.ui.commons.ProcessFlow.prototype._bRtl=false;sap.suite.ui.commons.ProcessFlow.prototype._arrowScrollable=null;sap.suite.ui.commons.ProcessFlow.prototype._iTouchStartScrollTop=undefined;sap.suite.ui.commons.ProcessFlow.prototype._iTouchStartScrollLeft=undefined;sap.suite.ui.commons.ProcessFlow.prototype._bSetFocusOnce=true;
sap.suite.ui.commons.ProcessFlow.prototype.init=function(){this._bRtl=sap.ui.getCore().getConfiguration().getRTL();if(!this._resBundle){this._resBundle=sap.ui.getCore().getLibraryResourceBundle("sap.suite.ui.commons");}this._internalLanes=this.getLanes();this.$("scrollContainer").bind('keydown',jQuery.proxy(this.onkeydown,this));this.$("scrollContainer").bind('keyup',jQuery.proxy(this.onkeyup,this));};
sap.suite.ui.commons.ProcessFlow.prototype.exit=function(){if(this.getNodes()){for(var i=0;i<this.getNodes().length;i++){this.getNodes()[i].destroy();}this.getNodes=null;}if(this._internalLanes){for(var i=0;i<this._internalLanes.length;i++){this._internalLanes[i].destroy();}this._internalLanes=null;}var I=this.getAggregation("_connections");if(I){for(var i=0;i<I.length;i++){I[i].destroy();}I=null;}if(this._oArrowLeft){this._oArrowLeft.destroy();}if(this._oArrowRight){this._oArrowRight.destroy();}if(this._resizeRegId){sap.ui.core.ResizeHandler.deregister(this._resizeRegId);}if(this._internalCalcMatrix){delete this._internalCalcMatrix;this._internalCalcMatrix=null;}this.$("scrollContainer").unbind(this._mousePreventEvents,this._handlePrevent);this.$("scrollContainer").unbind(this._mouseEvents,jQuery.proxy(this._registerMouseEvents,this));this.$("scrollContainer").unbind(this._mouseWheelEvent,jQuery.proxy(this._registerMouseWheel,this));this.$("scrollContainer").unbind('keydown',jQuery.proxy(this.onkeydown,this));this.$("scrollContainer").unbind('scroll',jQuery.proxy(this._onScroll,this));};
sap.suite.ui.commons.ProcessFlow.prototype.onBeforeRendering=function(){this.$("scrollContainer").unbind(this._mousePreventEvents,this._handlePrevent);this.$("scrollContainer").unbind(this._mouseEvents,jQuery.proxy(this._registerMouseEvents,this));this.$("scrollContainer").unbind(this._mouseWheelEvent,jQuery.proxy(this._registerMouseWheel,this));this.$("scrollContainer").unbind('keydown',jQuery.proxy(this.onkeydown,this));this.$("scrollContainer").unbind('scroll',jQuery.proxy(this._onScroll,this));};
sap.suite.ui.commons.ProcessFlow.prototype._handleException=function(e){var t=this._resBundle.getText('PF_ERROR_INPUT_DATA');this.fireOnError({text:t});jQuery.sap.log.error("Error loading data for the process flow with id : "+this.getId());if(e instanceof Array){for(var i=0;i<e.length;i++){jQuery.sap.log.error("Detailed description ("+i+") :"+e[i]);}}else{jQuery.sap.log.error("Detailed description  :"+e);}};
sap.suite.ui.commons.ProcessFlow.prototype._updateLanesFromNodes=function(){sap.suite.ui.commons.ProcessFlow.NodeElement.createNodeElementsFromProcessFlowNodes(this.getNodes(),this.getLanes());var i=this._arrangeNodesByParentChildRelation(this.getNodes());this._internalLanes=sap.suite.ui.commons.ProcessFlow.NodeElement.updateLanesFromNodes(this.getLanes(),i).lanes;};
sap.suite.ui.commons.ProcessFlow.prototype._getOrCreateLaneMap=function(){if(!this._internalLanes||this._internalLanes.length<=0){this._updateLanesFromNodes();}var m=sap.suite.ui.commons.ProcessFlow.NodeElement.createMapFromLanes(this._internalLanes,jQuery.proxy(this.ontouchend,this),this._isHeaderMode()).positionMap;return m;};
sap.suite.ui.commons.ProcessFlow.prototype._arrangeNodesByParentChildRelation=function(I){var c=I?I.length:0;var C=[];var i,j;if(c>0){this._setParentForNodes(I);for(i=0;i<c;i++){C=I[i].getChildren();if(C){var a=C.length;for(j=0;j<a;j++){C[j]=sap.suite.ui.commons.ProcessFlow._getChildIdByElement(C[j]).toString();}}for(j=0;j<i;j++){if(jQuery.inArray(I[j].getNodeId(),C)>-1&&I[j].getLaneId()===I[i].getLaneId()){I.splice(j,0,I[i]);I.splice(i+1,1);I=this._arrangeNodesByParentChildRelation(I);break;}}}}return I;};
sap.suite.ui.commons.ProcessFlow.prototype._getOrCreateProcessFlow=function(){if(!this._internalLanes||this._internalLanes.length<=0){this._updateLanesFromNodes();}this.applyNodeDisplayState();var a=this.getNodes();var r=sap.suite.ui.commons.ProcessFlow.NodeElement.createNodeElementsFromProcessFlowNodes(a,this._internalLanes);var e=r.elementForId;var b=r.elementsForLane;sap.suite.ui.commons.ProcessFlow.NodeElement.calculateLaneStatePieChart(b,this._internalLanes,a,this);var c=this.calculateMatrix(e);c=this.addFirstAndLastColumn(c);for(var i=0;i<c.length;i++){for(var j=0;j<c[i].length;j++){if(c[i][j]instanceof sap.suite.ui.commons.ProcessFlow.NodeElement){c[i][j]=e[c[i][j].nodeId].oNode;}}}this._internalCalcMatrix=c;return c;};
sap.suite.ui.commons.ProcessFlow.prototype.applyNodeDisplayState=function(){var I=this.getNodes(),n=I?I.length:0,i=0;if(n===0){return;}else{while(i<n){I[i]._setRegularState();i++;}i=0;while((i<n)&&!I[i].getHighlighted()&&!I[i].getSelected()){i++;}if(i<n){i=0;while(i<n){if(!I[i].getHighlighted()&&!I[i].getSelected()){I[i]._setDimmedState();}i++;}}}};
sap.suite.ui.commons.ProcessFlow.prototype.addFirstAndLastColumn=function(c){if(!c||c.length<=0){return[];}var o=c.length;for(var i=0;i<o;i++){c[i].unshift(null);c[i].push(null);}return c;};
sap.suite.ui.commons.ProcessFlow.prototype.calculateMatrix=function(e){var a,E,h,r,b;if(!e||(e.length===0)){return[];}a=new sap.suite.ui.commons.ProcessFlow.InternalMatrixCalculation(this);a.checkInputNodeConsistency(e);E=a.retrieveInfoFromInputArray(e);a.resetPositions();h=E.highestLanePosition+1;r=Object.keys(e).length>3?Object.keys(e).length-1:2;b=a.createMatrix(r,h);for(var i=0;i<E.rootElements.length;i++){a.posy=E.rootElements[i].lane;b=a.processCurrentElement(E.rootElements[i],e,b);}b=a.doubleColumnsInMatrix(b);b=a.calculatePathInMatrix(b);b=a.removeEmptyLines(b);return b;};
sap.suite.ui.commons.ProcessFlow.NodeElement=function(i,l,n,N){this.nodeId=i;this.lane=l;this.state=n.getState();this.displayState=n._getDisplayState();this.isProcessed=false;if(jQuery.isArray(N)){this.aParent=N;}else{this.oParent=N;}this.oNode=n;};
sap.suite.ui.commons.ProcessFlow.NodeElement.initNodeElement=function(i,l,n,N){return new sap.suite.ui.commons.ProcessFlow.NodeElement(i,l,n,N);};
sap.suite.ui.commons.ProcessFlow.NodeElement.prototype={toString:function(){return this.nodeId;},containsChildren:function(t){if(!t){return false;}if(!(t instanceof sap.suite.ui.commons.ProcessFlow.NodeElement)){return false;}if(this.oNode.getChildren()&&t.oNode.getChildren()&&this.oNode.getChildren().length&&t.oNode.getChildren().length){for(var i=0;i<this.oNode.getChildren().length;i++){if(t.oNode.getChildren().indexOf(this.oNode.getChildren()[i])>=0){return true;}}}return false;}};
sap.suite.ui.commons.ProcessFlow.NodeElement.calculateLaneStatePieChart=function(e,l,a,p){if(!e||!l||!a){return;}for(var i=0;i<a.length;i++){p._bHighlightedMode=a[i].getHighlighted();if(p._bHighlightedMode){break;}}var b=0;var n=0;var c=0;var d=0;for(var i=0;i<l.length;i++){var f=l[i];var g=e[f.getLaneId()];if(!g){continue;}b=0;n=0;c=0;d=0;for(var j=0;j<g.length;j++){if(!p._bHighlightedMode||(g[j].oNode._getDisplayState()==sap.suite.ui.commons.ProcessFlowDisplayState.Highlighted||g[j].oNode._getDisplayState()==sap.suite.ui.commons.ProcessFlowDisplayState.HighlightedFocused||g[j].oNode._getDisplayState()==sap.suite.ui.commons.ProcessFlowDisplayState.SelectedHighlighted||g[j].oNode._getDisplayState()==sap.suite.ui.commons.ProcessFlowDisplayState.SelectedHighlightedFocused)){switch(g[j].oNode.getState()){case sap.suite.ui.commons.ProcessFlowNodeState.Positive:b++;break;case sap.suite.ui.commons.ProcessFlowNodeState.Negative:n++;break;case sap.suite.ui.commons.ProcessFlowNodeState.Planned:d++;break;case sap.suite.ui.commons.ProcessFlowNodeState.Neutral:c++;break;case sap.suite.ui.commons.ProcessFlowNodeState.PlannedNegative:n++;break;}}}var s=[{state:sap.suite.ui.commons.ProcessFlowNodeState.Positive,value:b},{state:sap.suite.ui.commons.ProcessFlowNodeState.Negative,value:n},{state:sap.suite.ui.commons.ProcessFlowNodeState.Neutral,value:c},{state:sap.suite.ui.commons.ProcessFlowNodeState.Planned,value:d}];f.setState(s);}};
sap.suite.ui.commons.ProcessFlow.NodeElement.updateLanesFromNodes=function(p,I){var c=sap.suite.ui.commons.ProcessFlow.NodeElement.createMapFromLanes(p,null,false);var m=c.positionMap;var a=c.idMap;var n={};var t=p.slice();var P;var b={};var d=0;for(var i=0;i<I.length;i++){n[I[i].getNodeId()]=I[i];}for(var i=0;i<I.length;i++){var e=I[i];var f=e.getChildren()||[];var g=1;var h=null;var k=null;for(var j=0;j<f.length;j++){var C=sap.suite.ui.commons.ProcessFlow._getChildIdByElement(f[j]);var l=n[C];if(l&&(e.getLaneId()==l.getLaneId())){h=l.getLaneId()+g;k=a[h];if(!k){var o=a[e.getLaneId()];k=sap.suite.ui.commons.ProcessFlow.NodeElement.createNewProcessFlowElement(o,h,o.getPosition()+g);a[k.getLaneId()]=k;t.splice(k.getPosition(),0,k);}l._setMergedLaneId(k.getLaneId());}sap.suite.ui.commons.ProcessFlow.NodeElement.changeLaneOfChildren(e.getLaneId(),l,n);}if(k){b={};P=false;for(var q in m){if(k.getLaneId()==m[q].getLaneId()){P=true;break;}if(parseInt(q)>=k.getPosition()){var r=m[q];b[r.getPosition()+g]=r;}}if(!P){for(var w in b){d=parseInt(w);b[d]._setMergedPosition(d);}b[k.getPosition()]=k;for(var v=0;v<k.getPosition();v++){b[v]=m[v];}m=b;}}}return{lanes:t,nodes:I};};
sap.suite.ui.commons.ProcessFlow.NodeElement.changeLaneOfChildren=function(o,c,n){var a=c.getChildren();if(a){for(var i=0;i<a.length;i++){var b=sap.suite.ui.commons.ProcessFlow._getChildIdByElement(a[i]);var d=n[b];if(d.getLaneId()==o){d._setMergedLaneId(c.getLaneId());sap.suite.ui.commons.ProcessFlow.NodeElement.changeLaneOfChildren(o,d,n);}}}};
sap.suite.ui.commons.ProcessFlow.NodeElement.createNewProcessFlowElement=function(o,n,a){var c=new sap.suite.ui.commons.ProcessFlowLaneHeader({laneId:n,iconSrc:o.getIconSrc(),text:o.getText(),state:o.getState(),position:a,zoomLevel:o.getZoomLevel()});return c;};
sap.suite.ui.commons.ProcessFlow.NodeElement.createMapFromLanes=function(p,t,h){var l,m={},M={},n=p?p.length:0,i=0;if(!n){return{};}else{while(i<n){l=p[i];if(l instanceof sap.suite.ui.commons.ProcessFlowLaneHeader){m[l.getPosition()]=l;M[l.getLaneId()]=l;if(t){l.attachPress(t);}l._setHeaderMode(h);}i++;}return{positionMap:m,idMap:M};}};
sap.suite.ui.commons.ProcessFlow.NodeElement.createNodeElementsFromProcessFlowNodes=function(p,a){var P={},e={},b={},n,N=p?p.length:0,s,l,L=a?a.length:0,c,d=[],f,C,g,h,i,j,E={};if(N===0){return{elementForId:{},elementsForLane:{}};}if(L===0){throw["No lane definition although there is a node definition."];}i=0;while(i<L){l=a[i];c=l.getLaneId();f=l.getPosition();if(P[c]){throw["The lane with id: "+c+" is defined at least twice. (Lane error)"];}P[c]=f;if(jQuery.inArray(f,d)>-1){throw["The position "+f+" is defined at least twice. (Lane error)."];}else{d.push(f);}e[c]=[];i++;}i=0;while(i<N){n=p[i];if(n instanceof sap.suite.ui.commons.ProcessFlowNode){s=n.getNodeId();c=n.getLaneId();C=n.getChildren()||[];h=C.length;j=0;while(j<h){g=sap.suite.ui.commons.ProcessFlow._getChildIdByElement(C[j]);b[g]=b[g]||[];b[g].push(s);j++;}}i++;}i=0;while(i<N){n=p[i];if(n instanceof sap.suite.ui.commons.ProcessFlowNode){s=n.getNodeId();if(!s){throw["There is a node which has no node id defined. (Title="+n.getTitle()+") and array position: "+i];}c=n.getLaneId();f=P[c];if(typeof f!=='number'){throw["For the node "+s+" position (lane) is not defined."];}if(!E[s]){E[s]=sap.suite.ui.commons.ProcessFlow.NodeElement.initNodeElement(s,f,n,b[s]);e[c].push(E[s]);}else{throw["The node id "+s+" is used second time."];}}i++;}return{elementForId:E,elementsForLane:e};};
sap.suite.ui.commons.ProcessFlow.InternalMatrixCalculation=function(p){this.parentControl=p;this.posx=0;this.posy=0;this.nodePositions={};this.mapChildToNode={};};
sap.suite.ui.commons.ProcessFlow.InternalMatrixCalculation.prototype.checkInputNodeConsistency=function(e){var r=[],j,c,n,C,E;Object.keys(e).forEach(function(s){E=e[s];C=E.oNode.getChildren();n=C?C.length:0;j=0;while(j<n){c=sap.suite.ui.commons.ProcessFlow._getChildIdByElement(C[j]);if(!e[c]){r.push("Node identificator "+c+" used in children definition is not presented as the node itself. Element : "+E.nodeId);}j++;}});if(r.length>0){throw r;}};
sap.suite.ui.commons.ProcessFlow.InternalMatrixCalculation.prototype.resetPositions=function(){this.posx=0;this.posy=0;delete this.nodePositions;delete this.mapChildToNode;this.nodePositions={};this.mapChildToNode={};};
sap.suite.ui.commons.ProcessFlow.InternalMatrixCalculation.prototype.createMatrix=function(l){l=parseInt(l,10);var a=new Array(l||0);var i=l;if(arguments.length>1){var b=Array.prototype.slice.call(arguments,1);while(i--){a[l-1-i]=this.createMatrix.apply(this,b);}}return a;};
sap.suite.ui.commons.ProcessFlow.InternalMatrixCalculation.prototype.retrieveInfoFromInputArray=function(e){var h=0,r=[],E;Object.keys(e).forEach(function(s){E=e[s];if(!E.oParent&&!E.aParent){r.push(E);}if(h<E.lane){h=E.lane;}});return{'highestLanePosition':h,'rootElements':r};};
sap.suite.ui.commons.ProcessFlow.InternalMatrixCalculation.prototype.doubleColumnsInMatrix=function(c){var m=0;for(var i=0;i<c.length;i++){m=m>c[i].length?m:c[i].length;}var d=new Array(c.length||0);for(var i=0;i<d.length;i++){d[i]=new Array(m*2-1);for(var j=0;j<m;j++){if(c[i][j]){d[i][2*j]=c[i][j];}}}return d;};
sap.suite.ui.commons.ProcessFlow.InternalMatrixCalculation.prototype.removeEmptyLines=function(o){var n=0;for(var i=0;i<o.length;i++){for(var j=0;j<o[i].length;j++){if(o[i][j]){n++;break;}}}var r=this.createMatrix(n,o[0].length);for(var i=0;i<n;i++){for(var j=0;j<o[i].length;j++){r[i][j]=null;if(o[i][j]){r[i][j]=o[i][j];}}}return r;};
sap.suite.ui.commons.ProcessFlow.InternalMatrixCalculation.prototype.processCurrentElement=function(c,e,r){var E,a,t=this,n=true,m=true;if(c.isProcessed){return r;}this.nodePositions[c.nodeId]={'c':c,'x':this.posx,'y':this.posy*2};r[this.posx][this.posy++]=c;E=c.oNode.getChildren();c.isProcessed=true;a=this.sortBasedOnChildren(E,e);if(a){a.forEach(function(C){if(!C.isProcessed){m=false;while(t.posy<C.lane){r[t.posx][t.posy++]=null;}r=t.processCurrentElement(C,e,r);}else{if(n&&m){t.posx++;n=false;}}});}if(!E||m){if(n){this.posx++;}this.posy=0;}return r;};
sap.suite.ui.commons.ProcessFlow.InternalMatrixCalculation.prototype.sortBasedOnChildren=function(e,c){var E={},d,l=null,L,n,N,f=[],s,S,p;if(e){e.forEach(function(C){var a=sap.suite.ui.commons.ProcessFlow._getChildIdByElement(C);d=E[c[a].lane];if(!d){E[c[a].lane]=d=[];}d.push(c[a]);});}else{return[];}L=[];for(l in E){L.push(l);E[l].sort(function(a,b){n=(a.oNode.getChildren()||[]).length;N=(b.oNode.getChildren()||[]).length;return N-n;});}L=L.sort(function(a,b){return b-a;});L.forEach(function(l){s=E[l];if(s.length>1){S=[];p=s.shift();while(p){if(S.indexOf(p)<0){S.push(p);}s.forEach(function(o){if(p.containsChildren(o)){S.push(o);}});p=s.shift();}f=f.concat(S);}else{f=f.concat(s);}});return f;};
sap.suite.ui.commons.ProcessFlow.InternalMatrixCalculation.prototype.calculatePathInMatrix=function(o){var c=null;for(var k in this.nodePositions){if(this.nodePositions.hasOwnProperty(k)){c=this.nodePositions[k];var C=c.c.oNode.getChildren();for(var i=0;C&&i<C.length;i++){var s=sap.suite.ui.commons.ProcessFlow._getChildIdByElement(C[i]);var p=this.nodePositions[s];o=this.calculateSingleNodeConnection(c,p,c.x,c.y,p.x,p.y,o);}}}return o;};
sap.suite.ui.commons.ProcessFlow.InternalMatrixCalculation.prototype.calculateSingleNodeConnection=function(n,a,p,b,c,d,o){var h=d-b;var v=c-p;if(h<0){var e=["Problem with negative horizontal movement","Parent node is "+n.c.toString(),"Children node is "+a.c.toString(),"Coordinates : '"+p+"','"+b+"','"+c+"','"+d+"'"];throw e;}else if(v<=-1){var N=this.checkIfHorizontalLinePossible(o,c,b+2,d);var y=d-1;if(N){y=b+1;}var x=p;if(N){x=c;}o[p][y]=this.createConnectionElement(o[p][y],sap.suite.ui.commons.ProcessFlow.cellEdgeConstants.LU,n,a,false);o=this.writeVerticalLine(o,p,c,y,n,a);o[c][y]=this.createConnectionElement(o[c][y],sap.suite.ui.commons.ProcessFlow.cellEdgeConstants.UR,n,a,(y==d-1));var s=b+2;var f=d;if(!N){s=b+1;f=y+1;}o=this.writeHorizontalLine(o,x,s,f,n,a);}else if(v===0){o=this.writeHorizontalLine(o,p,b+1,d,n,a);}else if(v===1){o[p][b+1]=this.createConnectionElement(o[p][b+1],sap.suite.ui.commons.ProcessFlow.cellEdgeConstants.LD,n,a,false);o[c][b+1]=this.createConnectionElement(o[c][b+1],sap.suite.ui.commons.ProcessFlow.cellEdgeConstants.DR,n,a,(b+1)===(d-1));o=this.writeHorizontalLine(o,c,b+2,d,n,a);}else{o[p][b+1]=this.createConnectionElement(o[p][b+1],sap.suite.ui.commons.ProcessFlow.cellEdgeConstants.LD,n,a,false);o=this.writeVerticalLine(o,c,p,b+1,n,a);o[c][b+1]=this.createConnectionElement(o[c][b+1],sap.suite.ui.commons.ProcessFlow.cellEdgeConstants.DR,n,a,(b+1)===(d-1));o=this.writeHorizontalLine(o,c,b+2,d,n,a);}return o;};
sap.suite.ui.commons.ProcessFlow.InternalMatrixCalculation.prototype.writeVerticalLine=function(o,f,l,c,n,a){for(var j=f-1;j>l;j--){o[j][c]=this.createConnectionElement(o[j][c],sap.suite.ui.commons.ProcessFlow.cellEdgeConstants.DU,n,a,false);}return o;};
sap.suite.ui.commons.ProcessFlow.InternalMatrixCalculation.prototype.checkIfHorizontalLinePossible=function(o,r,f,l){var L=true;for(var i=f;i<l;i++){if(o[r][i]instanceof sap.suite.ui.commons.ProcessFlow.NodeElement){L=false;break;}}return L;};
sap.suite.ui.commons.ProcessFlow.InternalMatrixCalculation.prototype.writeHorizontalLine=function(o,r,f,l,n,a){var p=(r==a.x);if(!p){l--;}for(var i=f;i<l;i++){o[r][i]=this.createConnectionElement(o[r][i],sap.suite.ui.commons.ProcessFlow.cellEdgeConstants.LR,n,a,(i==(l-1))&&p);}return o;};
sap.suite.ui.commons.ProcessFlow.InternalMatrixCalculation.prototype.createConnectionElement=function(o,a,i,t,A){var b=o;if(!b){b=new sap.suite.ui.commons.ProcessFlowConnection();}if(b instanceof sap.suite.ui.commons.ProcessFlowConnection){var d=this._calculateConnectionDisplayStateBySourceAndTargetNode(i.c.oNode,t.c.oNode);var c={flowLine:a,targetNodeState:t.c.state,displayState:d,hasArrow:A};b.addConnectionData(c);}return b;};
sap.suite.ui.commons.ProcessFlow.InternalMatrixCalculation.prototype._calculateConnectionDisplayStateBySourceAndTargetNode=function(s,t){var S=s.getHighlighted();var b=s.getSelected();var a=s._getDimmed();var T=t.getHighlighted();var c=t.getSelected();var d=t._getDimmed();var e=sap.suite.ui.commons.ProcessFlowDisplayState.Regular;if(b&&c){e=sap.suite.ui.commons.ProcessFlowDisplayState.Selected;}else if(S&&T){e=sap.suite.ui.commons.ProcessFlowDisplayState.Highlighted;}else if((a||d)||S&&c||b&&T){e=sap.suite.ui.commons.ProcessFlowDisplayState.Dimmed;}return e;};
sap.suite.ui.commons.ProcessFlow.cellEdgeConstants={'LU':'tl','LD':'lb','DU':'tb','LR':'rl','DR':'rt','UR':'rb'};
sap.suite.ui.commons.ProcessFlow.prototype.addNode=function(a){return this.addAggregation("nodes",a,false);};
sap.suite.ui.commons.ProcessFlow.prototype.setZoomLevel=function(z){var $=this.$("scrollContainer");var s;var S;if($.context){s={scrollWidth:$.context.scrollWidth,scrollHeight:$.context.scrollHeight,scrollLeft:$.context.scrollLeft,scrollTop:$.context.scrollTop};S=s;if(this._zoomLevel===z){this._isInitialZoomLevelNeeded=false;return;}}if(!(z in sap.suite.ui.commons.ProcessFlowZoomLevel)){this._handleException("\""+z+"\" is not a valid entry of the enumeration for property zoom level of ProcessFlow");return;}this._zoomLevel=z;if(this._isInitialZoomLevelNeeded){this._isInitialZoomLevelNeeded=false;this.invalidate();}else{this.rerender();}if(s){if(sap.ui.Device.support.touch||jQuery.sap.simulateMobileOnDesktop){var h=parseInt(this.$("scrollContainer").css("height").slice(0,-2),10);var w=parseInt(this.$("scrollContainer").css("width").slice(0,-2),10);var i=this.$("scrollContainer")[0].scrollHeight;var a=this.$("scrollContainer")[0].scrollWidth;if(this.getScrollable()&&(i>h||a>w)){this._switchCursors(this.$("scrollContainer"),this._defaultCursorClass,this._grabCursorClass);this.$("scrollContainer").css("overflow","auto");}}$=this.$("scrollContainer");S=this._getScrollContainerOnZoomChanged(s,$);$.scrollLeft(S.scrollLeft);$.scrollTop(S.scrollTop);this._adjustAndShowArrow();if(this._isFocusChanged){this._setFocusToNode();this._isFocusChanged=false;}}};
sap.suite.ui.commons.ProcessFlow.prototype.getZoomLevel=function(){return this._zoomLevel;};
sap.suite.ui.commons.ProcessFlow.prototype.zoomOut=function(){var c=this.getZoomLevel();var n=c;switch(c){case(sap.suite.ui.commons.ProcessFlowZoomLevel.One):n=sap.suite.ui.commons.ProcessFlowZoomLevel.Two;break;case(sap.suite.ui.commons.ProcessFlowZoomLevel.Two):n=sap.suite.ui.commons.ProcessFlowZoomLevel.Three;break;case(sap.suite.ui.commons.ProcessFlowZoomLevel.Three):n=sap.suite.ui.commons.ProcessFlowZoomLevel.Four;break;}this.setZoomLevel(n);return this.getZoomLevel();};
sap.suite.ui.commons.ProcessFlow.prototype.zoomIn=function(){var c=this.getZoomLevel();var n=c;switch(c){case(sap.suite.ui.commons.ProcessFlowZoomLevel.Four):n=sap.suite.ui.commons.ProcessFlowZoomLevel.Three;break;case(sap.suite.ui.commons.ProcessFlowZoomLevel.Three):n=sap.suite.ui.commons.ProcessFlowZoomLevel.Two;break;case(sap.suite.ui.commons.ProcessFlowZoomLevel.Two):n=sap.suite.ui.commons.ProcessFlowZoomLevel.One;break;}this.setZoomLevel(n);return this.getZoomLevel();};
sap.suite.ui.commons.ProcessFlow.prototype.updateModel=function(){var n=this.getNodes();var t=this;n.forEach(function(t){t._mergedLaneId=false;});var l=this.getLanes();var t=this;l.forEach(function(t){t._mergedLanePosition=false;});this._internalLanes=[];if(this._isHeaderMode()){var a=this.getBindingInfo("lanes");this.getModel(a.model).refresh();}else{var b=this.getBindingInfo("nodes");this.getModel(b.model).refresh();}this.rerender();};
sap.suite.ui.commons.ProcessFlow.prototype.updateNodesOnly=function(){var n=this.getBindingInfo("nodes");this.getModel(n.model).refresh();this.rerender();};
sap.suite.ui.commons.ProcessFlow.prototype.getFocusedNode=function(){if(this._lastNavigationFocusNode.sId){return this._lastNavigationFocusNode.sId;}};
sap.suite.ui.commons.ProcessFlow.prototype.ontouchend=function(e){if(e.target&&e.target.id.indexOf("arrowScroll")!=-1){this._onArrowClick(e);}else{if(!sap.ui.Device.support.touch&&!jQuery.sap.simulateMobileOnDesktop){this.onAfterRendering();}else{this._adjustAndShowArrow();}if(e===null||e.oSource===undefined){return false;}e.preventDefault();if(this&&this._isHeaderMode()){this._internalLanes=[];this.fireHeaderPress(this);}}return false;};
sap.suite.ui.commons.ProcessFlow.prototype._isHeaderMode=function(){var n=this.getNodes();return!n||(n.length===0);};
sap.suite.ui.commons.ProcessFlow.prototype._switchCursors=function($,c,C){if($.hasClass(c)){$.removeClass(c);}if(!$.hasClass(C)){$.addClass(C);}};
sap.suite.ui.commons.ProcessFlow.prototype._clearHandlers=function($){$.bind(this._mousePreventEvents,jQuery.proxy(this._handlePrevent,this));};
sap.suite.ui.commons.ProcessFlow.prototype._handlePrevent=function(e){if(e&&!e.isDefaultPrevented()){e.preventDefault();}if(e&&!e.isPropagationStopped()){e.stopPropagation();}if(e&&!e.isImmediatePropagationStopped()){e.stopImmediatePropagation();}};
sap.suite.ui.commons.ProcessFlow.prototype.onAfterRendering=function(){var s=false,$=this.$("scroll-content"),h,w,S,i;this._checkOverflow(this.getDomRef("scrollContainer"),this.$());this.nCursorXPosition=0;this.nCursorYPosition=0;if($&&$.length){this.$("scrollContainer").find('.sapSuiteUiCommonsProcessFlowNode .sapUiIcon').css("cursor","inherit");if(this.getScrollable()){h=parseInt(this.$("scrollContainer").css("height").slice(0,-2),10);w=parseInt(this.$("scrollContainer").css("width").slice(0,-2),10);i=$[0].scrollHeight;S=$[0].scrollWidth;if(i<=h&&S<=w){this._clearHandlers(this.$("scrollContainer"));this._switchCursors(this.$("scrollContainer"),this._grabCursorClass,this._defaultCursorClass);}else{this._switchCursors(this.$("scrollContainer"),this._defaultCursorClass,this._grabCursorClass);s=true;}}else{this._clearHandlers(this.$("scrollContainer"));this._switchCursors(this.$("scrollContainer"),this._grabCursorClass,this._defaultCursorClass);$.css("position","static");}if(s){if(!this._iInitialArrowTop||!this._iInitialCounterTop){this._iInitialArrowTop=parseInt(this.$("arrowScrollRight").css("top"),10);this._iInitialCounterTop=parseInt(this.$("counterRight").css("top"),10);}if(sap.ui.Device.os.windows&&sap.ui.Device.system.combi&&sap.ui.Device.browser.chrome){this.$("scrollContainer").bind(this._mouseEvents,jQuery.proxy(this._registerMouseEvents,this));this.$("scrollContainer").css("overflow","auto");}else if(sap.ui.Device.os.windows&&sap.ui.Device.system.combi&&sap.ui.Device.browser.msie&&(sap.ui.Device.browser.version>9)){this.$("scrollContainer").bind(this._mouseEvents,jQuery.proxy(this._registerMouseEvents,this));this.$("scrollContainer").css("overflow","auto");this.$("scrollContainer").css("-ms-overflow-style","none");}else if(!sap.ui.Device.support.touch&&!jQuery.sap.simulateMobileOnDesktop){this.$("scrollContainer").bind(this._mouseEvents,jQuery.proxy(this._registerMouseEvents,this));}else{this._clearHandlers(this.$("scrollContainer"));this.$("scrollContainer").css("overflow","auto");}}else{if(this._bDoScroll){this.$("scrollContainer").css("overflow","auto");}else{this.$("scrollContainer").css("overflow","hidden");}}if(this.getWheelZoomable()&&sap.ui.Device.system.desktop&&!this._isHeaderMode()){this.$("scrollContainer").bind(this._mouseWheelEvent,jQuery.proxy(this._registerMouseWheel,this));}if(this._bDoScroll){this.$("scrollContainer").bind("scroll",jQuery.proxy(this._onScroll,this));}this._resizeRegId=sap.ui.core.ResizeHandler.register(this,jQuery.proxy(sap.suite.ui.commons.ProcessFlow.prototype._onResize,this));if(this._isInitialZoomLevelNeeded){this._initZoomLevel();}if(this._headerHasFocus){this._headerHasFocus=false;var a=this.$("scroll-content").children().children().children(1).children("td[tabindex='0']").first().children();var n=sap.ui.getCore().byId(a[0].id);this._changeNavigationFocus(null,n);}}};
sap.suite.ui.commons.ProcessFlow.prototype._initZoomLevel=function(){if(this.$()){var w=this.$().width();if(w){if(w<sap.m.ScreenSizes.tablet){this.setZoomLevel(sap.suite.ui.commons.ProcessFlowZoomLevel.Four);}else if(w<sap.m.ScreenSizes.desktop){this.setZoomLevel(sap.suite.ui.commons.ProcessFlowZoomLevel.Three);}else{this.setZoomLevel(sap.suite.ui.commons.ProcessFlowZoomLevel.Two);}}}};
sap.suite.ui.commons.ProcessFlow.prototype._registerMouseWheel=function(e){var d=e.originalEvent.wheelDelta||-e.originalEvent.detail;if(d===0){d=-e.originalEvent.deltaY;}var t=this;if(e&&!e.isDefaultPrevented()){e.preventDefault();e.originalEvent.returnValue=false;}var w=300;var a=function(){var b=new Date()-t._wheelTimestamp;if(b<w){t._wheelTimeout=jQuery.sap.delayedCall(w-b,t,a);}else{t._wheelTimeout=null;t._wheelCalled=false;}};if(!t._wheelCalled){t._wheelCalled=true;if(d<0){this._isFocusChanged=true;t.zoomOut();}else{this._isFocusChanged=true;t.zoomIn();}}if(!t._wheelTimeout){t._wheelTimestamp=new Date();t._wheelTimeout=jQuery.sap.delayedCall(w,t,a);}if(e&&!e.isPropagationStopped()){e.stopPropagation();}if(e&&!e.isImmediatePropagationStopped()){e.stopImmediatePropagation();}};
sap.suite.ui.commons.ProcessFlow.prototype._registerMouseEvents=function(e){if(e&&!e.isDefaultPrevented()){e.preventDefault();}switch(e.type){case'mousemove':if(this.$("scrollContainer").hasClass(this._grabbingCursorClass)){if(sap.ui.getCore().getConfiguration().getRTL()){this.$("scrollContainer").scrollLeftRTL(this.nCursorXPosition-e.pageX);}else{this.$("scrollContainer").scrollLeft(this.nCursorXPosition-e.pageX);}this.$("scrollContainer").scrollTop(this.nCursorYPosition-e.pageY);this._adjustAndShowArrow();}break;case'mousedown':this._switchCursors(this.$("scrollContainer"),this._defaultCursorClass,this._grabbingCursorClass);if(sap.ui.getCore().getConfiguration().getRTL()){this.nCursorXPosition=this.$("scrollContainer").scrollLeftRTL()+e.pageX;}else{this.nCursorXPosition=this.$("scrollContainer").scrollLeft()+e.pageX;}this.nCursorYPosition=this.$("scrollContainer").scrollTop()+e.pageY;if(sap.ui.Device.system.combi){this._iTouchStartScrollLeft=this.$("scrollContainer").scrollLeft();if(this.getScrollable()){this._iTouchStartScrollTop=this.$("scrollContainer").scrollTop();}}break;case'mouseup':this._switchCursors(this.$("scrollContainer"),this._grabbingCursorClass,this._grabCursorClass);break;case'mouseleave':this.$("scrollContainer").removeClass(this._grabbingCursorClass);this.$("scrollContainer").removeClass(this._grabCursorClass);this.$("scrollContainer").addClass(this._defaultCursorClass);break;case'mouseenter':this.$("scrollContainer").removeClass(this._defaultCursorClass);if(e.buttons===null){if(e.which===1){this.$("scrollContainer").addClass(this._grabbingCursorClass);}else{this.$("scrollContainer").addClass(this._grabCursorClass);}}else{if(e.buttons===0){this.$("scrollContainer").addClass(this._grabCursorClass);}else if(e.buttons===1){this.$("scrollContainer").addClass(this._grabbingCursorClass);}}break;}if(e.target&&e.target.parentElement&&e.target.parentElement.parentElement&&e.target.parentElement.parentElement instanceof sap.suite.ui.commons.ProcessFlowConnectionLabel){if(e&&!e.isPropagationStopped()){e.stopPropagation();}if(e&&!e.isImmediatePropagationStopped()){e.stopImmediatePropagation();}}};
sap.suite.ui.commons.ProcessFlow.prototype._onResize=function(){var a=new Date().getTime();if(!this._iLastResizeEventTime||((a-this._iLastResizeEventTime)<50)){if(!this._iLastResizeHandlingTime||(a-this._iLastResizeHandlingTime>500)){this.onAfterRendering();this._iLastResizeHandlingTime=new Date().getTime();}}else{this._iLastResizeHandlingTime=null;}this._iLastResizeEventTime=new Date().getTime();};
sap.suite.ui.commons.ProcessFlow._enumMoveDirection={'LEFT':'left','RIGHT':'right','UP':'up','DOWN':'down'};
sap.suite.ui.commons.ProcessFlow.prototype._setFocusToNode=function(n){if(n){if(n instanceof sap.suite.ui.commons.ProcessFlowNode){jQuery("#"+n.sId).parent().focus();n._setNavigationFocus(true);n.rerender();}else if(n instanceof sap.suite.ui.commons.ProcessFlowConnectionLabel){n.$().focus();n._setNavigationFocus(true);}}else if(this._lastNavigationFocusNode){if(this._lastNavigationFocusNode instanceof sap.suite.ui.commons.ProcessFlowNode){jQuery("#"+this._lastNavigationFocusNode.sId).parent().focus();this._lastNavigationFocusNode._setNavigationFocus(true);this._lastNavigationFocusNode.rerender();}else if(this._lastNavigationFocusNode instanceof sap.suite.ui.commons.ProcessFlowConnectionLabel){this._lastNavigationFocusNode.$().focus();this._lastNavigationFocusNode._setNavigationFocus(true);}}};
sap.suite.ui.commons.ProcessFlow.prototype._changeNavigationFocus=function(n,N){if(n&&N&&(n.getId()!==N.getId())){jQuery.sap.log.debug("Rerendering PREVIOUS node with id '"+n.getId()+"' navigation focus : "+n._getNavigationFocus());n._setNavigationFocus(false);if(n instanceof sap.suite.ui.commons.ProcessFlowNode){n.rerender();}}if(N){jQuery.sap.log.debug("Rerendering CURRENT node with id '"+N.getId()+"' navigation focus : "+N._getNavigationFocus());N._setNavigationFocus(true);if(N instanceof sap.suite.ui.commons.ProcessFlowNode){N.rerender();}this._lastNavigationFocusNode=N;this._onFocusChanged();}};
sap.suite.ui.commons.ProcessFlow.prototype._moveOnePage=function(d,a){d=d||sap.suite.ui.commons.ProcessFlow._enumMoveDirection.UP;a=a||false;var o=0,b=0;var n=0,c=0;var e=0;var N=false;for(var i=0;i<this._internalCalcMatrix.length;i++){for(var j=0;j<this._internalCalcMatrix[i].length;j++){if(this._internalCalcMatrix[i][j]instanceof sap.suite.ui.commons.ProcessFlowNode&&this._internalCalcMatrix[i][j]._getNavigationFocus()){o=i;b=j;break;}else if(this._internalCalcMatrix[i][j]instanceof sap.suite.ui.commons.ProcessFlowConnection){var l=this._internalCalcMatrix[i][j]._getVisibleLabel();if(l&&l._getNavigationFocus()){o=i;b=j;break;}}}}if(a){if(d==sap.suite.ui.commons.ProcessFlow._enumMoveDirection.UP){for(var j=b-1;j>=0&&e<this._jumpOverElements;j--){if(this._internalCalcMatrix[o][j]instanceof sap.suite.ui.commons.ProcessFlowNode&&(!this._bHighlightedMode||this._internalCalcMatrix[o][j].getHighlighted())){e++;n=o;c=j;N=true;}else if(this._internalCalcMatrix[o][j]instanceof sap.suite.ui.commons.ProcessFlowConnection){var l=this._internalCalcMatrix[o][j]._getVisibleLabel();if(l&&l.getEnabled()){e++;n=o;c=j;N=true;}}}}else if(d===sap.suite.ui.commons.ProcessFlow._enumMoveDirection.DOWN){for(var j=b+1;j<this._internalCalcMatrix[o].length&&e<this._jumpOverElements;j++){if(this._internalCalcMatrix[o][j]instanceof sap.suite.ui.commons.ProcessFlowNode&&(!this._bHighlightedMode||this._internalCalcMatrix[o][j].getHighlighted())){e++;n=o;c=j;N=true;}else if(this._internalCalcMatrix[o][j]instanceof sap.suite.ui.commons.ProcessFlowConnection){var l=this._internalCalcMatrix[o][j]._getVisibleLabel();if(l&&l.getEnabled()){e++;n=o;c=j;N=true;}}}}}else{if(d==sap.suite.ui.commons.ProcessFlow._enumMoveDirection.UP){for(var i=o-1;i>=0&&e<this._jumpOverElements;i--){if(this._internalCalcMatrix[i][b]instanceof sap.suite.ui.commons.ProcessFlowNode&&(!this._bHighlightedMode||this._internalCalcMatrix[i][b].getHighlighted())){e++;n=i;c=b;N=true;}else if(this._internalCalcMatrix[i][b]instanceof sap.suite.ui.commons.ProcessFlowConnection){var l=this._internalCalcMatrix[i][b]._getVisibleLabel();if(l&&l.getEnabled()){e++;n=i;c=b;N=true;}}}}else if(d===sap.suite.ui.commons.ProcessFlow._enumMoveDirection.DOWN){for(var i=o+1;i<this._internalCalcMatrix.length&&e<this._jumpOverElements;i++){if(this._internalCalcMatrix[i][b]instanceof sap.suite.ui.commons.ProcessFlowNode&&(!this._bHighlightedMode||this._internalCalcMatrix[i][b].getHighlighted())){e++;n=i;c=b;N=true;}else if(this._internalCalcMatrix[i][b]instanceof sap.suite.ui.commons.ProcessFlowConnection){var l=this._internalCalcMatrix[i][b]._getVisibleLabel();if(l&&l.getEnabled()){e++;n=i;c=b;N=true;}}}}}if(N){if(this._internalCalcMatrix[o][b]instanceof sap.suite.ui.commons.ProcessFlowConnection){this._internalCalcMatrix[o][b]._getVisibleLabel()._setNavigationFocus(false);}else{this._internalCalcMatrix[o][b]._setNavigationFocus(false);}if(this._internalCalcMatrix[n][c]instanceof sap.suite.ui.commons.ProcessFlowConnection){var l=this._internalCalcMatrix[n][c]._getVisibleLabel();l._setNavigationFocus(true);this._lastNavigationFocusNode=l;}else{this._internalCalcMatrix[n][c]._setNavigationFocus(true);this._lastNavigationFocusNode=this._internalCalcMatrix[n][c];}}return N;};
sap.suite.ui.commons.ProcessFlow.prototype._moveHomeEnd=function(d,c){d=d||sap.suite.ui.commons.ProcessFlow._enumMoveDirection.RIGHT;c=c||false;var o=0,a=0;var n=0,b=0;var N=false;for(var i=0;i<this._internalCalcMatrix.length;i++){for(var j=0;j<this._internalCalcMatrix[i].length;j++){if(this._internalCalcMatrix[i][j]instanceof sap.suite.ui.commons.ProcessFlowNode&&this._internalCalcMatrix[i][j]._getNavigationFocus()){o=i;a=j;break;}else if(this._internalCalcMatrix[i][j]instanceof sap.suite.ui.commons.ProcessFlowConnection){var l=this._internalCalcMatrix[i][j]._getVisibleLabel();if(l&&l._getNavigationFocus()){o=i;a=j;break;}}}}if(c){if(d==sap.suite.ui.commons.ProcessFlow._enumMoveDirection.LEFT){for(var i=0;i<o;i++){if(this._internalCalcMatrix[i][a]instanceof sap.suite.ui.commons.ProcessFlowNode&&(!this._bHighlightedMode||this._internalCalcMatrix[i][a].getHighlighted())){n=i;b=a;N=true;break;}else if(this._internalCalcMatrix[i][a]instanceof sap.suite.ui.commons.ProcessFlowConnection){var l=this._internalCalcMatrix[i][a]._getVisibleLabel();if(l&&l.getEnabled()){n=i;b=a;N=true;break;}}}}else if(d===sap.suite.ui.commons.ProcessFlow._enumMoveDirection.RIGHT){for(var i=this._internalCalcMatrix.length-1;i>o;i--){if(this._internalCalcMatrix[i][a]instanceof sap.suite.ui.commons.ProcessFlowNode&&(!this._bHighlightedMode||this._internalCalcMatrix[i][a].getHighlighted())){n=i;b=a;N=true;break;}else if(this._internalCalcMatrix[i][a]instanceof sap.suite.ui.commons.ProcessFlowConnection){var l=this._internalCalcMatrix[i][a]._getVisibleLabel();if(l&&l.getEnabled()){n=i;b=a;N=true;break;}}}}}else{if(d==sap.suite.ui.commons.ProcessFlow._enumMoveDirection.LEFT){for(var j=0;j<a;j++){if(this._internalCalcMatrix[o][j]instanceof sap.suite.ui.commons.ProcessFlowNode&&(!this._bHighlightedMode||this._internalCalcMatrix[o][j].getHighlighted())){n=o;b=j;N=true;break;}else if(this._internalCalcMatrix[o][j]instanceof sap.suite.ui.commons.ProcessFlowConnection){var l=this._internalCalcMatrix[o][j]._getVisibleLabel();if(l&&l.getEnabled()){n=o;b=j;N=true;break;}}}}else if(d===sap.suite.ui.commons.ProcessFlow._enumMoveDirection.RIGHT){for(var j=this._internalCalcMatrix[o].length-1;j>a;j--){if(this._internalCalcMatrix[o][j]instanceof sap.suite.ui.commons.ProcessFlowNode&&(!this._bHighlightedMode||this._internalCalcMatrix[o][j].getHighlighted())){n=o;b=j;N=true;break;}else if(this._internalCalcMatrix[o][j]instanceof sap.suite.ui.commons.ProcessFlowConnection){var l=this._internalCalcMatrix[o][j]._getVisibleLabel();if(l&&l.getEnabled()){n=o;b=j;N=true;break;}}}}}if(N){if(this._internalCalcMatrix[o][a]instanceof sap.suite.ui.commons.ProcessFlowConnection){this._internalCalcMatrix[o][a]._getVisibleLabel()._setNavigationFocus(false);}else{this._internalCalcMatrix[o][a]._setNavigationFocus(false);}if(this._internalCalcMatrix[n][b]instanceof sap.suite.ui.commons.ProcessFlowConnection){var l=this._internalCalcMatrix[n][b]._getVisibleLabel();l._setNavigationFocus(true);this._lastNavigationFocusNode=l;}else{this._internalCalcMatrix[n][b]._setNavigationFocus(true);this._lastNavigationFocusNode=this._internalCalcMatrix[n][b];}}return N;};
sap.suite.ui.commons.ProcessFlow.prototype._moveToNextNode=function(d,s){d=d||sap.suite.ui.commons.ProcessFlow._enumMoveDirection.RIGHT;if(sap.ui.getCore().getConfiguration().getRTL()){if(d===sap.suite.ui.commons.ProcessFlow._enumMoveDirection.RIGHT){d=sap.suite.ui.commons.ProcessFlow._enumMoveDirection.LEFT;}else if(d===sap.suite.ui.commons.ProcessFlow._enumMoveDirection.LEFT){d=sap.suite.ui.commons.ProcessFlow._enumMoveDirection.RIGHT;}}s=s||1;var f=false;var n=false;var o=0,a=1;if(!this._internalCalcMatrix){return;}var p=0,b=0;for(var i=0;i<this._internalCalcMatrix.length;i++){for(var j=0;j<this._internalCalcMatrix[i].length;j++){if(this._internalCalcMatrix[i][j]){if(this._internalCalcMatrix[i][j]instanceof sap.suite.ui.commons.ProcessFlowNode&&this._internalCalcMatrix[i][j]._getNavigationFocus()){o=p=i;a=b=j;f=true;break;}else if(this._internalCalcMatrix[i][j]instanceof sap.suite.ui.commons.ProcessFlowConnection){var l=this._internalCalcMatrix[i][j]._getVisibleLabel();if(l&&l._getNavigationFocus()&&l.getEnabled()){o=p=i;a=b=j;f=true;break;}}}}if(f){break;}}if(d==sap.suite.ui.commons.ProcessFlow._enumMoveDirection.RIGHT){for(var i=p;i<this._internalCalcMatrix.length;i++){for(var j=b+1;j<this._internalCalcMatrix[i].length;j++){if(this._internalCalcMatrix[i][j]instanceof sap.suite.ui.commons.ProcessFlowNode){if(f&&(!this._bHighlightedMode||this._internalCalcMatrix[i][j].getHighlighted())){this._internalCalcMatrix[i][j]._setNavigationFocus(true);this._lastNavigationFocusNode=this._internalCalcMatrix[i][j];n=true;break;}}else if(this._internalCalcMatrix[i][j]instanceof sap.suite.ui.commons.ProcessFlowConnection){var l=this._internalCalcMatrix[i][j]._getVisibleLabel();if(l&&f&&l.getEnabled()){l._setNavigationFocus(true);this._lastNavigationFocusNode=l;n=true;break;}}}b=0;if(n){break;}}}if(d==sap.suite.ui.commons.ProcessFlow._enumMoveDirection.LEFT){for(var i=p;i>=0;i--){for(var j=b-1;j>=0;j--){if(this._internalCalcMatrix[i][j]instanceof sap.suite.ui.commons.ProcessFlowNode){if(f&&(!this._bHighlightedMode||this._internalCalcMatrix[i][j].getHighlighted())){this._lastNavigationFocusNode=this._internalCalcMatrix[i][j]._setNavigationFocus(true);this._lastNavigationFocusNode=this._internalCalcMatrix[i][j];n=true;break;}}else if(this._internalCalcMatrix[i][j]instanceof sap.suite.ui.commons.ProcessFlowConnection){var l=this._internalCalcMatrix[i][j]._getVisibleLabel();if(l&&f&&l.getEnabled()){l._setNavigationFocus(true);this._lastNavigationFocusNode=l;n=true;break;}}}if(i>0){b=this._internalCalcMatrix[i-1].length;}if(n){break;}}}var c,y,e;if(d==sap.suite.ui.commons.ProcessFlow._enumMoveDirection.UP){for(var i=p-1;i>=0;i--){c=0;while(!n){y=b-c;e=b+c;if(y>=0&&this._internalCalcMatrix[i][y]instanceof sap.suite.ui.commons.ProcessFlowNode){if(f&&(!this._bHighlightedMode||this._internalCalcMatrix[i][y].getHighlighted())){this._internalCalcMatrix[i][y]._setNavigationFocus(true);this._lastNavigationFocusNode=this._internalCalcMatrix[i][y];n=true;break;}}else if(y>=0&&this._internalCalcMatrix[i][y]instanceof sap.suite.ui.commons.ProcessFlowConnection){var l=this._internalCalcMatrix[i][y]._getVisibleLabel();if(l&&f&&l.getEnabled()){l._setNavigationFocus(true);this._lastNavigationFocusNode=l;n=true;break;}}if(e<this._internalCalcMatrix[i].length&&this._internalCalcMatrix[i][e]instanceof sap.suite.ui.commons.ProcessFlowNode){if(f&&(!this._bHighlightedMode||this._internalCalcMatrix[i][e].getHighlighted())){this._internalCalcMatrix[i][e]._setNavigationFocus(true);this._lastNavigationFocusNode=this._internalCalcMatrix[i][e];n=true;break;}}else if(e>=0&&this._internalCalcMatrix[i][e]instanceof sap.suite.ui.commons.ProcessFlowConnection){var l=this._internalCalcMatrix[i][e]._getVisibleLabel();if(l&&f&&l.getEnabled()){l._setNavigationFocus(true);this._lastNavigationFocusNode=l;n=true;break;}}if(y<0&&e>this._internalCalcMatrix[i].length){break;}c++;}}}if(d==sap.suite.ui.commons.ProcessFlow._enumMoveDirection.DOWN){for(var i=p+1;i<this._internalCalcMatrix.length;i++){c=0;while(!n){y=b-c;e=b+c;if(y>=0&&this._internalCalcMatrix[i][y]instanceof sap.suite.ui.commons.ProcessFlowNode){if(f&&(!this._bHighlightedMode||this._internalCalcMatrix[i][y].getHighlighted())){this._lastNavigationFocusNode=this._internalCalcMatrix[i][y]._setNavigationFocus(true);this._lastNavigationFocusNode=this._internalCalcMatrix[i][y];n=true;break;}}else if(y>=0&&this._internalCalcMatrix[i][y]instanceof sap.suite.ui.commons.ProcessFlowConnection){var l=this._internalCalcMatrix[i][y]._getVisibleLabel();if(l&&f&&l.getEnabled()){l._setNavigationFocus(true);this._lastNavigationFocusNode=l;n=true;break;}}if(e<this._internalCalcMatrix[i].length&&this._internalCalcMatrix[i][e]instanceof sap.suite.ui.commons.ProcessFlowNode){if(f&&(!this._bHighlightedMode||this._internalCalcMatrix[i][e].getHighlighted())){this._lastNavigationFocusNode=this._internalCalcMatrix[i][e]._setNavigationFocus(true);this._lastNavigationFocusNode=this._internalCalcMatrix[i][e];n=true;break;}}else if(e>=0&&this._internalCalcMatrix[i][e]instanceof sap.suite.ui.commons.ProcessFlowConnection){var l=this._internalCalcMatrix[i][e]._getVisibleLabel();if(l&&f&&l.getEnabled()){l._setNavigationFocus(true);this._lastNavigationFocusNode=l;n=true;break;}}if(y<0&&e>this._internalCalcMatrix[i].length){break;}c++;}}}if(n){if(this._internalCalcMatrix[o][a]instanceof sap.suite.ui.commons.ProcessFlowNode){this._internalCalcMatrix[o][a]._setNavigationFocus(false);}else{this._internalCalcMatrix[o][a]._getVisibleLabel()._setNavigationFocus(false);}}return n;};
sap.suite.ui.commons.ProcessFlow.prototype._bNFocusOutside=false;sap.suite.ui.commons.ProcessFlow.prototype._bHighlightedMode=false;
sap.suite.ui.commons.ProcessFlow.prototype.onfocusin=function(e){if(this._isHeaderMode()){this._setFocusOnHeader(true);}else{if(this._bSetFocusOnce){this._bSetFocusOnce=false;if(!this._lastNavigationFocusNode){var $=this.$("scroll-content").children().children().children(1).children("td[tabindex='0']").first().children();var n=sap.ui.getCore().byId($[0].id);this._changeNavigationFocus(null,n);}else{this._changeNavigationFocus(null,this._lastNavigationFocusNode);}}}};
sap.suite.ui.commons.ProcessFlow.prototype.onfocusout=function(e){this._bSetFocusOnce=true;if(this._lastNavigationFocusNode&&this._lastNavigationFocusNode._getNavigationFocus()){this._lastNavigationFocusNode._setNavigationFocus(false);if(this._lastNavigationFocusNode instanceof sap.suite.ui.commons.ProcessFlowNode){this._lastNavigationFocusNode.rerender();}}jQuery.sap.log.info("focus out");};
sap.suite.ui.commons.ProcessFlow.prototype._getScrollContainerOnZoomChanged=function(s,$){s.scrollLeft=Math.round($.context.scrollWidth/s.scrollWidth*s.scrollLeft);s.scrollTop=Math.round($.context.scrollHeight/s.scrollHeight*s.scrollTop);s.scrollWidth=$.context.scrollWidth;s.scrollHeight=$.context.scrollHeight;return s;};
sap.suite.ui.commons.ProcessFlow.prototype._onFocusChanged=function(){var f=this._lastNavigationFocusNode,$=f?f.$():null,s,S,i,a,b,c,C,n,N,p,d,e,g,h,j,k,l=500;if(f&&this.getScrollable()){jQuery.sap.log.debug("The actually focused node is "+f.getId());if(f instanceof sap.suite.ui.commons.ProcessFlowConnectionLabel){n=$.parent().parent().parent().outerWidth();N=$.parent().parent().parent().outerHeight();p=$.parent().parent().parent().position();}else{n=$.outerWidth();N=$.outerHeight();p=$.position();}jQuery.sap.log.debug("Node outer width x height ["+n+" x "+N+"]");jQuery.sap.log.debug("Position of node in the content is ["+p.left+", "+p.top+"]");b=this.$("scroll-content");s=this.$("scrollContainer").innerWidth();S=this.$("scrollContainer").innerHeight();jQuery.sap.log.debug("Scroll container inner width x height ["+s+" x "+S+"]");i=this.$("scrollContainer").scrollLeft();a=this.$("scrollContainer").scrollTop();jQuery.sap.log.debug("Current scroll offset is ["+i+", "+a+"]");c=b.innerWidth();C=b.innerHeight();jQuery.sap.log.debug("Scroll content inner width x height ["+c+" x "+C+"]");d=-i+p.left;g=d+n;e=-a+p.top;h=e+N;if((g>s)||(d<0)||(h>S)||(e<0)){j=Math.round((s-n)/2);j=Math.max(s-c+p.left,j);j=Math.min(p.left,j);k=Math.round((S-N)/2);k=Math.max(S-C+p.top,k);k=Math.min(p.top,k);jQuery.sap.log.debug("Node lies outside the scroll container, scrolling from ["+d+","+e+"] to ["+j+","+k+"]");this._isFocusChanged=true;this.$("scrollContainer").animate({scrollTop:p.top-k,scrollLeft:p.left-j},l,"swing",jQuery.proxy(this._adjustAndShowArrow,this));}else{jQuery.sap.log.debug("Node lies inside the scroll container, no scrolling happens.");this._setFocusToNode(f);}}else{this._setFocusToNode(f);this._adjustAndShowArrow();}};
sap.suite.ui.commons.ProcessFlow.prototype.onsapplus=function(e){this._isFocusChanged=true;this.zoomIn();};
sap.suite.ui.commons.ProcessFlow.prototype.onsapminus=function(e){this._isFocusChanged=true;this.zoomOut();};
sap.suite.ui.commons.ProcessFlow.prototype.onsaptabnext=function(e){var n=true;var $=e.target;if(e.target&&e.target.childElementCount>0){$=e.target.childNodes[0];}var a=sap.ui.getCore().byId($.id);if(a&&!(a instanceof sap.suite.ui.commons.ProcessFlowNode)&&!(a instanceof sap.suite.ui.commons.ProcessFlowConnectionLabel)){if(!this._isHeaderMode()&&!this._lastNavigationFocusNode){var b=this.$("scroll-content").children().children().children(1).children("td[tabindex='0']").first().children();var N=sap.ui.getCore().byId(b[0].id);this._changeNavigationFocus(null,N);n=false;}else if(this._lastNavigationFocusNode){this._changeNavigationFocus(null,this._lastNavigationFocusNode);n=false;}}if(this._isHeaderMode()&&n){if(!this._headerHasFocus){this._setFocusOnHeader(true);}else{this._setFocusOnHeader(false);}}else{if((this._lastNavigationFocusNode instanceof sap.suite.ui.commons.ProcessFlowNode)||(this._lastNavigationFocusNode instanceof sap.suite.ui.commons.ProcessFlowConnectionLabel)){this._lastNavigationFocusNode.rerender();}}if(n){var o=this.$().nextAll().find(":focusable").first();if(o.length===0){s.bind(this)();}o.focus();jQuery.sap.log.debug("saptabnext: Keyboard focus has been changed to element:  id='"+o.id+"' outerHTML='"+n.outerHTML+"'");o=null;}e.preventDefault();function s(){var c=this.$().parent();do{o=c.next(":focusable");if(o.length===0){o=c.nextAll().find(":focusable").first();}c=c.parent();}while((c.length!==0)&&(o.length===0));return;}};
sap.suite.ui.commons.ProcessFlow.prototype.onsaptabprevious=function(e){var p=null;var $=e.target;if((!this._lastNavigationFocusNode||!this._lastNavigationFocusNode._getNavigationFocus())&&e.target&&e.target.childElementCount>0){$=e.target.childNodes[0];}var a=sap.ui.getCore().byId($.id);if(a&&((a instanceof sap.suite.ui.commons.ProcessFlowNode)||(a instanceof sap.suite.ui.commons.ProcessFlowConnection))){if(!this._isHeaderMode()&&!this._lastNavigationFocusNode){var b=this.$("scroll-content").children().children().children(1).children("td[tabindex='0']").first().children();var n=sap.ui.getCore().byId(b[0].id);this._changeNavigationFocus(null,n);}else if(this._lastNavigationFocusNode){this._changeNavigationFocus(null,this._lastNavigationFocusNode);e.preventDefault();return;}}if(this._isHeaderMode()){if(!this._headerHasFocus){this._setFocusOnHeader(true);}else{this._setFocusOnHeader(false);p=this.$().prevAll().find(":focusable").first();}}else{p=this.$().prev(":focusable");if(p.length===0){p=this.$().prevAll().find(":focusable").first();}if(this._lastNavigationFocusNode){this._lastNavigationFocusNode._setNavigationFocus(false);}if(this._lastNavigationFocusNode instanceof sap.suite.ui.commons.ProcessFlowNode){this._lastNavigationFocusNode.rerender();}}if(p){if(p.length===0){s.bind(this)();}else if(p.first().length!==0){p=jQuery(p.first());}p.focus();jQuery.sap.log.debug("saptabnext: Keyboard focus has been set on element:  id='"+p.id+"' outerHTML='"+p.outerHTML+"'");p=null;}e.preventDefault();function s(){var c=this.$();do{p=c.prev(":focusable");if(p.length===0){p=c.prevAll().find(":focusable").last();}c=c.parent();}while((c.length!==0)&&(p.length===0));return;}};
sap.suite.ui.commons.ProcessFlow.prototype.onsapselect=function(e){if(this._isHeaderMode()){this._internalLanes=[];this.fireHeaderPress(this);var $=this.$("scroll-content").children().children().children(1).children("td[tabindex='0']").first().children();var n=sap.ui.getCore().byId($[0].id);this._changeNavigationFocus(null,n);}else{if(this._lastNavigationFocusNode instanceof sap.suite.ui.commons.ProcessFlowNode&&this._lastNavigationFocusNode._getNavigationFocus()){this.fireNodePress(this._lastNavigationFocusNode);}}};
sap.suite.ui.commons.ProcessFlow.prototype.onkeydown=function(e){var k=(e.keyCode?e.keyCode:e.which);jQuery.sap.log.debug("ProcessFlow::keyboard input has been catched and action going to start: keycode="+k);var E=false;var c=e.ctrlKey;var a=e.altKey;var p=this._lastNavigationFocusNode;switch(k){case jQuery.sap.KeyCodes.ARROW_RIGHT:E=this._moveToNextNode(sap.suite.ui.commons.ProcessFlow._enumMoveDirection.RIGHT);break;case jQuery.sap.KeyCodes.ARROW_LEFT:E=this._moveToNextNode(sap.suite.ui.commons.ProcessFlow._enumMoveDirection.LEFT);break;case jQuery.sap.KeyCodes.ARROW_DOWN:E=this._moveToNextNode(sap.suite.ui.commons.ProcessFlow._enumMoveDirection.DOWN);break;case jQuery.sap.KeyCodes.ARROW_UP:E=this._moveToNextNode(sap.suite.ui.commons.ProcessFlow._enumMoveDirection.UP);break;case jQuery.sap.KeyCodes.PAGE_UP:E=this._moveOnePage(sap.suite.ui.commons.ProcessFlow._enumMoveDirection.UP,a);break;case jQuery.sap.KeyCodes.PAGE_DOWN:E=this._moveOnePage(sap.suite.ui.commons.ProcessFlow._enumMoveDirection.DOWN,a);break;case jQuery.sap.KeyCodes.HOME:E=this._moveHomeEnd(sap.suite.ui.commons.ProcessFlow._enumMoveDirection.LEFT,c);break;case jQuery.sap.KeyCodes.END:E=this._moveHomeEnd(sap.suite.ui.commons.ProcessFlow._enumMoveDirection.RIGHT,c);break;case jQuery.sap.KeyCodes.NUMPAD_0:case jQuery.sap.KeyCodes.DIGIT_0:this._initZoomLevel();break;case jQuery.sap.KeyCodes.ENTER:case jQuery.sap.KeyCodes.SPACE:e.preventDefault();return;default:return;}e.preventDefault();if(E){this._changeNavigationFocus(p,this._lastNavigationFocusNode);}};
sap.suite.ui.commons.ProcessFlow.prototype._mergeLaneIdNodeStates=function(l){var p=0;var n=0;var N=0;var P=0;for(var s=0;s<4;s++){for(var i=0;i<l.length;i++){switch(l[i][s].state){case sap.suite.ui.commons.ProcessFlowNodeState.Positive:p=p+l[i][s].value;break;case sap.suite.ui.commons.ProcessFlowNodeState.Negative:n=n+l[i][s].value;break;case sap.suite.ui.commons.ProcessFlowNodeState.Neutral:N=N+l[i][s].value;break;case sap.suite.ui.commons.ProcessFlowNodeState.Planned:P=P+l[i][s].value;break;case sap.suite.ui.commons.ProcessFlowNodeState.PlannedNegative:n=n+l[i][s].value;break;}}}var r=[{state:sap.suite.ui.commons.ProcessFlowNodeState.Positive,value:p},{state:sap.suite.ui.commons.ProcessFlowNodeState.Negative,value:n},{state:sap.suite.ui.commons.ProcessFlowNodeState.Neutral,value:N},{state:sap.suite.ui.commons.ProcessFlowNodeState.Planned,value:P}];return r;};
sap.suite.ui.commons.ProcessFlow.prototype._setFocusOnHeader=function(s){var t=jQuery.sap.byId(this.getId()+"-thead");if(s){t.focus();t.addClass("sapSuiteUiCommonsPFHeaderFocused");this._headerHasFocus=true;}else{t.blur();t.removeClass("sapSuiteUiCommonsPFHeaderFocused");this._headerHasFocus=false;}};
sap.suite.ui.commons.ProcessFlow.prototype._onArrowClick=function(e){var t=e.target.id;if(t){var i=this.getId();e.preventDefault();if(t==i+"-arrowScrollLeft"&&sap.ui.Device.system.desktop){this._scroll(-this._scrollStep,500);}else if(t==i+"-arrowScrollRight"&&sap.ui.Device.system.desktop){this._scroll(this._scrollStep,500);}}};
sap.suite.ui.commons.ProcessFlow.prototype._scroll=function(d,D){var o=this.getDomRef("scrollContainer");var s=o.scrollLeft;if(!!!sap.ui.Device.browser.internet_explorer&&this._bRtl){d=-d;}var S=s+d;jQuery(o).stop(true,true).animate({scrollLeft:S},D,jQuery.proxy(this._adjustAndShowArrow,this));};
sap.suite.ui.commons.ProcessFlow.prototype._adjustAndShowArrow=function(){this._checkOverflow(this.getDomRef("scrollContainer"),this.$());if(this.getScrollable()){this._moveArrowAndCounterVertical();}if(this._isFocusChanged){this._setFocusToNode(this._lastNavigationFocusNode);this._isFocusChanged=false;}};
sap.suite.ui.commons.ProcessFlow.prototype._getScrollingArrow=function(n){var s;if(sap.ui.Device.system.desktop){s="sap-icon://navigation-"+n+"-arrow";}else{s="sap-icon://slim-arrow-"+n;}var p={src:s};var l="sapPFHArrowScrollLeft";var r="sapPFHArrowScrollRight";var c=["sapPFHArrowScroll",l];var C=["sapPFHArrowScroll",r];if(n==="left"){if(!this._oArrowLeft){this._oArrowLeft=sap.m.ImageHelper.getImageControl(this.getId()+"-arrowScrollLeft",null,this,p,c);}return this._oArrowLeft;}if(n==="right"){if(!this._oArrowRight){this._oArrowRight=sap.m.ImageHelper.getImageControl(this.getId()+"-arrowScrollRight",null,this,p,C);}return this._oArrowRight;}};
sap.suite.ui.commons.ProcessFlow.prototype._checkScrolling=function(s,$){var S=false;if(s){if(s.scrollWidth>s.clientWidth){S=true;}}if(this._arrowScrollable!==S){$.toggleClass("sapPFHScrollable",S);$.toggleClass("sapPFHNotScrollable",!S);this._arrowScrollable=S;}return S;};
sap.suite.ui.commons.ProcessFlow.prototype._setScrollWidth=function(s){switch(this.getZoomLevel()){case(sap.suite.ui.commons.ProcessFlowZoomLevel.One):this._scrollStep=240;break;case(sap.suite.ui.commons.ProcessFlowZoomLevel.Two):this._scrollStep=192;break;case(sap.suite.ui.commons.ProcessFlowZoomLevel.Three):this._scrollStep=168;break;case(sap.suite.ui.commons.ProcessFlowZoomLevel.Four):this._scrollStep=128;break;}};
sap.suite.ui.commons.ProcessFlow.prototype._updateLeftCounter=function(){var s;if(!this._bRtl){s=this.$("scrollContainer").scrollLeft();}else{s=this.$("scrollContainer").scrollRightRTL();}var c=Math.round(s/this._scrollStep);this.$("counterLeft").text(c.toString());return c;};
sap.suite.ui.commons.ProcessFlow.prototype._updateRightCounter=function(a,r){var s;var c;if(!this._bRtl){s=this.$("scrollContainer").scrollLeft();c=Math.round((r-s-a)/this._scrollStep);}else{s=this.$("scrollContainer").scrollLeftRTL();c=Math.round(s/this._scrollStep);}this.$("counterRight").text(c.toString());return c;};
sap.suite.ui.commons.ProcessFlow.prototype._moveArrowAndCounterVertical=function(){var s=this.$("scrollContainer").scrollTop();if(s>0){var a=this._iInitialArrowTop-s;var c=this._iInitialCounterTop-s;var d=this._iInitialCounterTop-this._iInitialArrowTop;if(a>0){this.$("arrowScrollRight").css("top",a+"px");this.$("arrowScrollLeft").css("top",a+"px");}else{this.$("arrowScrollRight").css("top","0px");this.$("arrowScrollLeft").css("top","0px");}if(c>d){this.$("counterRight").css("top",c+"px");this.$("counterLeft").css("top",c+"px");}else{this.$("counterRight").css("top",d+"px");this.$("counterLeft").css("top",d+"px");}}else{this.$("arrowScrollRight").css("top",this._iInitialArrowTop+"px");this.$("arrowScrollLeft").css("top",this._iInitialArrowTop+"px");this.$("counterRight").css("top",this._iInitialCounterTop+"px");this.$("counterLeft").css("top",this._iInitialCounterTop+"px");}};
sap.suite.ui.commons.ProcessFlow.prototype._checkOverflow=function(s,$){if(this._checkScrolling(s,$)&&s){this._setScrollWidth(s);var S=false;var b=false;var o=20;var i=this.$("scrollContainer").scrollLeft();var r=s.scrollWidth;var a=s.clientWidth;if(Math.abs(r-a)==1){r=a;}if(!this._bRtl){if(i>o){S=true;}if((r>a)&&(i+a+o<r)){b=true;}}else{var c=jQuery(s);if(c.scrollLeftRTL()>o){b=true;}if(c.scrollRightRTL()>o){S=true;}}this._updateLeftCounter();this._updateRightCounter(a,r);if((b!==this._bPreviousScrollForward)||(S!==this._bPreviousScrollBack)){this._bPreviousScrollForward=b;this._bPreviousScrollBack=S;$.toggleClass("sapPFHScrollBack",S);$.toggleClass("sapPFHNoScrollBack",!S);$.toggleClass("sapPFHScrollForward",b);$.toggleClass("sapPFHNoScrollForward",!b);}}else{this._bPreviousScrollForward=false;this._bPreviousScrollBack=false;}};
sap.suite.ui.commons.ProcessFlow.prototype._onScroll=function(e){var s=this.$("scrollContainer").scrollLeft();var d=Math.abs(s-this._iTouchStartScrollLeft);if(d>(this._scrollStep/4)&&!this._isFocusChanged){this._adjustAndShowArrow();this._iTouchStartScrollLeft=s;}else{if(this.getScrollable()){var S=this.$("scrollContainer").scrollTop();var D=Math.abs(S-this._iTouchStartScrollTop);if(D>10){this._moveArrowAndCounterVertical();this._iTouchStartScrollTop=S;}}}};
sap.suite.ui.commons.ProcessFlow.prototype.ontouchstart=function(e){this._iTouchStartScrollLeft=this.$("scrollContainer").scrollLeft();if(this.getScrollable()){this._iTouchStartScrollTop=this.$("scrollContainer").scrollTop();}};
sap.suite.ui.commons.ProcessFlow.prototype._setParentForNodes=function(I){var c=I?I.length:0;var C;var i,j;for(var a in I){I[a].removeAllAssociation("parents",true);}for(i=0;i<c;i++){C=I[i].getChildren();if(C){for(j=0;j<C.length;j++){var b=this._getNode(sap.suite.ui.commons.ProcessFlow._getChildIdByElement(C[j]),I);if(b){b.addAssociation("parents",I[i],true);}}}}};
sap.suite.ui.commons.ProcessFlow.prototype._getNode=function(n,I){for(var i=0;i<I.length;i++){if(I[i].getNodeId()===n.toString()){return I[i];}}};
sap.suite.ui.commons.ProcessFlow.prototype._getLane=function(l){for(var i=0;i<this._internalLanes.length;i++){if(this._internalLanes[i].getLaneId()===l){return this._internalLanes[i];}}};
sap.suite.ui.commons.ProcessFlow._getChildIdByElement=function(c){if(typeof c==='object'){return c.nodeId;}else{return c;}};
sap.suite.ui.commons.ProcessFlow.prototype._getConnectionsMap=function(){var c=[];var n=this.getNodes();for(var i=0;i<n.length;i++){var p=this._getPositionOfNodeInMatrix(this._internalCalcMatrix,n[i]);var C=n[i].getChildren();if(C){for(var j=0;j<C.length;j++){var o={};o.sourceNode=n[i];var a=sap.suite.ui.commons.ProcessFlow._getChildIdByElement(C[j]);var b=this._getNode(a,n);if(b){if(typeof C[j]==='object'){o.label=C[j].connectionLabel;}o.targetNode=b;var P=this._getPositionOfNodeInMatrix(this._internalCalcMatrix,o.targetNode);o.connectionParts=this._calculateConnectionParts(this._internalCalcMatrix,p,P);c.push(o);}}}}this._internalConnectionMap=c;return c;};
sap.suite.ui.commons.ProcessFlow.prototype._getPositionOfNodeInMatrix=function(m,n){var p={};for(var i=0;i<m.length;i++){var c=m[i];for(var j=0;j<c.length;j++){var a=c[j];if(a&&a instanceof sap.suite.ui.commons.ProcessFlowNode&&a.getNodeId()===n.getNodeId()){p.y=i;p.x=j;return p;}}}return p;};
sap.suite.ui.commons.ProcessFlow.prototype._calculateConnectionParts=function(m,p,P){var c=[];var a=p.y;var b=p.x;b++;c.push({x:b,y:a});if(P.y>=p.y){while(a<P.y){a++;c.push({x:b,y:a});}}else{while(a>P.y){a--;c.push({x:b,y:a});}}while(b<P.x-1){b++;c.push({x:b,y:a});}return c;};
sap.suite.ui.commons.ProcessFlow.prototype._getConnectionMapEntries=function(c){var f=[];var a=null;var e=null;if(this._internalConnectionMap){for(var i=0;i<this._internalConnectionMap.length;i++){e=this._internalConnectionMap[i];if(e.label&&e.label.getId()===c.getId()){a=e;break;}}e=null;for(var j=0;j<this._internalConnectionMap.length;j++){e=this._internalConnectionMap[j];if(e.targetNode&&e.targetNode.getNodeId()===a.targetNode.getNodeId()){f.push(e);}}}return f;};
sap.suite.ui.commons.ProcessFlow.prototype._handleLabelClick=function(e){if(e){var c=e.getSource();if(c instanceof sap.ui.core.Icon){c=c.getParent();}if(c instanceof sap.suite.ui.commons.ProcessFlowConnectionLabel){var r=this._getConnectionMapEntries(c);var a=this._createLabelPressEventArgs(c,r);this.fireLabelPress(a);}}};
sap.suite.ui.commons.ProcessFlow.prototype.setSelectedPath=function(s,t){var n=this.getNodes();if(n){if(s&&t){var c=0;for(var i=0;i<n.length;i++){if(n[i].getNodeId()===s||n[i].getNodeId()===t){n[i].setSelected(true);c++;}else{n[i].setSelected(false);}}if(c==2){this.rerender();}}else if(!s&&!t){for(var i=0;i<n.length;i++){n[i].setSelected(false);}this.rerender();}}};
sap.suite.ui.commons.ProcessFlow.prototype.setFocusToLabel=function(l){this._changeNavigationFocus(this._lastNavigationFocusNode,l);};
sap.suite.ui.commons.ProcessFlow.prototype._createLabelPressEventArgs=function(c,C){var e={};var E=[];if(C){for(var i=0;i<C.length;i++){var o={sourceNode:C[i].sourceNode,targetNode:C[i].targetNode,label:C[i].label};E.push(o);}}e.selectedLabel=c;e.connections=E;return e;};
sap.suite.ui.commons.ProcessFlow.prototype.setShowLabels=function(n){var o=this.getShowLabels();if(o&&!n){this.setProperty("showLabels",n,true);if(!this.getShowLabels()){this.setSelectedPath(null,null);}}else{this.setProperty("showLabels",n);}};
