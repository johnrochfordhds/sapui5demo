defineGlobal("global!tinymce.PluginManager",tinymce.PluginManager);defineGlobal("global!tinymce.Env",tinymce.Env);defineGlobal("global!tinymce.util.Promise",tinymce.util.Promise);defineGlobal("global!tinymce.util.URI",tinymce.util.URI);defineGlobal("global!tinymce.util.Tools",tinymce.util.Tools);defineGlobal("global!tinymce.util.Delay",tinymce.util.Delay);define("ephox/imagetools/util/Canvas",[],function(){function c(w,h){return r(document.createElement('canvas'),w,h);}function g(a){return a.getContext("2d");}function r(a,w,h){a.width=w;a.height=h;return a;}return{create:c,resize:r,get2dContext:g};});define("ephox/imagetools/util/ImageSize",[],function(){function g(i){return i.naturalWidth||i.width;}function a(i){return i.naturalHeight||i.height;}return{getWidth:g,getHeight:a};});define("ephox/imagetools/util/Promise",[],function(){if(window.Promise){return window.Promise;}var a=P.immediateFn||(typeof setImmediate==='function'&&setImmediate)||function(e){setTimeout(e,1);};function b(e,t){return function(){e.apply(t,arguments);};}var c=Array.isArray||function(v){return Object.prototype.toString.call(v)==="[object Array]";};function P(e){if(typeof this!=='object')throw new TypeError('Promises must be constructed via new');if(typeof e!=='function')throw new TypeError('not a function');this._state=null;this._value=null;this._deferreds=[];g(e,b(r,this),b(d,this));}function h(i){var m=this;if(this._state===null){this._deferreds.push(i);return;}a(function(){var j=m._state?i.onFulfilled:i.onRejected;if(j===null){(m._state?i.resolve:i.reject)(m._value);return;}var k;try{k=j(m._value);}catch(e){i.reject(e);return;}i.resolve(k);});}function r(n){try{if(n===this)throw new TypeError('A promise cannot be resolved with itself.');if(n&&(typeof n==='object'||typeof n==='function')){var t=n.then;if(typeof t==='function'){g(b(t,n),b(r,this),b(d,this));return;}}this._state=true;this._value=n;f.call(this);}catch(e){d.call(this,e);}}function d(n){this._state=false;this._value=n;f.call(this);}function f(){for(var i=0,l=this._deferreds.length;i<l;i++){h.call(this,this._deferreds[i]);}this._deferreds=null;}function H(o,e,r,d){this.onFulfilled=typeof o==='function'?o:null;this.onRejected=typeof e==='function'?e:null;this.resolve=r;this.reject=d;}function g(e,o,i){var j=false;try{e(function(v){if(j)return;j=true;o(v);},function(l){if(j)return;j=true;i(l);});}catch(k){if(j)return;j=true;i(k);}}P.prototype['catch']=function(o){return this.then(null,o);};P.prototype.then=function(o,e){var m=this;return new P(function(r,d){h.call(m,new H(o,e,r,d));});};P.all=function(){var e=Array.prototype.slice.call(arguments.length===1&&c(arguments[0])?arguments[0]:arguments);return new P(function(r,d){if(e.length===0)return r([]);var j=e.length;function k(i,v){try{if(v&&(typeof v==='object'||typeof v==='function')){var t=v.then;if(typeof t==='function'){t.call(v,function(v){k(i,v);},d);return;}}e[i]=v;if(--j===0){r(e);}}catch(l){d(l);}}for(var i=0;i<e.length;i++){k(i,e[i]);}});};P.resolve=function(v){if(v&&typeof v==='object'&&v.constructor===P){return v;}return new P(function(r){r(v);});};P.reject=function(v){return new P(function(r,d){d(v);});};P.race=function(v){return new P(function(r,d){for(var i=0,l=v.length;i<l;i++){v[i].then(r,d);}});};return P;});define("ephox/imagetools/util/Mime",[],function(){function g(u){var a=document.createElement('a');a.href=u;return a.pathname;}function b(u){var p=g(u).split('.'),e=p[p.length-1],m={'jpg':'image/jpeg','jpeg':'image/jpeg','png':'image/png'};if(e){e=e.toLowerCase();}return m[e];}return{guessMimeType:b};});define("ephox/imagetools/util/Conversions",["ephox/imagetools/util/Promise","ephox/imagetools/util/Canvas","ephox/imagetools/util/Mime","ephox/imagetools/util/ImageSize"],function(P,C,M,I){function l(i){return new P(function(j){function k(){i.removeEventListener('load',k);j(i);}if(i.complete){j(i);}else{i.addEventListener('load',k);}});}function a(i){return l(i).then(function(i){var j,k;k=C.create(I.getWidth(i),I.getHeight(i));j=C.get2dContext(k);j.drawImage(i,0,0);return k;});}function b(i){return l(i).then(function(i){var s=i.src;if(s.indexOf('blob:')===0){return d(s);}if(s.indexOf('data:')===0){return e(s);}return a(i).then(function(j){return e(j.toDataURL(M.guessMimeType(s)));});});}function c(i){return new P(function(j){var k=new Image();function m(){k.removeEventListener('load',m);j(k);}k.addEventListener('load',m);k.src=URL.createObjectURL(i);if(k.complete){m();}});}function d(i){return new P(function(j){var x=new XMLHttpRequest();x.open('GET',i,true);x.responseType='blob';x.onload=function(){if(this.status==200){j(this.response);}};x.send();});}function e(j){return new P(function(k){var s,m,i,n,t,o;j=j.split(',');n=/data:([^;]+)/.exec(j[0]);if(n){t=n[1];}s=atob(j[1]);if(window.WebKitBlobBuilder){o=new WebKitBlobBuilder();m=new ArrayBuffer(s.length);for(i=0;i<m.length;i++){m[i]=s.charCodeAt(i);}o.append(m);k(o.getBlob(t));return;}m=new Uint8Array(s.length);for(i=0;i<m.length;i++){m[i]=s.charCodeAt(i);}k(new Blob([m],{type:t}));});}function u(i){if(i.indexOf('blob:')===0){return d(i);}if(i.indexOf('data:')===0){return e(i);}return null;}function f(i,t){return e(i.toDataURL(t));}function g(i){return new P(function(j){var k=new FileReader();k.onloadend=function(){j(k.result);};k.readAsDataURL(i);});}function h(i){return g(i).then(function(j){return j.split(',')[1];});}function r(i){URL.revokeObjectURL(i.src);}return{blobToImage:c,imageToBlob:b,blobToDataUri:g,blobToBase64:h,imageToCanvas:a,canvasToBlob:f,revokeImageUrl:r,uriToBlob:u};});define("ephox/imagetools/transformations/ColorMatrix",[],function(){function c(v,i,j){v=parseFloat(v);if(v>j){v=j;}else if(v<i){v=i;}return v;}function a(){return[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1];}var D=[0,0.01,0.02,0.04,0.05,0.06,0.07,0.08,0.1,0.11,0.12,0.14,0.15,0.16,0.17,0.18,0.20,0.21,0.22,0.24,0.25,0.27,0.28,0.30,0.32,0.34,0.36,0.38,0.40,0.42,0.44,0.46,0.48,0.5,0.53,0.56,0.59,0.62,0.65,0.68,0.71,0.74,0.77,0.80,0.83,0.86,0.89,0.92,0.95,0.98,1.0,1.06,1.12,1.18,1.24,1.30,1.36,1.42,1.48,1.54,1.60,1.66,1.72,1.78,1.84,1.90,1.96,2.0,2.12,2.25,2.37,2.50,2.62,2.75,2.87,3.0,3.2,3.4,3.6,3.8,4.0,4.3,4.7,4.9,5.0,5.5,6.0,6.5,6.8,7.0,7.3,7.5,7.8,8.0,8.4,8.7,9.0,9.4,9.6,9.8,10.0];function m(o,p){var i,j,k,v,q=[],r=new Array(10);for(i=0;i<5;i++){for(j=0;j<5;j++){q[j]=p[j+i*5];}for(j=0;j<5;j++){v=0;for(k=0;k<5;k++){v+=o[j+k*5]*q[k];}r[j+i*5]=v;}}return r;}function b(i,j){j=c(j,0,1);return i.map(function(v,k){if(k%6===0){v=1.0-((1-v)*j);}else{v*=j;}return c(v,0,1);});}function d(i,v){var x;v=c(v,-1,1);v*=100;if(v<0){x=127+v/100*127;}else{x=v%1;if(x===0){x=D[v];}else{x=D[(Math.floor(v))]*(1-x)+D[(Math.floor(v))+1]*x;}x=x*127+127;}return m(i,[x/127,0,0,0,0.5*(127-x),0,x/127,0,0,0.5*(127-x),0,0,x/127,0,0.5*(127-x),0,0,0,1,0,0,0,0,0,1]);}function e(i,v){var x,j,k,o;v=c(v,-1,1);x=1+((v>0)?3*v:v);j=0.3086;k=0.6094;o=0.0820;return m(i,[j*(1-x)+x,k*(1-x),o*(1-x),0,0,j*(1-x),k*(1-x)+x,o*(1-x),0,0,j*(1-x),k*(1-x),o*(1-x)+x,0,0,0,0,0,1,0,0,0,0,0,1]);}function f(i,j){var k,s,o,p,q;j=c(j,-180,180)/180*Math.PI;k=Math.cos(j);s=Math.sin(j);o=0.213;p=0.715;q=0.072;return m(i,[o+k*(1-o)+s*(-o),p+k*(-p)+s*(-p),q+k*(-q)+s*(1-q),0,0,o+k*(-o)+s*(0.143),p+k*(1-p)+s*(0.140),q+k*(-q)+s*(-0.283),0,0,o+k*(-o)+s*(-(1-o)),p+k*(-p)+s*(p),q+k*(1-q)+s*(q),0,0,0,0,0,1,0,0,0,0,0,1]);}function g(i,v){v=c(255*v,-255,255);return m(i,[1,0,0,0,v,0,1,0,0,v,0,0,1,0,v,0,0,0,1,0,0,0,0,0,1]);}function h(i,j,k,o){j=c(j,0,2);k=c(k,0,2);o=c(o,0,2);return m(i,[j,0,0,0,0,0,k,0,0,0,0,0,o,0,0,0,0,0,1,0,0,0,0,0,1]);}function l(i,v){v=c(v,0,1);return m(i,b([0.393,0.769,0.189,0,0,0.349,0.686,0.168,0,0,0.272,0.534,0.131,0,0,0,0,0,1,0,0,0,0,0,1],v));}function n(i,v){v=c(v,0,1);return m(i,b([0.33,0.34,0.33,0,0,0.33,0.34,0.33,0,0,0.33,0.34,0.33,0,0,0,0,0,1,0,0,0,0,0,1],v));}return{identity:a,adjust:b,multiply:m,adjustContrast:d,adjustBrightness:g,adjustSaturation:e,adjustHue:f,adjustColors:h,adjustSepia:l,adjustGrayscale:n};});define("ephox/imagetools/transformations/Filters",["ephox/imagetools/util/Canvas","ephox/imagetools/util/ImageSize","ephox/imagetools/util/Conversions","ephox/imagetools/transformations/ColorMatrix"],function(C,I,c,e){var f=c.revokeImageUrl;function j(h,q){return c.blobToImage(h).then(function(s){var t=C.create(I.getWidth(s),I.getHeight(s)),u=C.get2dContext(t),v;function w(v,m){var d=v.data,r,g,b,a,i,x=m[0],y=m[1],z=m[2],A=m[3],B=m[4],D=m[5],E=m[6],F=m[7],G=m[8],H=m[9],J=m[10],K=m[11],L=m[12],M=m[13],N=m[14],O=m[15],P=m[16],Q=m[17],R=m[18],S=m[19];for(i=0;i<d.length;i+=4){r=d[i];g=d[i+1];b=d[i+2];a=d[i+3];d[i]=r*x+g*y+b*z+a*A+B;d[i+1]=r*D+g*E+b*F+a*G+H;d[i+2]=r*J+g*K+b*L+a*M+N;d[i+3]=r*O+g*P+b*Q+a*R+S;}return v;}u.drawImage(s,0,0);f(s);v=w(u.getImageData(0,0,t.width,t.height),q);u.putImageData(v,0,0);return c.canvasToBlob(t);});}function k(a,m){return c.blobToImage(a).then(function(i){var d=C.create(I.getWidth(i),I.getHeight(i)),q=C.get2dContext(d),s,t;function u(s,t,m){var v,z,A,B,x,y,r,g,b,D,E,F,G,H,J,w,h;function K(L,M,N){if(L>N){L=N;}else if(L<M){L=M;}return L;}A=Math.round(Math.sqrt(m.length));B=Math.floor(A/2);v=s.data;z=t.data;w=s.width;h=s.height;for(y=0;y<h;y++){for(x=0;x<w;x++){r=g=b=0;for(E=0;E<A;E++){for(D=0;D<A;D++){F=K(x+D-B,0,w-1);G=K(y+E-B,0,h-1);H=(G*w+F)*4;J=m[E*A+D];r+=v[H]*J;g+=v[H+1]*J;b+=v[H+2]*J;}}H=(y*w+x)*4;z[H]=K(r,0,255);z[H+1]=K(g,0,255);z[H+2]=K(b,0,255);}}return t;}q.drawImage(i,0,0);f(i);s=q.getImageData(0,0,d.width,d.height);t=q.getImageData(0,0,d.width,d.height);t=u(s,t,m);q.putImageData(t,0,0);return c.canvasToBlob(d);});}function l(a){return function(b,v){return c.blobToImage(b).then(function(g){var h=C.create(I.getWidth(g),I.getHeight(g)),m=C.get2dContext(h),q,i,r=new Array(256);function s(q,r){var d=q.data,i;for(i=0;i<d.length;i+=4){d[i]=r[d[i]];d[i+1]=r[d[i+1]];d[i+2]=r[d[i+2]];}return q;}for(i=0;i<r.length;i++){r[i]=a(i,v);}m.drawImage(g,0,0);f(g);q=s(m.getImageData(0,0,h.width,h.height),r);m.putImageData(q,0,0);return c.canvasToBlob(h);});};}function n(m){return function(b,a){return j(b,m(e.identity(),a));};}function o(m){return function(b){return j(b,m);};}function p(a){return function(b){return k(b,a);};}return{invert:o([-1,0,0,0,255,0,-1,0,0,255,0,0,-1,0,255,0,0,0,1,0]),brightness:n(e.adjustBrightness),hue:n(e.adjustHue),saturate:n(e.adjustSaturation),contrast:n(e.adjustContrast),grayscale:n(e.adjustGrayscale),sepia:n(e.adjustSepia),colorize:function(b,a,d,g){return j(b,e.adjustColors(e.identity(),a,d,g));},sharpen:p([0,-1,0,-1,5,-1,0,-1,0]),emboss:p([-2,-1,0,-1,1,1,0,1,2]),gamma:l(function(a,v){return Math.pow(a/255,1-v)*255;}),exposure:l(function(a,v){return 255*(1-Math.exp(-(a/255)*v));}),colorFilter:j,convoluteFilter:k};});define("ephox/imagetools/transformations/ImageTools",["ephox/imagetools/util/Conversions","ephox/imagetools/util/Canvas","ephox/imagetools/util/ImageSize"],function(C,a,I){var r=C.revokeImageUrl;function b(e,g){return C.blobToImage(e).then(function(i){var h=a.create(I.getWidth(i),I.getHeight(i)),j=a.get2dContext(h),t=0,k=0;g=g<0?360+g:g;if(g==90||g==270){a.resize(h,h.height,h.width);}if(g==90||g==180){t=h.width;}if(g==270||g==180){k=h.height;}j.translate(t,k);j.rotate(g*Math.PI/180);j.drawImage(i,0,0);r(i);return C.canvasToBlob(h,e.type);});}function f(e,g){return C.blobToImage(e).then(function(i){var h=a.create(I.getWidth(i),I.getHeight(i)),j=a.get2dContext(h);if(g=='v'){j.scale(1,-1);j.drawImage(i,0,-h.height);}else{j.scale(-1,1);j.drawImage(i,-h.width,0);}r(i);return C.canvasToBlob(h);});}function c(e,x,y,w,h){return C.blobToImage(e).then(function(i){var g=a.create(w,h),j=a.get2dContext(g);j.drawImage(i,-x,-y);r(i);return C.canvasToBlob(g);});}function d(e,w,h){return C.blobToImage(e).then(function(i){var g=a.create(w,h),j=a.get2dContext(g);j.drawImage(i,0,0,w,h);r(i);return C.canvasToBlob(g,e.type);});}return{rotate:b,flip:f,crop:c,resize:d};});define('ephox/imagetools/api/ImageTransformations',['ephox/imagetools/transformations/Filters','ephox/imagetools/transformations/ImageTools'],function(F,I){var i=function(h){return F.invert(h);};var s=function(h){return F.sharpen(h);};var e=function(h){return F.emboss(h);};var g=function(h,v){return F.gamma(h,v);};var a=function(h,v){return F.exposure(h,v);};var c=function(h,p,q,t){return F.colorize(h,p,q,t);};var b=function(h,p){return F.brightness(h,p);};var d=function(h,p){return F.hue(h,p);};var f=function(h,p){return F.saturate(h,p);};var j=function(h,p){return F.contrast(h,p);};var k=function(h,p){return F.grayscale(h,p);};var l=function(h,p){return F.sepia(h,p);};var m=function(h,p){return I.flip(h,p);};var n=function(p,x,y,w,h){return I.crop(p,x,y,w,h);};var r=function(p,w,h){return I.resize(p,w,h);};var o=function(h,p){return I.rotate(h,p);};return{invert:i,sharpen:s,emboss:e,brightness:b,hue:d,saturate:f,contrast:j,grayscale:k,sepia:l,colorize:c,gamma:g,exposure:a,flip:m,crop:n,resize:r,rotate:o};});define('ephox/imagetools/api/BlobConversions',['ephox/imagetools/util/Conversions'],function(C){var b=function(d){return C.blobToImage(d);};var i=function(d){return C.imageToBlob(d);};var a=function(d){return C.blobToDataUri(d);};var c=function(d){return C.blobToBase64(d);};return{blobToImage:b,imageToBlob:i,blobToDataUri:a,blobToBase64:c};});defineGlobal("global!tinymce.dom.DOMUtils",tinymce.dom.DOMUtils);defineGlobal("global!tinymce.ui.Factory",tinymce.ui.Factory);defineGlobal("global!tinymce.ui.Form",tinymce.ui.Form);defineGlobal("global!tinymce.ui.Container",tinymce.ui.Container);defineGlobal("global!tinymce.ui.Control",tinymce.ui.Control);defineGlobal("global!tinymce.ui.DragHelper",tinymce.ui.DragHelper);defineGlobal("global!tinymce.geom.Rect",tinymce.geom.Rect);defineGlobal("global!tinymce.dom.DomQuery",tinymce.dom.DomQuery);defineGlobal("global!tinymce.util.Observable",tinymce.util.Observable);define("tinymce/imagetoolsplugin/CropRect",["global!tinymce.dom.DomQuery","global!tinymce.ui.DragHelper","global!tinymce.geom.Rect","global!tinymce.util.Tools","global!tinymce.util.Observable"],function($,D,R,T,O){var c=0;return function(a,v,b,d){var i,f,g,j,p='mce-',k=p+'crid-'+(c++);f=[{name:'move',xMul:0,yMul:0,deltaX:1,deltaY:1,deltaW:0,deltaH:0},{name:'nw',xMul:0,yMul:0,deltaX:1,deltaY:1,deltaW:-1,deltaH:-1},{name:'ne',xMul:1,yMul:0,deltaX:0,deltaY:1,deltaW:1,deltaH:-1},{name:'sw',xMul:0,yMul:1,deltaX:1,deltaY:0,deltaW:-1,deltaH:1},{name:'se',xMul:1,yMul:1,deltaX:0,deltaY:0,deltaW:1,deltaH:1}];j=["top","right","bottom","left"];function l(e,h){return{x:h.x+e.x,y:h.y+e.y,w:h.w,h:h.h};}function m(e,h){return{x:h.x-e.x,y:h.y-e.y,w:h.w,h:h.h};}function n(){return m(b,a);}function r(){function B(C){var E;return new D(k,{document:d.ownerDocument,handle:k+'-'+C.name,start:function(){E=a;},drag:function(e){var x,y,w,h,F;x=E.x;y=E.y;w=E.w;h=E.h;x+=e.deltaX*C.deltaX;y+=e.deltaY*C.deltaY;w+=e.deltaX*C.deltaW;h+=e.deltaY*C.deltaH;if(w<20){w=20;}if(h<20){h=20;}F=a=R.clamp({x:x,y:y,w:w,h:h},b,C.name=='move');F=m(b,F);i.fire('updateRect',{rect:F});u(F);}});}$('<div id="'+k+'" class="'+p+'croprect-container" data-mce-bogus="all">').appendTo(d);T.each(j,function(e){$('#'+k,d).append('<div id="'+k+'-'+e+'"class="'+p+'croprect-block" style="display: none" data-mce-bogus="all">');});T.each(f,function(h){$('#'+k,d).append('<div id="'+k+'-'+h.name+'" class="'+p+'croprect-handle '+p+'croprect-handle-'+h.name+'" style="display: none" data-mce-bogus="all">');});g=T.map(f,B);o(a);}function t(e){var h;h=T.map(f,function(w){return'#'+k+'-'+w.name;}).concat(T.map(j,function(w){return'#'+k+'-'+w;})).join(',');if(e){$(h,d).show();}else{$(h,d).hide();}}function o(e){function h(w,e){if(e.h<0){e.h=0;}if(e.w<0){e.w=0;}$('#'+k+'-'+w,d).css({left:e.x,top:e.y,width:e.w,height:e.h});}T.each(f,function(w){$('#'+k+'-'+w.name,d).css({left:e.w*w.xMul+e.x,top:e.h*w.yMul+e.y});});h('top',{x:v.x,y:v.y,w:v.w,h:e.y-v.y});h('right',{x:e.x+e.w,y:e.y,w:v.w-e.x-e.w+v.x,h:e.h});h('bottom',{x:v.x,y:e.y+e.h,w:v.w,h:v.h-e.y-e.h+v.y});h('left',{x:v.x,y:e.y,w:e.x-v.x,h:e.h});h('move',e);}function s(e){a=e;o(a);}function q(e){v=e;o(a);}function u(e){s(l(b,e));}function z(e){b=e;o(a);}function A(){T.each(g,function(h){h.destroy();});g=[];}r(d);i=T.extend({toggleVisibility:t,setClampRect:z,setRect:s,getInnerRect:n,setInnerRect:u,setViewPortRect:q,destroy:A},O);return i;};});define("tinymce/imagetoolsplugin/ImagePanel",["global!tinymce.ui.Control","global!tinymce.ui.DragHelper","global!tinymce.geom.Rect","global!tinymce.util.Tools","global!tinymce.util.Promise","tinymce/imagetoolsplugin/CropRect"],function(C,D,R,T,P,a){function l(i){return new P(function(r){function b(){i.removeEventListener('load',b);r(i);}if(i.complete){r(i);}else{i.addEventListener('load',b);}});}return C.extend({Defaults:{classes:"imagepanel"},selection:function(r){if(arguments.length){this.state.set('rect',r);return this;}return this.state.get('rect');},imageSize:function(){var v=this.state.get('viewRect');return{w:v.w,h:v.h};},toggleCropRect:function(s){this.state.set('cropEnabled',s);},imageSrc:function(u){var s=this,i=new Image();i.src=u;l(i).then(function(){var r,$,b=s.state.get('viewRect');$=s.$el.find('img');if($[0]){$.replaceWith(i);}else{s.getEl().appendChild(i);}r={x:0,y:0,w:i.naturalWidth,h:i.naturalHeight};s.state.set('viewRect',r);s.state.set('rect',R.inflate(r,-20,-20));if(!b||b.w!=r.w||b.h!=r.h){s.zoomFit();}s.repaintImage();s.fire('load');});},zoom:function(v){if(arguments.length){this.state.set('zoom',v);return this;}return this.state.get('zoom');},postRender:function(){this.imageSrc(this.settings.imageSrc);return this._super();},zoomFit:function(){var s=this,$,p,b,w,h,z,c;c=10;$=s.$el.find('img');p=s.getEl().clientWidth;b=s.getEl().clientHeight;w=$[0].naturalWidth;h=$[0].naturalHeight;z=Math.min((p-c)/w,(b-c)/h);if(z>=1){z=1;}s.zoom(z);},repaintImage:function(){var x,y,w,h,p,b,$,z,r,e;e=this.getEl();z=this.zoom();r=this.state.get('rect');$=this.$el.find('img');p=e.offsetWidth;b=e.offsetHeight;w=$[0].naturalWidth*z;h=$[0].naturalHeight*z;x=Math.max(0,p/2-w/2);y=Math.max(0,b/2-h/2);$.css({left:x,top:y,width:w,height:h});if(this.cropRect){this.cropRect.setRect({x:r.x*z+x,y:r.y*z+y,w:r.w*z,h:r.h*z});this.cropRect.setClampRect({x:x,y:y,w:w,h:h});this.cropRect.setViewPortRect({x:0,y:0,w:p,h:b});}},bindStates:function(){var s=this;function b(r){s.cropRect=new a(r,s.state.get('viewRect'),s.state.get('viewRect'),s.getEl());s.cropRect.on('updateRect',function(e){var r=e.rect,z=s.zoom();r={x:Math.round(r.x/z),y:Math.round(r.y/z),w:Math.round(r.w/z),h:Math.round(r.h/z)};s.state.set('rect',r);});s.on('remove',s.cropRect.destroy);}s.state.on('change:cropEnabled',function(e){s.cropRect.toggleVisibility(e.value);s.repaintImage();});s.state.on('change:zoom',function(){s.repaintImage();});s.state.on('change:rect',function(e){var r=e.value;if(!s.cropRect){b(r);}s.cropRect.setRect(r);});}});});define("tinymce/imagetoolsplugin/UndoStack",[],function(){return function(){var d=[],i=-1;function a(s){var e;e=d.splice(++i);d.push(s);return{state:s,removed:e};}function u(){if(c()){return d[--i];}}function r(){if(b()){return d[++i];}}function c(){return i>0;}function b(){return i!=-1&&i<d.length-1;}return{data:d,add:a,undo:u,redo:r,canUndo:c,canRedo:b};};});define("tinymce/imagetoolsplugin/Dialog",["global!tinymce.dom.DOMUtils","global!tinymce.util.Tools","global!tinymce.util.Promise","global!tinymce.ui.Factory","global!tinymce.ui.Form","global!tinymce.ui.Container","tinymce/imagetoolsplugin/ImagePanel","ephox/imagetools/api/ImageTransformations","ephox/imagetools/api/BlobConversions","tinymce/imagetoolsplugin/UndoStack"],function(D,T,P,F,a,C,I,c,B,U){function d(b){return{blob:b,url:URL.createObjectURL(b)};}function f(s){if(s){URL.revokeObjectURL(s.url);}}function h(s){T.each(s,f);}function o(j,k,l){var w,u=new U(),m,n,t,p,q,s,v,x,y,z,A,E,G,H,J,K,L,M,N,O,Q,R,S,V,W,X;function Y(e){var b,g,r,t1;b=w.find('#w')[0];g=w.find('#h')[0];r=parseInt(b.value(),10);t1=parseInt(g.value(),10);if(w.find('#constrain')[0].checked()&&S&&V&&r&&t1){if(e.control.settings.name=='w'){t1=Math.round(r*W);g.value(t1);}else{r=Math.round(t1*X);b.value(r);}}S=r;V=t1;}function Z(b){return Math.round(b*100)+'%';}function $(){w.find('#undo').disabled(!u.canUndo());w.find('#redo').disabled(!u.canRedo());w.statusbar.find('#save').disabled(!u.canUndo());}function _(){w.find('#undo').disabled(true);w.find('#redo').disabled(true);}function a1(b){if(b){v.imageSrc(b.url);}}function b1(b){return function(){var e=T.grep(R,function(g){return g.settings.name!=b;});T.each(e,function(g){g.hide();});b.show();};}function c1(b){t=d(b);a1(t);}function d1(b){j=d(b);a1(j);h(u.add(j).removed);$();}function e1(){var r=v.selection();c.crop(j.blob,r.x,r.y,r.w,r.h).then(function(b){d1(b);h1();});}function f1(b){var e=[].slice.call(arguments,1);return function(){var g=t||j;b.apply(this,[g.blob].concat(e)).then(c1);};}function g1(b){var e=[].slice.call(arguments,1);return function(){b.apply(this,[j.blob].concat(e)).then(d1);};}function h1(){a1(j);f(t);b1(m)();$();}function i1(){if(t){d1(t.blob);h1();}}function j1(){var b=v.zoom();if(b<2){b+=0.1;}v.zoom(b);}function k1(){var b=v.zoom();if(b>0.1){b-=0.1;}v.zoom(b);}function l1(){j=u.undo();a1(j);$();}function m1(){j=u.redo();a1(j);$();}function n1(){k(j.blob);w.close();}function o1(b){return new a({layout:'flex',direction:'row',labelGap:5,border:'0 0 1 0',align:'center',pack:'center',padding:'0 10 0 10',spacing:5,flex:0,minHeight:60,defaults:{classes:'imagetool',type:'button'},items:b});}function p1(b,e){return o1([{text:'Back',onclick:h1},{type:'spacer',flex:1},{text:'Apply',subtype:'primary',onclick:i1}]).hide().on('show',function(){_();e(j.blob).then(function(g){var r=d(g);a1(r);f(t);t=r;});});}function q1(b,g,r,t1,u1){function v1(r){g(j.blob,r).then(function(e){var w1=d(e);a1(w1);f(t);t=w1;});}return o1([{text:'Back',onclick:h1},{type:'spacer',flex:1},{type:'slider',flex:1,ondragend:function(e){v1(e.value);},minValue:t1,maxValue:u1,value:r,previewFilter:Z},{type:'spacer',flex:1},{text:'Apply',subtype:'primary',onclick:i1}]).hide().on('show',function(){this.find('slider').value(r);_();});}function r1(e,t1){function u1(){var r,g,b;r=w.find('#r')[0].value();g=w.find('#g')[0].value();b=w.find('#b')[0].value();t1(j.blob,r,g,b).then(function(v1){var w1=d(v1);a1(w1);f(t);t=w1;});}return o1([{text:'Back',onclick:h1},{type:'spacer',flex:1},{type:'slider',label:'R',name:'r',minValue:0,value:1,maxValue:2,ondragend:u1,previewFilter:Z},{type:'slider',label:'G',name:'g',minValue:0,value:1,maxValue:2,ondragend:u1,previewFilter:Z},{type:'slider',label:'B',name:'b',minValue:0,value:1,maxValue:2,ondragend:u1,previewFilter:Z},{type:'spacer',flex:1},{text:'Apply',subtype:'primary',onclick:i1}]).hide().on('show',function(){w.find('#r,#g,#b').value(1);_();});}p=o1([{text:'Back',onclick:h1},{type:'spacer',flex:1},{text:'Apply',subtype:'primary',onclick:e1}]).hide().on('show hide',function(e){v.toggleCropRect(e.type=='show');}).on('show',_);function s1(e){if(e.control.value()===true){W=V/S;X=S/V;}}q=o1([{text:'Back',onclick:h1},{type:'spacer',flex:1},{type:'textbox',name:'w',label:'Width',size:4,onkeyup:Y},{type:'textbox',name:'h',label:'Height',size:4,onkeyup:Y},{type:'checkbox',name:'constrain',text:'Constrain proportions',checked:true,onchange:s1},{type:'spacer',flex:1},{text:'Apply',subtype:'primary',onclick:'submit'}]).hide().on('submit',function(e){var S=parseInt(w.find('#w').value(),10),V=parseInt(w.find('#h').value(),10);e.preventDefault();g1(c.resize,S,V)();h1();}).on('show',_);s=o1([{text:'Back',onclick:h1},{type:'spacer',flex:1},{icon:'fliph',tooltip:'Flip horizontally',onclick:f1(c.flip,'h')},{icon:'flipv',tooltip:'Flip vertically',onclick:f1(c.flip,'v')},{icon:'rotateleft',tooltip:'Rotate counterclockwise',onclick:f1(c.rotate,-90)},{icon:'rotateright',tooltip:'Rotate clockwise',onclick:f1(c.rotate,90)},{type:'spacer',flex:1},{text:'Apply',subtype:'primary',onclick:i1}]).hide().on('show',_);z=p1("Invert",c.invert);M=p1("Sharpen",c.sharpen);N=p1("Emboss",c.emboss);A=q1("Brightness",c.brightness,0,-1,1);E=q1("Hue",c.hue,180,0,360);G=q1("Saturate",c.saturate,0,-1,1);H=q1("Contrast",c.contrast,0,-1,1);J=q1("Grayscale",c.grayscale,0,0,1);K=q1("Sepia",c.sepia,0,0,1);L=r1("Colorize",c.colorize);O=q1("Gamma",c.gamma,0,-1,1);Q=q1("Exposure",c.exposure,1,0,2);n=o1([{text:'Back',onclick:h1},{type:'spacer',flex:1},{text:'hue',icon:'hue',onclick:b1(E)},{text:'saturate',icon:'saturate',onclick:b1(G)},{text:'sepia',icon:'sepia',onclick:b1(K)},{text:'emboss',icon:'emboss',onclick:b1(N)},{text:'exposure',icon:'exposure',onclick:b1(Q)},{type:'spacer',flex:1}]).hide();m=o1([{tooltip:'Crop',icon:'crop',onclick:b1(p)},{tooltip:'Resize',icon:'resize2',onclick:b1(q)},{tooltip:'Orientation',icon:'orientation',onclick:b1(s)},{tooltip:'Brightness',icon:'sun',onclick:b1(A)},{tooltip:'Sharpen',icon:'sharpen',onclick:b1(M)},{tooltip:'Contrast',icon:'contrast',onclick:b1(H)},{tooltip:'Color levels',icon:'drop',onclick:b1(L)},{tooltip:'Gamma',icon:'gamma',onclick:b1(O)},{tooltip:'Invert',icon:'invert',onclick:b1(z)}]);v=new I({flex:1,imageSrc:j.url});x=new C({layout:'flex',direction:'column',border:'0 1 0 0',padding:5,spacing:5,items:[{type:'button',icon:'undo',tooltip:'Undo',name:'undo',onclick:l1},{type:'button',icon:'redo',tooltip:'Redo',name:'redo',onclick:m1},{type:'button',icon:'zoomin',tooltip:'Zoom in',onclick:j1},{type:'button',icon:'zoomout',tooltip:'Zoom out',onclick:k1}]});y=new C({type:'container',layout:'flex',direction:'row',align:'stretch',flex:1,items:[x,v]});R=[m,p,q,s,n,z,A,E,G,H,J,K,L,M,N,O,Q];w=F.create('window',{layout:'flex',direction:'column',align:'stretch',minWidth:Math.min(D.DOM.getViewPort().w,800),minHeight:Math.min(D.DOM.getViewPort().h,650),title:'Edit image',items:R.concat([y]),buttons:[{text:'Save',name:'save',subtype:'primary',onclick:n1},{text:'Cancel',onclick:'close'}]});w.renderTo(document.body).reflow();w.on('close',function(){l();h(u.data);u=null;t=null;});u.add(j);$();v.on('load',function(){S=v.imageSize().w;V=v.imageSize().h;W=V/S;X=S/V;w.find('#w').value(S);w.find('#h').value(V);});}function i(b){return new P(function(r,e){o(d(b),r,e);});}return{edit:i};});define("tinymce/imagetoolsplugin/Plugin",["global!tinymce.PluginManager","global!tinymce.Env","global!tinymce.util.Promise","global!tinymce.util.URI","global!tinymce.util.Tools","global!tinymce.util.Delay","ephox/imagetools/api/ImageTransformations","ephox/imagetools/api/BlobConversions","tinymce/imagetoolsplugin/Dialog"],function(P,E,a,U,T,D,I,B,b){var p=function(c){var d=0,i,l;if(!E.fileApi){return;}function g(e){var H,J;function K(L){return L.indexOf('px')==L.length-2;}H=e.style.width;J=e.style.height;if(H||J){if(K(H)&&K(J)){return{w:parseInt(H,10),h:parseInt(J,10)};}return null;}H=c.$(e).attr('width');J=c.$(e).attr('height');if(H&&J){return{w:parseInt(H,10),h:parseInt(J,10)};}return null;}function s(e,H){var J,K;if(H){J=e.style.width;K=e.style.height;if(J||K){c.$(e).css({width:H.w,height:H.h}).removeAttr('data-mce-style');}J=e.width;K=e.height;if(J||K){c.$(e).attr({width:H.w,height:H.h});}}}function f(e){return{w:e.naturalWidth,h:e.naturalHeight};}function h(){return c.selection.getNode();}function j(){return'imagetools'+d++;}function k(e){var H=e.src;return H.indexOf('data:')===0||H.indexOf('blob:')===0||new U(H).host===c.documentBaseURI.host;}function m(e){return T.inArray(c.settings.imagetools_cors_hosts,new U(e.src).host)!==-1;}function n(){return c.settings.api_key||c.settings.imagetools_api_key;}function r(e){return new a(function(H){var J,K;J=new XMLHttpRequest();J.onload=function(){H(this.response);};J.open('GET',e,true);K=n();if(K){J.setRequestHeader("Content-Type","application/json;charset=UTF-8");J.setRequestHeader('tiny-api-key',K);}J.responseType='blob';J.send();});}function o(e){var H=e.src;if(m(e)){return r(e.src);}if(!k(e)){H=c.settings.imagetools_proxy;H+=(H.indexOf('?')===-1?'?':'&')+'url='+encodeURIComponent(e.src);if(n()){return r(H);}e=new Image();e.src=H;}return B.imageToBlob(e);}function q(){var e;e=c.editorUpload.blobCache.getByUri(h().src);if(e){return e;}return o(h()).then(function(H){return B.blobToBase64(H).then(function(J){var K=c.editorUpload.blobCache;var e=K.create(j(),H,J);K.add(e);return e;});});}function t(){i=D.setEditorTimeout(c,function(){c.editorUpload.uploadImagesAuto();},30000);}function u(){clearTimeout(i);}function v(e,H){return B.blobToDataUri(e).then(function(J){var K,L,M,N,O;O=h();K=j();M=c.editorUpload.blobCache;L=U.parseDataUri(J).data;N=M.create(K,e,L);M.add(N);c.undoManager.transact(function(){function Q(){c.$(O).off('load',Q);c.nodeChanged();if(H){c.editorUpload.uploadImagesAuto();}else{u();t();}}c.$(O).on('load',Q);c.$(O).attr({src:N.blobUri()}).removeAttr('data-mce-src');});return N;});}function w(e){return function(){return c._scanForImages().then(q).then(e).then(v);};}function x(e){return function(){return w(function(H){var J=g(h());if(J){s(h(),{w:J.h,h:J.w});}return I.rotate(H.blob(),e);})();};}function y(e){return function(){return w(function(H){return I.flip(H.blob(),e);})();};}function z(){var e=h(),H=f(e);if(e){o(e).then(b.edit).then(function(J){return new a(function(K){B.blobToImage(J).then(function(L){var M=f(L);if(H.w!=M.w||H.h!=M.h){if(g(e)){s(e,M);}}URL.revokeObjectURL(L.src);K(J);});});}).then(function(J){v(J,true);},function(){});}}function A(){c.addButton('rotateleft',{title:'Rotate counterclockwise',onclick:x(-90)});c.addButton('rotateright',{title:'Rotate clockwise',onclick:x(90)});c.addButton('flipv',{title:'Flip vertically',onclick:y('v')});c.addButton('fliph',{title:'Flip horizontally',onclick:y('h')});c.addButton('editimage',{title:'Edit image',onclick:z});c.addButton('imageoptions',{title:'Image options',icon:'options',cmd:'mceImage'});}function C(){c.on('NodeChange',function(e){if(l&&l.src!=e.element.src){u();c.editorUpload.uploadImagesAuto();l=undefined;}if(F(e.element)){l=e.element;}});}function F(e){var H=c.dom.is(e,'img:not([data-mce-object],[data-mce-placeholder])');return H&&(k(e)||m(e)||c.settings.imagetools_proxy);}function G(){var e=c.settings.imagetools_toolbar;if(!e){e='rotateleft rotateright | flipv fliph | crop editimage imageoptions';}c.addContextToolbar(F,e);}A();G();C();c.addCommand('mceEditImage',z);};P.add('imagetools',p);return function(){};});
