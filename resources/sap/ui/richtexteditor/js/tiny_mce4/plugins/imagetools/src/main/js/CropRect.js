define("tinymce/imagetoolsplugin/CropRect",["global!tinymce.dom.DomQuery","global!tinymce.ui.DragHelper","global!tinymce.geom.Rect","global!tinymce.util.Tools","global!tinymce.util.Observable"],function($,D,R,T,O){var c=0;return function(a,v,b,d){var i,f,g,j,p='mce-',k=p+'crid-'+(c++);f=[{name:'move',xMul:0,yMul:0,deltaX:1,deltaY:1,deltaW:0,deltaH:0},{name:'nw',xMul:0,yMul:0,deltaX:1,deltaY:1,deltaW:-1,deltaH:-1},{name:'ne',xMul:1,yMul:0,deltaX:0,deltaY:1,deltaW:1,deltaH:-1},{name:'sw',xMul:0,yMul:1,deltaX:1,deltaY:0,deltaW:-1,deltaH:1},{name:'se',xMul:1,yMul:1,deltaX:0,deltaY:0,deltaW:1,deltaH:1}];j=["top","right","bottom","left"];function l(e,h){return{x:h.x+e.x,y:h.y+e.y,w:h.w,h:h.h};}function m(e,h){return{x:h.x-e.x,y:h.y-e.y,w:h.w,h:h.h};}function n(){return m(b,a);}function r(){function B(C){var E;return new D(k,{document:d.ownerDocument,handle:k+'-'+C.name,start:function(){E=a;},drag:function(e){var x,y,w,h,F;x=E.x;y=E.y;w=E.w;h=E.h;x+=e.deltaX*C.deltaX;y+=e.deltaY*C.deltaY;w+=e.deltaX*C.deltaW;h+=e.deltaY*C.deltaH;if(w<20){w=20;}if(h<20){h=20;}F=a=R.clamp({x:x,y:y,w:w,h:h},b,C.name=='move');F=m(b,F);i.fire('updateRect',{rect:F});u(F);}});}$('<div id="'+k+'" class="'+p+'croprect-container" data-mce-bogus="all">').appendTo(d);T.each(j,function(e){$('#'+k,d).append('<div id="'+k+'-'+e+'"class="'+p+'croprect-block" style="display: none" data-mce-bogus="all">');});T.each(f,function(h){$('#'+k,d).append('<div id="'+k+'-'+h.name+'" class="'+p+'croprect-handle '+p+'croprect-handle-'+h.name+'" style="display: none" data-mce-bogus="all">');});g=T.map(f,B);o(a);}function t(e){var h;h=T.map(f,function(w){return'#'+k+'-'+w.name;}).concat(T.map(j,function(w){return'#'+k+'-'+w;})).join(',');if(e){$(h,d).show();}else{$(h,d).hide();}}function o(e){function h(w,e){if(e.h<0){e.h=0;}if(e.w<0){e.w=0;}$('#'+k+'-'+w,d).css({left:e.x,top:e.y,width:e.w,height:e.h});}T.each(f,function(w){$('#'+k+'-'+w.name,d).css({left:e.w*w.xMul+e.x,top:e.h*w.yMul+e.y});});h('top',{x:v.x,y:v.y,w:v.w,h:e.y-v.y});h('right',{x:e.x+e.w,y:e.y,w:v.w-e.x-e.w+v.x,h:e.h});h('bottom',{x:v.x,y:e.y+e.h,w:v.w,h:v.h-e.y-e.h+v.y});h('left',{x:v.x,y:e.y,w:e.x-v.x,h:e.h});h('move',e);}function s(e){a=e;o(a);}function q(e){v=e;o(a);}function u(e){s(l(b,e));}function z(e){b=e;o(a);}function A(){T.each(g,function(h){h.destroy();});g=[];}r(d);i=T.extend({toggleVisibility:t,setClampRect:z,setRect:s,getInnerRect:n,setInnerRect:u,setViewPortRect:q,destroy:A},O);return i;};});
