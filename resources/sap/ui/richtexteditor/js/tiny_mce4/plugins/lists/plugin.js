tinymce.PluginManager.add('lists',function(a){var s=this;function b(e){return a.$.contains(a.getBody(),e);}function c(n){return n&&n.nodeName=='BR';}function d(n){return n&&(/^(OL|UL|DL)$/).test(n.nodeName)&&b(n);}function f(n){return n.parentNode.firstChild==n;}function g(n){return n.parentNode.lastChild==n;}function h(n){return n&&!!a.schema.getTextBlockElements()[n.nodeName];}function j(e){return e===a.getBody();}a.on('init',function(){var k=a.dom,l=a.selection;function m(e,i){var y=k.isEmpty(e);if(i&&k.select('span[data-mce-type=bookmark]').length>0){return false;}return y;}function n(e){var i={};function y(F){var G,H,I;H=e[F?'startContainer':'endContainer'];I=e[F?'startOffset':'endOffset'];if(H.nodeType==1){G=k.create('span',{'data-mce-type':'bookmark'});if(H.hasChildNodes()){I=Math.min(I,H.childNodes.length-1);if(F){H.insertBefore(G,H.childNodes[I]);}else{k.insertAfter(G,H.childNodes[I]);}}else{H.appendChild(G);}H=G;I=0;}i[F?'startContainer':'endContainer']=H;i[F?'startOffset':'endOffset']=I;}y(true);if(!e.collapsed){y();}return i;}function o(e){function i(F){var G,H,I;function J(G){var I=G.parentNode.firstChild,K=0;while(I){if(I==G){return K;}if(I.nodeType!=1||I.getAttribute('data-mce-type')!='bookmark'){K++;}I=I.nextSibling;}return-1;}G=I=e[F?'startContainer':'endContainer'];H=e[F?'startOffset':'endOffset'];if(!G){return;}if(G.nodeType==1){H=J(G);G=G.parentNode;k.remove(I);}e[F?'startContainer':'endContainer']=G;e[F?'startOffset':'endOffset']=H;}i(true);i();var y=k.createRng();y.setStart(e.startContainer,e.startOffset);if(e.endContainer){y.setEnd(e.endContainer,e.endOffset);}l.setRng(y);}function p(e,i){var y,F,G=k.createFragment(),H;var I=a.schema.getBlockElements();if(a.settings.forced_root_block){i=i||a.settings.forced_root_block;}if(i){F=k.create(i);if(F.tagName===a.settings.forced_root_block){k.setAttribs(F,a.settings.forced_root_block_attrs);}G.appendChild(F);}if(e){while((y=e.firstChild)){var J=y.nodeName;if(!H&&(J!='SPAN'||y.getAttribute('data-mce-type')!='bookmark')){H=true;}if(I[J]){G.appendChild(y);F=null;}else{if(i){if(!F){F=k.create(i);G.appendChild(F);}F.appendChild(y);}else{G.appendChild(y);}}}}if(!a.settings.forced_root_block){G.appendChild(k.create('br'));}else{if(!H&&(!tinymce.Env.ie||tinymce.Env.ie>10)){F.appendChild(k.create('br',{'data-mce-bogus':'1'}));}}return G;}function q(){return tinymce.grep(l.getSelectedBlocks(),function(e){return/^(LI|DT|DD)$/.test(e.nodeName);});}function r(e,i,y){var F,G,H,I;function J(K){tinymce.each(H,function(I){K.parentNode.insertBefore(I,i.parentNode);});k.remove(K);}H=k.select('span[data-mce-type="bookmark"]',e);y=y||p(i);F=k.createRng();F.setStartAfter(i);F.setEndAfter(e);G=F.extractContents();for(I=G.firstChild;I;I=I.firstChild){if(I.nodeName=='LI'&&k.isEmpty(I)){k.remove(I);break;}}if(!k.isEmpty(G)){k.insertAfter(G,e);}k.insertAfter(y,e);if(m(i.parentNode)){J(i.parentNode);}k.remove(i);if(m(e)){k.remove(e);}}function t(e){var i,y;i=e.nextSibling;if(i&&d(i)&&i.nodeName==e.nodeName){while((y=i.firstChild)){e.appendChild(y);}k.remove(i);}i=e.previousSibling;if(i&&d(i)&&i.nodeName==e.nodeName){while((y=i.firstChild)){e.insertBefore(y,e.firstChild);}k.remove(i);}}function u(e){tinymce.each(tinymce.grep(k.select('ol,ul',e)),function(i){var y,F=i.parentNode;if(F.nodeName=='LI'&&F.firstChild==i){y=F.previousSibling;if(y&&y.nodeName=='LI'){y.appendChild(i);if(m(F)){k.remove(F);}}}if(d(F)){y=F.previousSibling;if(y&&y.nodeName=='LI'){y.appendChild(i);}}});}function v(e){var i=e.parentNode,y=i.parentNode,F;function G(e){if(m(e)){k.remove(e);}}if(j(i)){return true;}if(e.nodeName=='DD'){k.rename(e,'DT');return true;}if(f(e)&&g(e)){if(y.nodeName=="LI"){k.insertAfter(e,y);G(y);k.remove(i);}else if(d(y)){k.remove(i,true);}else{y.insertBefore(p(e),i);k.remove(i);}return true;}else if(f(e)){if(y.nodeName=="LI"){k.insertAfter(e,y);e.appendChild(i);G(y);}else if(d(y)){y.insertBefore(e,i);}else{y.insertBefore(p(e),i);k.remove(e);}return true;}else if(g(e)){if(y.nodeName=="LI"){k.insertAfter(e,y);}else if(d(y)){k.insertAfter(e,i);}else{k.insertAfter(p(e),i);k.remove(e);}return true;}if(y.nodeName=='LI'){i=y;F=p(e,'LI');}else if(d(y)){F=p(e,'LI');}else{F=p(e);}r(i,e,F);u(i.parentNode);return true;}function w(e){var i,y;function F(G,H){var I;if(d(G)){while((I=e.lastChild.firstChild)){H.appendChild(I);}k.remove(G);}}if(e.nodeName=='DT'){k.rename(e,'DD');return true;}i=e.previousSibling;if(i&&d(i)){i.appendChild(e);return true;}if(i&&i.nodeName=='LI'&&d(i.lastChild)){i.lastChild.appendChild(e);F(e.lastChild,i.lastChild);return true;}i=e.nextSibling;if(i&&d(i)){i.insertBefore(e,i.firstChild);return true;}if(i&&i.nodeName=='LI'&&d(e.lastChild)){return false;}i=e.previousSibling;if(i&&i.nodeName=='LI'){y=k.create(e.parentNode.nodeName);i.appendChild(y);y.appendChild(e);F(e.lastChild,y);return true;}return false;}function x(){var e=q();if(e.length){var y=n(l.getRng(true));for(var i=0;i<e.length;i++){if(!w(e[i])&&i===0){break;}}o(y);a.nodeChanged();return true;}}function z(){var e=q();if(e.length){var F=n(l.getRng(true));var i,y,G=a.getBody();i=e.length;while(i--){var H=e[i].parentNode;while(H&&H!=G){y=e.length;while(y--){if(e[y]===H){e.splice(i,1);break;}}H=H.parentNode;}}for(i=0;i<e.length;i++){if(!v(e[i])&&i===0){break;}}o(F);a.nodeChanged();return true;}}function A(e){var i=l.getRng(true),y,F='LI';if(k.getContentEditable(l.getNode())==="false"){return;}e=e.toUpperCase();if(e=='DL'){F='DT';}function G(){var H=[],I=a.getBody();function J(P){var Q,R;Q=i[P?'startContainer':'endContainer'];R=i[P?'startOffset':'endOffset'];if(Q.nodeType==1){Q=Q.childNodes[Math.min(R,Q.childNodes.length-1)]||Q;}while(Q.parentNode!=I){if(h(Q)){return Q;}if(/^(TD|TH)$/.test(Q.parentNode.nodeName)){return Q;}Q=Q.parentNode;}return Q;}var K=J(true);var L=J();var M,N=[];for(var O=K;O;O=O.nextSibling){N.push(O);if(O==L){break;}}tinymce.each(N,function(O){if(h(O)){H.push(O);M=null;return;}if(k.isBlock(O)||c(O)){if(c(O)){k.remove(O);}M=null;return;}var P=O.nextSibling;if(tinymce.dom.BookmarkManager.isBookmarkNode(O)){if(h(P)||(!P&&O.parentNode==I)){M=null;return;}}if(!M){M=k.create('p');O.parentNode.insertBefore(M,O);H.push(M);}M.appendChild(O);});return H;}y=n(i);tinymce.each(G(),function(H){var I,J;J=H.previousSibling;if(J&&d(J)&&J.nodeName==e){I=J;H=k.rename(H,F);J.appendChild(H);}else{I=k.create(e);H.parentNode.insertBefore(I,H);I.appendChild(H);H=k.rename(H,F);}t(I);});o(y);}function B(){var e=n(l.getRng(true)),i=a.getBody();tinymce.each(q(),function(y){var F,G;if(j(y.parentNode)){return;}if(m(y)){v(y);return;}for(F=y;F&&F!=i;F=F.parentNode){if(d(F)){G=F;}}r(G,y);});o(e);}function C(e){var i=k.getParent(l.getStart(),'OL,UL,DL');if(j(i)){return;}if(i){if(i.nodeName==e){B(e);}else{var y=n(l.getRng(true));t(k.rename(i,e));o(y);}}else{A(e);}}function D(e){return function(){var i=k.getParent(a.selection.getStart(),'UL,OL,DL');return i&&i.nodeName==e;};}function E(e){if(!c(e)){return false;}if(k.isBlock(e.nextSibling)&&!c(e.previousSibling)){return true;}return false;}s.backspaceDelete=function(i){function e(H,i){var K=H.startContainer,L=H.startOffset;var M,N;if(K.nodeType==3&&(i?L<K.data.length:L>0)){return K;}M=a.schema.getNonEmptyElements();N=new tinymce.dom.TreeWalker(H.startContainer,a.getBody());if(i){if(E(tinymce.dom.RangeUtils.getNode(H.startContainer,H.startOffset))){N.next();}}while((K=N[i?'next':'prev2']())){if(K.nodeName=='LI'&&!K.hasChildNodes()){return K;}if(M[K.nodeName]){return K;}if(K.nodeType==3&&K.data.length>0){return K;}}}function y(K,L){var M,N,G=K.parentNode;if(!b(K)||!b(L)){return;}if(d(L.lastChild)){N=L.lastChild;}if(G==L.lastChild){if(c(G.previousSibling)){k.remove(G.previousSibling);}}M=L.lastChild;if(M&&c(M)&&K.hasChildNodes()){k.remove(M);}if(m(L,true)){k.$(L).empty();}if(!m(K,true)){while((M=K.firstChild)){L.appendChild(M);}}if(N){L.appendChild(N);}k.remove(K);if(m(G)&&!j(G)){k.remove(G);}}if(l.isCollapsed()){var F=k.getParent(l.getStart(),'LI'),G,H,I;if(F){G=F.parentNode;if(j(G)&&k.isEmpty(G)){return true;}H=l.getRng(true);I=k.getParent(e(H,i),'LI');if(I&&I!=F){var J=n(H);if(i){y(I,F);}else{y(F,I);}o(J);return true;}else if(!I){if(!i&&B(G.nodeName)){return true;}}}}};a.on('BeforeExecCommand',function(e){var i=e.command.toLowerCase(),y;if(i=="indent"){if(x()){y=true;}}else if(i=="outdent"){if(z()){y=true;}}if(y){a.fire('ExecCommand',{command:e.command});e.preventDefault();return true;}});a.addCommand('InsertUnorderedList',function(){C('UL');});a.addCommand('InsertOrderedList',function(){C('OL');});a.addCommand('InsertDefinitionList',function(){C('DL');});a.addQueryStateHandler('InsertUnorderedList',D('UL'));a.addQueryStateHandler('InsertOrderedList',D('OL'));a.addQueryStateHandler('InsertDefinitionList',D('DL'));a.on('keydown',function(e){if(e.keyCode!=9||tinymce.util.VK.metaKeyPressed(e)){return;}if(a.dom.getParent(a.selection.getStart(),'LI,DT,DD')){e.preventDefault();if(e.shiftKey){z();}else{x();}}});});a.addButton('indent',{icon:'indent',title:'Increase indent',cmd:'Indent',onPostRender:function(){var e=this;a.on('nodechange',function(){var k=a.selection.getSelectedBlocks();var m=false;for(var i=0,l=k.length;!m&&i<l;i++){var t=k[i].nodeName;m=(t=='LI'&&f(k[i])||t=='UL'||t=='OL'||t=='DD');}e.disabled(m);});}});a.on('keydown',function(e){if(e.keyCode==tinymce.util.VK.BACKSPACE){if(s.backspaceDelete()){e.preventDefault();}}else if(e.keyCode==tinymce.util.VK.DELETE){if(s.backspaceDelete(true)){e.preventDefault();}}});});
