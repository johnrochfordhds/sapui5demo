tinymce.PluginManager.add('importcss',function(a){var s=this,b=tinymce.each;function r(u){var e=tinymce.Env.cacheSuffix;if(typeof u=='string'){u=u.replace('?'+e,'').replace('&'+e,'');}return u;}function c(h){var e=a.settings,i=e.skin!==false?e.skin||'lightgray':false;if(i){var j=e.skin_url;if(j){j=a.documentBaseURI.toAbsolute(j);}else{j=tinymce.baseURL+'/skins/'+i;}return h===j+'/content'+(a.inline?'.inline':'')+'.min.css';}return false;}function d(e){if(typeof e=="string"){return function(v){return v.indexOf(e)!==-1;};}else if(e instanceof RegExp){return function(v){return e.test(v);};}return e;}function g(h,i){var j=[],k={};function l(m,n){var o=m.href,p;o=r(o);if(!o||!i(o,n)||c(o)){return;}b(m.imports,function(m){l(m,true);});try{p=m.cssRules||m.rules;}catch(e){}b(p,function(q){if(q.styleSheet){l(q.styleSheet,true);}else if(q.selectorText){b(q.selectorText.split(','),function(t){j.push(tinymce.trim(t));});}});}b(a.contentCSS,function(u){k[u]=true;});if(!i){i=function(m,n){return n||k[m];};}try{b(h.styleSheets,function(m){l(m);});}catch(e){}return j;}function f(e){var h;var i=/^(?:([a-z0-9\-_]+))?(\.[a-z0-9_\-\.]+)$/i.exec(e);if(!i){return;}var j=i[1];var k=i[2].substr(1).split('.').join(' ');var l=tinymce.makeMap('a,img');if(i[1]){h={title:e};if(a.schema.getTextBlockElements()[j]){h.block=j;}else if(a.schema.getBlockElements()[j]||l[j.toLowerCase()]){h.selector=j;}else{h.inline=j;}}else if(i[2]){h={inline:'span',title:e.substr(1),classes:k};}if(a.settings.importcss_merge_classes!==false){h.classes=k;}else{h.attributes={"class":k};}return h;}a.on('renderFormatsMenu',function(e){var h=a.settings,j={};var k=h.importcss_selector_converter||f;var l=d(h.importcss_selector_filter),m=e.control;if(!a.settings.importcss_append){m.items().remove();}var n=[];tinymce.each(h.importcss_groups,function(i){i=tinymce.extend({},i);i.filter=d(i.filter);n.push(i);});b(g(e.doc||a.getDoc(),d(h.importcss_file_filter)),function(o){if(o.indexOf('.mce-')===-1){if(!j[o]&&(!l||l(o))){var p=k.call(s,o),q;if(p){var t=p.name||tinymce.DOM.uniqueId();if(n){for(var i=0;i<n.length;i++){if(!n[i].filter||n[i].filter(o)){if(!n[i].item){n[i].item={text:n[i].title,menu:[]};}q=n[i].item.menu;break;}}}a.formatter.register(t,p);var u=tinymce.extend({},m.settings.itemDefaults,{text:p.title,format:t});if(q){q.push(u);}else{m.add(u);}}j[o]=true;}}});b(n,function(i){m.add(i.item);});e.control.renderNew();});s.convertSelectorToFormat=f;});
