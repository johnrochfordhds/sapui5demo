(function(c,u){"use strict";var d={};function r(a,b){var m,e=[];for(var i=0;i<a.length;++i){m=d[a[i]]||h(a[i]);if(!m){throw'module definition dependecy not found: '+a[i];}e.push(m);}b.apply(null,e);}function f(i,a,b){if(typeof i!=='string'){throw'invalid module definition, module id must be defined and be a string';}if(a===u){throw'invalid module definition, dependencies must be specified';}if(b===u){throw'invalid module definition, definition function must be specified';}r(a,function(){d[i]=b.apply(null,arguments);});}function g(i){return!!d[i];}function h(i){var t=c;var a=i.split(/[.\/]/);for(var b=0;b<a.length;++b){if(!t[a[b]]){return;}t=t[a[b]];}return t;}function j(a){var i,t,b,e,p;for(i=0;i<a.length;i++){t=c;b=a[i];e=b.split(/[.\/]/);for(var k=0;k<e.length-1;++k){if(t[e[k]]===u){t[e[k]]={};}t=t[e[k]];}t[e[e.length-1]]=d[b];}if(c.AMDLC_TESTS){p=c.privateModules||{};for(b in d){p[b]=d[b];}for(i=0;i<a.length;i++){delete p[a[i]];}c.privateModules=p;}}
/**
 * DomTextMatcher.js
 *
 * Released under LGPL License.
 * Copyright (c) 1999-2015 Ephox Corp. All rights reserved
 *
 * License: http://www.tinymce.com/license
 * Contributing: http://www.tinymce.com/contributing
 */
f("tinymce/tinymcespellcheckerplugin/DomTextMatcher",[],function(){
// released under UNLICENSE that is compatible with LGPL
return function(n,e,w){var m,k=e.dom;var o,p,s,q="mce-spellchecker-ignore";o=e.schema.getBlockElements();p=e.schema.getWhiteSpaceElements();s=e.schema.getShortEndedElements();function t(m,a){if(!m[0]){throw'findAndReplaceDOMText cannot handle zero-length matches';}return{start:m.index,end:m.index+m[0].length,text:m[0],data:a};}function v(n){var a;if(n.nodeType===3){return n.data;}if(p[n.nodeName]&&!o[n.nodeName]){return'';}a='';if(o[n.nodeName]||s[n.nodeName]){a+='\n';}if((n=n.firstChild)){do{a+=v(n);}while((n=n.nextSibling));}return a;}function x(a){function b(a,G){for(var i=0;i<a.length;i++){if(a[i]===G){return true;}}return false;}var l=[];for(var i=0;i<a.length;i++){if(!b(l,a[i])){l.push(a[i]);}}return l;}function y(n){var a=v(n).match(w);return a?x(a):[];}function z(n,i,l){var G,H,I,J,K=[],L=0,M=n,N,O=0;i=i.slice(0);i.sort(function(a,b){return a.start-b.start;});N=i.shift();out:while(true){if(o[M.nodeName]||s[M.nodeName]){L++;}if(M.nodeType===3){if(!H&&M.length+L>=N.end){H=M;J=N.end-L;}else if(G){K.push(M);}if(!G&&M.length+L>N.start){G=M;I=N.start-L;}L+=M.length;}if(G&&H){var P=false;for(var Q=G;Q!=n;Q=Q.parentNode){if(Q.className===q){P=true;}}if(!P){M=l({startNode:G,startNodeIndex:I,endNode:H,endNodeIndex:J,innerNodes:K,match:N.text,matchIndex:O});L-=(H.length-J);}G=null;H=null;K=[];N=i.shift();O++;if(!N){break;}}else if((!p[M.nodeName]||o[M.nodeName])&&M.firstChild){M=M.firstChild;continue;}else if(M.nextSibling){M=M.nextSibling;continue;}while(true){if(M.nextSibling){M=M.nextSibling;break;}else if(M.parentNode!==n){M=M.parentNode;}else{break out;}}}}function A(a,b){function G(i,l){var H=a[l];if(!H.stencil){H.stencil=b(H);}var I=H.stencil.cloneNode(false);I.setAttribute('data-mce-index',l);if(i){I.appendChild(k.doc.createTextNode(i));}return I;}return function(H){var I,J,K,L=H.startNode,M=H.endNode,N=H.matchIndex,O=k.doc;if(L===M){var n=L;K=n.parentNode;if(H.startNodeIndex>0){I=O.createTextNode(n.data.substring(0,H.startNodeIndex));K.insertBefore(I,n);}var P=G(H.match,N);K.insertBefore(P,n);if(H.endNodeIndex<n.length){J=O.createTextNode(n.data.substring(H.endNodeIndex));K.insertBefore(J,n);}n.parentNode.removeChild(n);return P;}I=O.createTextNode(L.data.substring(0,H.startNodeIndex));J=O.createTextNode(M.data.substring(H.endNodeIndex));var Q=G(L.data.substring(H.startNodeIndex),N);var R=[];for(var i=0,l=H.innerNodes.length;i<l;++i){var S=H.innerNodes[i];var T=G(S.data,N);S.parentNode.replaceChild(T,S);R.push(T);}var U=G(M.data.substring(0,H.endNodeIndex),N);K=L.parentNode;K.insertBefore(I,L);K.insertBefore(Q,L);K.removeChild(L);K=M.parentNode;K.insertBefore(U,M);K.insertBefore(J,M);K.removeChild(M);return U;};}function B(a,b){var i=a.length;while(i--){if(a[i]===b){return i;}}return-1;}function C(a,b){var l=[];D(a,function(G,i){if(b(G,i)){l.push(G);}});a=l;return l;}function D(a,b){for(var i=0,l=a.length;i<l;i++){if(b(a[i],i)===false){break;}}return this;}function E(a,b,n){if(a.length){z(n,a,A(a,b));}return this;}function F(a,b,n){var i=[];var l=v(n);if(l&&a.global){while((m=a.exec(l))){i.push(t(m,b));}}return i;}return{getText:v,getWords:y,each:D,filter:C,find:F,wrap:E,indexOf:B};};});
/**
 * SpellingCache.js
 *
 * Released under LGPL License.
 * Copyright (c) 1999-2015 Ephox Corp. All rights reserved
 *
 * License: http://www.tinymce.com/license
 * Contributing: http://www.tinymce.com/contributing
 */
f("tinymce/tinymcespellcheckerplugin/SpellingCache",["tinymce/util/JSON"],function(J){return function(){var s="tinyMCESpellingCache",a={},b=5;function e(w){return w.replace(/\uFEFF/g,'');}function i(o,w,p,q){var t=m(o),v=e(w),x={misspelled:p,suggestions:q};t[o][v]=x;if(k()){sessionStorage.setItem(s,J.serialize(t));}else{a=t;}}function k(){return typeof(Storage)!=="undefined";}function l(o,p){if(!p[o]){p[o]={};}return p;}function m(o){var p=k()&&sessionStorage.getItem(s)?J.parse(sessionStorage.getItem(s)):a;return l(o,p);}function n(o,w){var p=m(o),q=e(w),t=p[o][q]?p[o][q]:false;if(t&&t.suggestions&&t.suggestions.length>b){t.suggestions=t.suggestions.slice(0,b);}return t;}return{addWordToCache:i,retrieveWordFromCache:n};};});
/**
 * Plugin.js
 *
 * Released under LGPL License.
 * Copyright (c) 1999-2015 Ephox Corp. All rights reserved
 *
 * License: http://www.tinymce.com/license
 * Contributing: http://www.tinymce.com/contributing
 */
f("tinymce/tinymcespellcheckerplugin/Plugin",["tinymce/tinymcespellcheckerplugin/DomTextMatcher","tinymce/tinymcespellcheckerplugin/SpellingCache","tinymce/PluginManager","tinymce/util/Tools","tinymce/ui/Menu","tinymce/dom/DOMUtils","tinymce/util/XHR","tinymce/util/URI","tinymce/util/JSON"],function(D,S,P,T,M,a,X,U,J){P.add('tinymcespellchecker',function(b,k){var s=this,l,m=b.settings,n=1,o='['+'\\w'+'\''+'\\-'+'\\u00C0-\\u00FF'+'\\uFEFF'+'\\u2018\\u2019'+']+',p=m.spellchecker_languages||'US English=en,UK English=en_gb,Danish=da,Dutch=nl,Finnish=fi,French=fr,'+'German=de,Italian=it,Norwegian=nb,Brazilian Portuguese=pt,Iberian Portuguese=pt_pt,'+'Spanish=es,Swedish=sv',q,t="mce-spellchecker-word",v="mce-spellchecker-ignore",x,y=true,z,A,B,C,E,F,G=15000;function H(){if(!s.textMatcher){s.textMatcher=new D(b.getBody(),b,L());}return s.textMatcher;}function I(){if(!s.spellingCache){s.spellingCache=new S();}return s.spellingCache;}function K(w,i){var w1=[],x1=I().retrieveWordFromCache(m.spellchecker_language,w).suggestions;T.each(x1,function(e){w1.push({text:e,onclick:function(){b.insertContent(b.dom.encode(e));b.dom.remove(i);}});});w1.push({text:'-'});w1.push.apply(w1,[{text:'Ignore',onclick:function(){_(w,i);}},{text:'Ignore all',onclick:function(){_(w,i,true);}}]);l=new M({items:w1,context:'contextmenu',onautohide:function(e){if(e.target.className.indexOf('spellchecker')!=-1){e.preventDefault();}},onhide:function(){l.remove();l=null;}});l.renderTo(document.body);var y1=a.DOM.getPos(b.getContentAreaContainer());var z1=b.dom.getPos(i[0]);var A1=b.dom.getRoot();if(A1.nodeName=='BODY'){z1.x-=A1.ownerDocument.documentElement.scrollLeft||A1.scrollLeft;z1.y-=A1.ownerDocument.documentElement.scrollTop||A1.scrollTop;}else{z1.x-=A1.scrollLeft;z1.y-=A1.scrollTop;}y1.x+=z1.x;y1.y+=z1.y;l.moveTo(y1.x,y1.y+i[0].offsetHeight);}function L(){return b.getParam('spellchecker_wordchar_pattern')||new RegExp(o,"g");}function N(w){return w.replace(/\uFEFF/g,'');}function O(w){var e={},w1=[],x1=[];for(var i=0;i<w.length;i++){var y1=I().retrieveWordFromCache(m.spellchecker_language,w[i]);if(y1&&y1.misspelled){e[w[i]]=y1;}if(!y1){w1.push({original:w[i],cleaned:N(w[i])});x1.push(N(w[i]));}}return{cachedData:e,wordsToCheck:w1,cleanedWordsForServer:x1};}function Q(e,i,w){e=J.parse(e);if(!e){R("Server response wasn't proper JSON.");C=true;}else{B.push(e);E++;if(!C&&E===F){b.setProgressState(false);h1(i.cachedData,B,i.wordsToCheck,w);}}}function R(e){if(!C){b.setProgressState(false);b.notificationManager.open({text:e,type:'error'});}}function V(){return m.api_key||m.spellchecker_api_key;}function W(e,i,w){var w1="/"+n+"/correction";var x1={url:new U(k).toAbsolute(m.spellchecker_rpc_url+w1),type:"post",content_type:'application/json',data:J.serialize(e),success:function(z1){Q.call(s,z1,i,w);},error:function(z1,A1){R("Spellchecker request error: "+A1.status);C=true;}};var y1=V();if(y1){x1.requestheaders=[{key:'tiny-api-key',value:y1}];}return x1;}function Y(w){var e=0,w1=0,x1=[];for(var i=0;i<w.length;i++){e+=w[i].length;if(e>G){x1.push({words:w.slice(w1,i+1),language:m.spellchecker_language});w1=i+1;e=0;}}if(w1!=w.length){x1.push({words:w.slice(w1,w.length),language:m.spellchecker_language});}F=x1.length;B=[];E=0;C=false;return x1;}function Z(w,e){var w1=O(w);if(w1.wordsToCheck.length>0){var x1=Y(w1.cleanedWordsForServer);for(var i=0;i<x1.length;i++){var y1=W(x1[i],w1,e);X.send(y1);}}else{h1(w1.cachedData,[],w1.wordsToCheck,e);}}function $(e){Z(H().getWords(e),e);b.focus();}function _(w,e,i){b.selection.collapse();if(i){T.each(b.dom.select('span.'+t),function(w1){if(w1.getAttribute('data-mce-word')==w){w1.className=v;}});}else{T.each(e,function(w1){w1.className=v;});}}function a1(e){var i=e.getAttribute('data-mce-index');if(typeof i=="number"){return""+i;}return i;}function b1(e,w){var w1,x1=[];w1=T.toArray(w.getElementsByTagName('span'));if(w1.length){for(var i=0;i<w1.length;i++){var y1=a1(w1[i]);if(y1===null||!y1.length){continue;}if(y1===e.toString()){x1.push(w1[i]);}}}return x1;}function c1(e){var i=m.spellchecker_language;T.each(e.control.items(),function(w){w.active(w.data.data===i);});}function d1(e){e.control.on('show',function(i){c1(i);});}function e1(e){A=e.control;e.control.on('show',function(){this.active(y);});A.active(y);}function f1(e,i,w1){var x1={};for(var y1 in e){if(e[y1]&&e[y1].misspelled){x1[y1]=e[y1].suggestions;}}for(var z1 in i){I().addWordToCache(m.spellchecker_language,z1,true,i[z1]);for(var w=0;w<w1.length;w++){if(w1[w].cleaned===z1){x1[w1[w].original]=i[z1];break;}}}return x1;}function g1(w){for(var i=0;i<w.length;i++){var e=I().retrieveWordFromCache(m.spellchecker_language,w[i].cleaned);if(!e){I().addWordToCache(m.spellchecker_language,w[i].cleaned,false,[]);}}}function h1(e,w,w1,x1){var y1={};for(var i=0;i<w.length;i++){for(var z1 in w[i].spell){y1[z1]=w[i].spell[z1];}}var A1=f1(e,y1,w1);g1(w1);k1(A1,x1);}function i1(w){var e=w.parentNode;var i=w.childNodes;while(i.length>0){e.insertBefore(i[0],w);}w.parentNode.removeChild(w);}function j1(e){var w=b.dom.select('span.'+t,e);for(var i=0;i<w.length;i++){i1(w[i]);}}function k1(e,i){var w=b.selection.getBookmark();j1(i);var w1=H().find(L(),u,i);w1=H().filter(w1,function(x1){return!!e[x1.text];});H().wrap(w1,function(x1){return b.dom.create('span',{"class":t,"data-mce-bogus":1,"data-mce-word":x1.text});},i);b.selection.moveToBookmark(w);}function l1(e){var i=b.getBody(),w=i,w1=b.schema.getBlockElements();for(e=e;e!=i;e=e.parentNode){if(e===null||e===u){break;}if(w1[e.nodeName]){w=e;break;}}return w;}function m1(e,i){var w=[];T.each(i,function(w1){w.push({selectable:true,text:w1.name,data:w1.value,onclick:function(){m.spellchecker_language=w1.value;if(y){$(b.getBody());}}});});return w;}q=m1('Language',T.map(p.split(','),function(e){e=e.split('=');return{name:e[0],value:e[1]};}));function n1(){if(y){v1();j1(b.getBody());}else{u1();$(b.getBody());}y=!y;z.active(y);if(A){A.active(y);}}var o1={tooltip:'Spellcheck',onclick:n1,onPostRender:function(e){e.control.active(y);}};if(q.length>1){o1.type='splitbutton';o1.menu=q;o1.onshow=c1;o1.onpostrender=function(e){z=e.control;};}b.addButton('spellchecker',o1);b.addCommand('mceSpellCheck',n1);b.addMenuItem('spellchecker',{text:'Spellcheck',context:'tools',onclick:n1,onPostRender:e1,selectable:true});b.addMenuItem('spellcheckerlanguage',{text:'Spellcheck Language',context:'tools',menu:q,onPostRender:d1});function p1(){if(l){l.remove();l=null;}}function q1(e){if((e.which||e.keycode)===37||(e.which||e.keycode)===38||(e.which||e.keycode)===39||(e.which||e.keycode)===40){return;}var w=b.selection.getNode();if(a.DOM.hasClass(w,t)||a.DOM.hasClass(w,v)){var w1=l1(w),x1=b1(a1(w),w1);if(x1.length>0){var bm=b.selection.getBookmark();for(var i=0;i<x1.length;i++){i1(x1[i]);}b.selection.moveToBookmark(bm);}}}function r1(e){var i=b.selection.getNode(),w=l1(i);if((e.which||e.keycode)===32){$(w);}}function s1(e){if(e.selectionChange){return;}var i=x;x=l1(e.element);if(i===x){return;}if(i){$(i);}}function t1(e){var i=e.target;if(a.DOM.hasClass(i,t)){var w=b1(a1(i),l1(i));if(w.length>0){var w1=b.dom.createRng();w1.setStartBefore(w[0]);w1.setEndAfter(w[w.length-1]);b.selection.setRng(w1);K(i.getAttribute('data-mce-word'),w,e);}e.preventDefault();e.stopImmediatePropagation();}}function u1(){b.on('remove',p1);b.on('keydown',q1);b.on('keyup',r1);b.on('nodechange',s1);}function v1(){b.off('remove',p1);b.off('keydown',q1);b.off('keyup',r1);b.off('nodechange',s1);}b.on('contextmenu',t1,true);u1();this.getTextMatcher=H;this.getWordCharPattern=L;this.markErrors=k1;this.getLanguage=function(){return m.spellchecker_language;};m.spellchecker_language=m.spellchecker_language||m.language||'en';});});j(["tinymce/tinymcespellcheckerplugin/DomTextMatcher","tinymce/tinymcespellcheckerplugin/SpellingCache"]);})(this);
