define("tinymce/tableplugin/TableGrid",["tinymce/util/Tools","tinymce/Env","tinymce/tableplugin/Utils"],function(T,E,U){var e=T.each,g=U.getSpanVal;return function(a,t,s){var b,d,f,h,j=a.selection,k=j.dom;function l(){a.$('td[data-mce-selected],th[data-mce-selected]').removeAttr('data-mce-selected');}function m(c){return c===a.getBody();}function n(c,i){if(!c){return[];}i=T.map(i.split(','),function(r){return r.toLowerCase();});return T.grep(c.childNodes,function(c){return T.inArray(i,c.nodeName.toLowerCase())!==-1;});}function o(){var c=0;b=[];d=0;e(['thead','tbody','tfoot'],function(i){var r=n(t,i)[0];var Y=n(r,'tr');e(Y,function(Z,y){y+=c;e(n(Z,'td,th'),function($,x){var _,y2,b1,c1;if(b[y]){while(b[y][x]){x++;}}b1=g($,'rowspan');c1=g($,'colspan');for(y2=y;y2<y+b1;y2++){if(!b[y2]){b[y2]=[];}for(_=x;_<x+c1;_++){b[y2][_]={part:i,real:y2==y&&_==x,elm:$,rowspan:b1,colspan:c1};}}d=Math.max(d,x+1);});});c+=Y.length;});}function p(c){a.fire('newrow',{node:c});return c;}function q(c){a.fire('newcell',{node:c});return c;}function u(c,i){c=c.cloneNode(i);c.removeAttribute('id');return c;}function v(x,y){var r;r=b[y];if(r){return r[x];}}function w(c,i,r){if(c){r=parseInt(r,10);if(r===1){c.removeAttribute(i,1);}else{c.setAttribute(i,r,1);}}}function z(c){return c&&(!!k.getAttrib(c.elm,'data-mce-selected')||c==s);}function A(){var r=[];e(t.rows,function(c){e(c.cells,function(i){if(k.getAttrib(i,'data-mce-selected')||(s&&i==s.elm)){r.push(c);return false;}});});return r;}function B(){var r=k.createRng();if(m(t)){return;}r.setStartAfter(t);r.setEndAfter(t);j.setRng(r);k.remove(t);}function C(c){var i,r={};if(a.settings.table_clone_elements!==false){r=T.makeMap((a.settings.table_clone_elements||'strong em b i span font h1 h2 h3 h4 h5 h6 p div').toUpperCase(),/[ ,]/);}T.walk(c,function(x){var y;if(x.nodeType==3){e(k.getParents(x.parentNode,null,c).reverse(),function(x){if(!r[x.nodeName]){return;}x=u(x,false);if(!i){i=y=x;}else if(y){y.appendChild(x);}y=x;});if(y){y.innerHTML=E.ie&&E.ie<10?'&nbsp;':'<br data-mce-bogus="1" />';}return false;}},'childNodes');c=u(c,false);q(c);w(c,'rowSpan',1);w(c,'colSpan',1);if(i){c.appendChild(i);}else{U.paddCell(c);}return c;}function D(){var r=k.createRng(),c;e(k.select('tr',t),function(i){if(i.cells.length===0){k.remove(i);}});if(k.select('tr',t).length===0){r.setStartBefore(t);r.setEndBefore(t);j.setRng(r);k.remove(t);return;}e(k.select('thead,tbody,tfoot',t),function(i){if(i.rows.length===0){k.remove(i);}});o();if(f){c=b[Math.min(b.length-1,f.y)];if(c){j.select(c[Math.min(c.length-1,f.x)].elm,true);j.collapse(true);}}}function F(x,y,i,Y){var Z,$,r,c,_;Z=b[y][x].elm.parentNode;for(r=1;r<=i;r++){Z=k.getNext(Z,'tr');if(Z){for($=x;$>=0;$--){_=b[y+r][$].elm;if(_.parentNode==Z){for(c=1;c<=Y;c++){k.insertAfter(C(_),_);}break;}}if($==-1){for(c=1;c<=Y;c++){Z.insertBefore(C(Z.cells[0]),Z.cells[0]);}}}}}function G(){e(b,function(r,y){e(r,function(c,x){var Y,Z,i;if(z(c)){c=c.elm;Y=g(c,'colspan');Z=g(c,'rowspan');if(Y>1||Z>1){w(c,'rowSpan',1);w(c,'colSpan',1);for(i=0;i<Y-1;i++){k.insertAfter(C(c),c);}F(x,y,Z-1,Y);}}});});}function H(c,i,r){var Y,Z,$,_,a1,x,y,b1,c1,d1,e1;if(c){Y=R(c);Z=Y.x;$=Y.y;_=Z+(i-1);a1=$+(r-1);}else{f=h=null;e(b,function(f1,y){e(f1,function(c,x){if(z(c)){if(!f){f={x:x,y:y};}h={x:x,y:y};}});});if(f){Z=f.x;$=f.y;_=h.x;a1=h.y;}}b1=v(Z,$);c1=v(_,a1);if(b1&&c1&&b1.part==c1.part){G();o();b1=v(Z,$).elm;w(b1,'colSpan',(_-Z)+1);w(b1,'rowSpan',(a1-$)+1);for(y=$;y<=a1;y++){for(x=Z;x<=_;x++){if(!b[y]||!b[y][x]){continue;}c=b[y][x].elm;if(c!=b1){d1=T.grep(c.childNodes);e(d1,function(f1){b1.appendChild(f1);});if(d1.length){d1=T.grep(b1.childNodes);e1=0;e(d1,function(f1){if(f1.nodeName=='BR'&&e1++<d1.length-1){b1.removeChild(f1);}});}k.remove(c);}}}D();}}function I(c){var i,r,Y,x,Z,$,_,a1,b1;e(b,function(c1,y){e(c1,function(r){if(z(r)){r=r.elm;Z=r.parentNode;$=p(u(Z,false));i=y;if(c){return false;}}});if(c){return!i;}});if(i===undefined){return;}for(x=0;x<b[0].length;x++){if(!b[i][x]){continue;}r=b[i][x].elm;if(r!=Y){if(!c){b1=g(r,'rowspan');if(b1>1){w(r,'rowSpan',b1+1);continue;}}else{if(i>0&&b[i-1][x]){a1=b[i-1][x].elm;b1=g(a1,'rowSpan');if(b1>1){w(a1,'rowSpan',b1+1);continue;}}}_=C(r);w(_,'colSpan',r.colSpan);$.appendChild(_);Y=r;}}if($.hasChildNodes()){if(!c){k.insertAfter($,Z);}else{Z.parentNode.insertBefore($,Z);}}}function J(c){var i,r;e(b,function(y){e(y,function(Y,x){if(z(Y)){i=x;if(c){return false;}}});if(c){return!i;}});e(b,function(x,y){var Y,Z,$;if(!x[i]){return;}Y=x[i].elm;if(Y!=r){$=g(Y,'colspan');Z=g(Y,'rowspan');if($==1){if(!c){k.insertAfter(C(Y),Y);F(i,y,Z-1,$);}else{Y.parentNode.insertBefore(C(Y),Y);F(i,y,Z-1,$);}}else{w(Y,'colSpan',Y.colSpan+1);}r=Y;}});}function K(b){return T.grep(L(b),z);}function L(b){var c=[];e(b,function(r){e(r,function(i){c.push(i);});});return c;}function M(){var c=[];if(m(t)){if(b[0].length==1){return;}if(K(b).length==L(b).length){return;}}e(b,function(r){e(r,function(i,x){if(z(i)&&T.inArray(c,x)===-1){e(b,function(r){var i=r[x].elm,y;y=g(i,'colSpan');if(y>1){w(i,'colSpan',y-1);}else{k.remove(i);}});c.push(x);}});});D();}function N(){var r;function c(i){var x,y;e(i.cells,function(Y){var Z=g(Y,'rowSpan');if(Z>1){w(Y,'rowSpan',Z-1);x=R(Y);F(x.x,x.y,1,1);}});x=R(i.cells[0]);e(b[x.y],function(Y){var Z;Y=Y.elm;if(Y!=y){Z=g(Y,'rowSpan');if(Z<=1){k.remove(Y);}else{w(Y,'rowSpan',Z-1);}y=Y;}});}r=A();if(m(t)&&r.length==t.rows.length){return;}e(r.reverse(),function(i){c(i);});D();}function O(){var r=A();if(m(t)&&r.length==t.rows.length){return;}k.remove(r);D();return r;}function P(){var r=A();e(r,function(c,i){r[i]=u(c,true);});return r;}function Q(r,c){var x=A(),y=x[c?0:x.length-1],Y=y.cells.length;if(!r){return;}e(b,function(i){var Z;Y=0;e(i,function($){if($.real){Y+=$.colspan;}if($.elm.parentNode==y){Z=1;}});if(Z){return false;}});if(!c){r.reverse();}e(r,function(Z){var i,$=Z.cells.length,_;p(Z);for(i=0;i<$;i++){_=Z.cells[i];q(_);w(_,'colSpan',1);w(_,'rowSpan',1);}for(i=$;i<Y;i++){Z.appendChild(q(C(Z.cells[$-1])));}for(i=Y;i<$;i++){k.remove(Z.cells[i]);}if(c){y.parentNode.insertBefore(Z,y);}else{k.insertAfter(Z,y);}});l();}function R(c){var i;e(b,function(r,y){e(r,function(Y,x){if(Y.elm==c){i={x:x,y:y};return false;}});return!i;});return i;}function S(c){f=R(c);}function V(){var c,i;c=i=0;e(b,function(r,y){e(r,function(Y,x){var Z,$;if(z(Y)){Y=b[y][x];if(x>c){c=x;}if(y>i){i=y;}if(Y.real){Z=Y.colspan-1;$=Y.rowspan-1;if(Z){if(x+Z>c){c=x+Z;}}if($){if(y+$>i){i=y+$;}}}}});});return{x:c,y:i};}function W(c){var i,r,Y,Z,$,_,a1,b1,x,y;h=R(c);if(f&&h){i=Math.min(f.x,h.x);r=Math.min(f.y,h.y);Y=Math.max(f.x,h.x);Z=Math.max(f.y,h.y);$=Y;_=Z;for(y=r;y<=_;y++){c=b[y][i];if(!c.real){if(i-(c.colspan-1)<i){i-=c.colspan-1;}}}for(x=i;x<=$;x++){c=b[r][x];if(!c.real){if(r-(c.rowspan-1)<r){r-=c.rowspan-1;}}}for(y=r;y<=Z;y++){for(x=i;x<=Y;x++){c=b[y][x];if(c.real){a1=c.colspan-1;b1=c.rowspan-1;if(a1){if(x+a1>$){$=x+a1;}}if(b1){if(y+b1>_){_=y+b1;}}}}}l();for(y=r;y<=_;y++){for(x=i;x<=$;x++){if(b[y][x]){k.setAttrib(b[y][x].elm,'data-mce-selected','1');}}}}}function X(c,i){var r,x,y;r=R(c);x=r.y*d+r.x;do{x+=i;y=v(x%d,Math.floor(x/d));if(!y){break;}if(y.elm!=c){j.select(y.elm,true);if(k.isEmpty(y.elm)){j.collapse(true);}return true;}}while(y.elm==c);return false;}t=t||k.getParent(j.getStart(true),'table');o();s=s||k.getParent(j.getStart(true),'th,td');if(s){f=R(s);h=V();s=v(f.x,f.y);}T.extend(this,{deleteTable:B,split:G,merge:H,insertRow:I,insertCol:J,deleteCols:M,deleteRows:N,cutRows:O,copyRows:P,pasteRows:Q,getPos:R,setStartCell:S,setEndCell:W,moveRelIdx:X,refresh:o});};});
