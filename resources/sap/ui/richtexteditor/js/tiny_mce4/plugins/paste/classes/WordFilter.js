define("tinymce/pasteplugin/WordFilter",["tinymce/util/Tools","tinymce/html/DomParser","tinymce/html/Schema","tinymce/html/Serializer","tinymce/html/Node","tinymce/pasteplugin/Utils"],function(T,D,S,a,N,U){function b(e){return((/<font face="Times New Roman"|class="?Mso|style="[^"]*\bmso-|style='[^'']*\bmso-|w:WordDocument/i).test(e)||(/class="OutlineElement/).test(e)||(/id="?docs\-internal\-guid\-/.test(e)));}function c(t){var f,p;p=[/^[IVXLMCD]{1,2}\.[ \u00a0]/,/^[ivxlmcd]{1,2}\.[ \u00a0]/,/^[a-z]{1,2}[\.\)][ \u00a0]/,/^[A-Z]{1,2}[\.\)][ \u00a0]/,/^[0-9]+\.[ \u00a0]/,/^[\u3007\u4e00\u4e8c\u4e09\u56db\u4e94\u516d\u4e03\u516b\u4e5d]+\.[ \u00a0]/,/^[\u58f1\u5f10\u53c2\u56db\u4f0d\u516d\u4e03\u516b\u4e5d\u62fe]+\.[ \u00a0]/];t=t.replace(/^[\u00a0 ]+/,'');T.each(p,function(e){if(e.test(t)){f=true;return false;}});return f;}function d(t){return/^[\s\u00a0]*[\u2022\u00b7\u00a7\u25CF]\s*/.test(t);}function W(f){var s=f.settings;f.on('BeforePastePreProcess',function(e){var g=e.content,r,v;g=g.replace(/<b[^>]+id="?docs-internal-[^>]*>/gi,'');g=g.replace(/<br class="?Apple-interchange-newline"?>/gi,'');r=s.paste_retain_style_properties;if(r){v=T.makeMap(r.split(/[, ]/));}function h(o){var p,q,t=1;function u(o){var F='';if(o.type===3){return o.value;}if((o=o.firstChild)){do{F+=u(o);}while((o=o.next));}return F;}function w(o,F){if(o.type===3){if(F.test(o.value)){o.value=o.value.replace(F,'');return false;}}if((o=o.firstChild)){do{if(!w(o,F)){return false;}}while((o=o.next));}return true;}function x(o){if(o._listIgnore){o.remove();return;}if((o=o.firstChild)){do{x(o);}while((o=o.next));}}function y(F,G,E){var H=F._listLevel||t;if(H!=t){if(H<t){if(p){p=p.parent.parent;}}else{q=p;p=null;}}if(!p||p.name!=G){q=q||p;p=new N(G,1);if(E>1){p.attr('start',''+E);}F.wrap(p);}else{p.append(F);}F.name='li';if(H>t&&q){q.lastChild.append(p);}t=H;x(F);w(F,/^\u00a0+/);w(F,/^\s*([\u2022\u00b7\u00a7\u25CF]|\w+\.)/);w(F,/^\u00a0+/);}var z=[],A=o.firstChild;while(typeof A!=='undefined'&&A!==null){z.push(A);A=A.walk();if(A!==null){while(typeof A!=='undefined'&&A.parent!==o){A=A.walk();}}}for(var i=0;i<z.length;i++){o=z[i];if(o.name=='p'&&o.firstChild){var B=u(o);if(d(B)){y(o,'ul');continue;}if(c(B)){var C=/([0-9]+)\./.exec(B);var E=1;if(C){E=parseInt(C[1],10);}y(o,'ol',E);continue;}if(o._listLevel){y(o,'ul',1);continue;}p=null;}else{q=p;p=null;}}}function j(i,o){var p={},q,t=f.dom.parseStyle(o);T.each(t,function(u,w){switch(w){case'mso-list':q=/\w+ \w+([0-9]+)/i.exec(o);if(q){i._listLevel=parseInt(q[1],10);}if(/Ignore/i.test(u)&&i.firstChild){i._listIgnore=true;i.firstChild._listIgnore=true;}break;case"horiz-align":w="text-align";break;case"vert-align":w="vertical-align";break;case"font-color":case"mso-foreground":w="color";break;case"mso-background":case"mso-highlight":w="background";break;case"font-weight":case"font-style":if(u!="normal"){p[w]=u;}return;case"mso-element":if(/^(comment|comment-list)$/i.test(u)){i.remove();return;}break;}if(w.indexOf('mso-comment')===0){i.remove();return;}if(w.indexOf('mso-')===0){return;}if(r=="all"||(v&&v[w])){p[w]=u;}});if(/(bold)/i.test(p["font-weight"])){delete p["font-weight"];i.wrap(new N("b",1));}if(/(italic)/i.test(p["font-style"])){delete p["font-style"];i.wrap(new N("i",1));}p=f.dom.serializeStyle(p,i.name);if(p){return p;}return null;}if(s.paste_enable_default_filters===false){return;}if(b(e.content)){e.wordContent=true;g=U.filter(g,[/<!--[\s\S]+?-->/gi,/<(!|script[^>]*>.*?<\/script(?=[>\s])|\/?(\?xml(:\w+)?|img|meta|link|style|\w:\w+)(?=[\s\/>]))[^>]*>/gi,[/<(\/?)s>/gi,"<$1strike>"],[/&nbsp;/gi,"\u00a0"],[/<span\s+style\s*=\s*"\s*mso-spacerun\s*:\s*yes\s*;?\s*"\s*>([\s\u00a0]*)<\/span>/gi,function(i,o){return(o.length>0)?o.replace(/./," ").slice(Math.floor(o.length/2)).split("").join("\u00a0"):"";}]]);var k=s.paste_word_valid_elements;if(!k){k=('-strong/b,-em/i,-u,-span,-p,-ol,-ul,-li,-h1,-h2,-h3,-h4,-h5,-h6,'+'-p/div,-a[href|name],sub,sup,strike,br,del,table[width],tr,'+'td[colspan|rowspan|width],th[colspan|rowspan|width],thead,tfoot,tbody');}var l=new S({valid_elements:k,valid_children:'-li[p]'});T.each(l.elements,function(i){if(!i.attributes["class"]){i.attributes["class"]={};i.attributesOrder.push("class");}if(!i.attributes.style){i.attributes.style={};i.attributesOrder.push("style");}});var m=new D({},l);m.addAttributeFilter('style',function(o){var i=o.length,p;while(i--){p=o[i];p.attr('style',j(p,p.attr('style')));if(p.name=='span'&&p.parent&&!p.attributes.length){p.unwrap();}}});m.addAttributeFilter('class',function(o){var i=o.length,p,q;while(i--){p=o[i];q=p.attr('class');if(/^(MsoCommentReference|MsoCommentText|msoDel)$/i.test(q)){p.remove();}p.attr('class',null);}});m.addNodeFilter('del',function(o){var i=o.length;while(i--){o[i].remove();}});m.addNodeFilter('a',function(o){var i=o.length,p,q,t;while(i--){p=o[i];q=p.attr('href');t=p.attr('name');if(q&&q.indexOf('#_msocom_')!=-1){p.remove();continue;}if(q&&q.indexOf('file://')===0){q=q.split('#')[1];if(q){q='#'+q;}}if(!q&&!t){p.unwrap();}else{if(t&&!/^_?(?:toc|edn|ftn)/i.test(t)){p.unwrap();continue;}p.attr({href:q,name:t});}}});var n=m.parse(g);if(s.paste_convert_word_fake_lists!==false){h(n);}e.content=new a({validate:s.validate},l).serialize(n);}});}W.isWordContent=b;return W;});
