(function(a,u){"use strict";var m={};function r(e,g){var h,j=[];for(var i=0;i<e.length;++i){h=m[e[i]]||c(e[i]);if(!h){throw'module definition dependecy not found: '+e[i];}j.push(h);}g.apply(null,j);}function d(i,e,g){if(typeof i!=='string'){throw'invalid module definition, module id must be defined and be a string';}if(e===u){throw'invalid module definition, dependencies must be specified';}if(g===u){throw'invalid module definition, definition function must be specified';}r(e,function(){m[i]=g.apply(null,arguments);});}function b(i){return!!m[i];}function c(i){var t=a;var e=i.split(/[.\/]/);for(var g=0;g<e.length;++g){if(!t[e[g]]){return;}t=t[e[g]];}return t;}function f(e){var i,t,g,h,p;for(i=0;i<e.length;i++){t=a;g=e[i];h=g.split(/[.\/]/);for(var j=0;j<h.length-1;++j){if(t[h[j]]===u){t[h[j]]={};}t=t[h[j]];}t[h[h.length-1]]=m[g];}if(a.AMDLC_TESTS){p=a.privateModules||{};for(g in m){p[g]=m[g];}for(i=0;i<e.length;i++){delete p[e[i]];}a.privateModules=p;}}d("tinymce/pasteplugin/Utils",["tinymce/util/Tools","tinymce/html/DomParser","tinymce/html/Schema"],function(T,D,S){function e(g,h){T.each(h,function(v){if(v.constructor==RegExp){g=g.replace(v,'');}else{g=g.replace(v[0],v[1]);}});return g;}function i(h){var s=new S(),g=new D({},s),j='';var k=s.getShortEndedElements();var l=T.makeMap('script noscript style textarea video audio iframe object',' ');var n=s.getBlockElements();function w(o){var p=o.name,q=o;if(p==='br'){j+='\n';return;}if(k[p]){j+=' ';}if(l[p]){j+=' ';return;}if(o.type==3){j+=o.value;}if(!o.shortEnded){if((o=o.firstChild)){do{w(o);}while((o=o.next));}}if(n[p]&&q.next){j+='\n';if(p=='p'){j+='\n';}}}h=e(h,[/<!\[[^\]]+\]>/g]);w(g.parse(h));return j;}function t(h){function g(j,s,k){if(!s&&!k){return' ';}return'\u00a0';}h=e(h,[/^[\s\S]*<body[^>]*>\s*|\s*<\/body[^>]*>[\s\S]*$/g,/<!--StartFragment-->|<!--EndFragment-->/g,[/( ?)<span class="Apple-converted-space">\u00a0<\/span>( ?)/g,g],/<br class="Apple-interchange-newline">/g,/<br>$/i]);return h;}return{filter:e,innerText:i,trimHtml:t};});d("tinymce/pasteplugin/Clipboard",["tinymce/Env","tinymce/dom/RangeUtils","tinymce/util/VK","tinymce/pasteplugin/Utils","tinymce/util/Delay"],function(E,R,V,U,D){return function(g){var s=this,p,l,k=0,h=false;var j='%MCEPASTEBIN%',n;var o='data:text/mce-internal,';function q(e){var i,K=g.dom;i=g.fire('BeforePastePreProcess',{content:e});i=g.fire('PastePreProcess',i);e=i.content;if(!i.isDefaultPrevented()){if(g.hasEventListeners('PastePostProcess')&&!i.isDefaultPrevented()){var L=K.add(g.getBody(),'div',{style:'display:none'},e);i=g.fire('PastePostProcess',{node:L});K.remove(L);e=i.node.innerHTML;}if(!i.isDefaultPrevented()){g.insertContent(e,{merge:g.settings.paste_merge_formats!==false,data:{paste:true}});}}}function t(e){e=g.dom.encode(e).replace(/\r\n/g,'\n');var i=g.dom.getParent(g.selection.getStart(),g.dom.isBlock);var K=g.settings.forced_root_block;var L;if(K){L=g.dom.createHTML(K,g.settings.forced_root_block_attrs);L=L.substr(0,L.length-3)+'>';}if((i&&/^(PRE|DIV)$/.test(i.nodeName))||!K){e=U.filter(e,[[/\n/g,"<br>"]]);}else{e=U.filter(e,[[/\n\n/g,"</p>"+L],[/^(.*<\/p>)(<p>)$/,L+'$1'],[/\n/g,"<br />"]]);if(e.indexOf('<p>')!=-1){e=L+e;}}q(e);}function v(){var i=g.dom,K=g.getBody();var L=g.dom.getViewPort(g.getWin()),M=L.y,N=20;var O;l=g.selection.getRng();if(g.inline){O=g.selection.getScrollContainer();if(O&&O.scrollTop>0){M=O.scrollTop;}}function P(e){var T,W,X,S=e.startContainer;T=e.getClientRects();if(T.length){return T[0];}if(!e.collapsed||S.nodeType!=1){return;}X=S.childNodes[l.startOffset];while(X&&X.nodeType==3&&!X.data.length){X=X.nextSibling;}if(!X){return;}if(X.tagName=='BR'){W=i.doc.createTextNode('\uFEFF');X.parentNode.insertBefore(W,X);e=i.createRng();e.setStartBefore(W);e.setEndAfter(W);T=e.getClientRects();i.remove(W);}if(T.length){return T[0];}}if(l.getClientRects){var Q=P(l);if(Q){N=M+(Q.top-i.getPos(K).y);}else{N=M;var S=l.startContainer;if(S){if(S.nodeType==3&&S.parentNode!=K){S=S.parentNode;}if(S.nodeType==1){N=i.getPos(S,O||K).y;}}}}p=i.add(g.getBody(),'div',{id:"mcepastebin",contentEditable:true,"data-mce-bogus":"all",style:'position: absolute; top: '+N+'px;'+'width: 10px; height: 10px; overflow: hidden; opacity: 0'},j);if(E.ie||E.gecko){i.setStyle(p,'left',i.getStyle(K,'direction',true)=='rtl'?0xFFFF:-0xFFFF);}i.bind(p,'beforedeactivate focusin focusout',function(e){e.stopPropagation();});p.focus();g.selection.select(p,true);}function w(){if(p){var e;while((e=g.dom.get('mcepastebin'))){g.dom.remove(e);g.dom.unbind(e);}if(l){g.selection.setRng(l);}}p=l=null;}function x(){var e='',K,i,L,M;K=g.dom.select('div[id=mcepastebin]');for(i=0;i<K.length;i++){L=K[i];if(L.firstChild&&L.firstChild.id=='mcepastebin'){L=L.firstChild;}M=L.innerHTML;if(e!=j){e+=M;}}return e;}function y(e){var i,K,L,M;L=[25942,29554,28521,14958];for(i=0;i<L.length;i++){if(e.charCodeAt(i)!=L[i]){return e;}}K='';for(i=0;i<e.length;i++){M=e.charCodeAt(i);K+=String.fromCharCode((M&0x00FF));K+=String.fromCharCode((M&0xFF00)>>8);}return decodeURIComponent(escape(K));}function z(e){var i,K,L;K='<!--StartFragment-->';i=e.indexOf(K);if(i!==-1){e=e.substr(i+K.length);}L='<!--EndFragment-->';i=e.indexOf(L);if(i!==-1){e=e.substr(0,i);}return e;}function A(e){var K={};if(e){if(e.getData){var L=e.getData('Text');if(L&&L.length>0){if(L.indexOf(o)==-1){K['text/plain']=L;}}}if(e.types){for(var i=0;i<e.types.length;i++){var M=e.types[i],N=e.getData(M);if(M=='text/html'){N=z(y(N));}K[M]=N;}}}return K;}function B(e){return A(e.clipboardData||g.getDoc().dataTransfer);}function C(e,K){var L=e.clipboardData||e.dataTransfer;function M(N){var i,O,P,Q=false;function S(P){if(K){g.selection.setRng(K);K=null;}q('<img src="'+P.result+'">');}if(N){for(i=0;i<N.length;i++){O=N[i];if(/^image\/(jpeg|png|gif|bmp)$/.test(O.type)){P=new FileReader();P.onload=S.bind(null,P);P.readAsDataURL(O.getAsFile?O.getAsFile():O);e.preventDefault();Q=true;}}}return Q;}if(g.settings.paste_data_images&&L){return M(L.items)||M(L.files);}}function F(e){var i=e.clipboardData;return navigator.userAgent.indexOf('Android')!=-1&&i&&i.items&&i.items.length===0;}function G(e){return R.getCaretRangeFromPoint(e.clientX,e.clientY,g.getDoc());}function H(e,i){return i in e&&e[i].length>0;}function I(e){return(V.metaKeyPressed(e)&&e.keyCode==86)||(e.shiftKey&&e.keyCode==45);}function J(){g.on('keydown',function(e){function K(e){if(I(e)&&!e.isDefaultPrevented()){w();}}if(I(e)&&!e.isDefaultPrevented()){n=e.shiftKey&&e.keyCode==86;if(n&&E.webkit&&navigator.userAgent.indexOf('Version/')!=-1){return;}e.stopImmediatePropagation();k=new Date().getTime();if(E.ie&&n){e.preventDefault();g.fire('paste',{ieFake:true});return;}w();v();g.once('keyup',K);g.once('paste',function(){g.off('keyup',K);});}});function i(e,K,L){var M;if(H(e,'text/html')){M=e['text/html'];}else{M=x();if(M==j){L=true;}}M=U.trimHtml(M);if(p&&p.firstChild&&p.firstChild.id==='mcepastebin'){L=true;}w();if(!M.length){L=true;}if(L){if(H(e,'text/plain')&&M.indexOf('</p>')==-1){M=e['text/plain'];}else{M=U.innerText(M);}}if(M==j){if(!K){g.windowManager.alert('Please use Ctrl+V/Cmd+V keyboard shortcuts to paste contents.');}return;}if(L){t(M);}else{q(M);}}g.on('paste',function(e){var K=new Date().getTime();var L=B(e);var M=new Date().getTime()-K;var N=(new Date().getTime()-k-M)<1000;var O=s.pasteFormat=="text"||n;n=false;if(e.isDefaultPrevented()||F(e)){w();return;}if(C(e)){w();return;}if(!N){e.preventDefault();}if(E.ie&&(!N||e.ieFake)){v();g.dom.bind(p,'paste',function(e){e.stopPropagation();});g.getDoc().execCommand('Paste',false,null);L["text/html"]=x();}if(H(L,'text/html')){e.preventDefault();i(L,N,O);}else{D.setEditorTimeout(g,function(){i(L,N,O);},0);}});g.on('dragstart dragend',function(e){h=e.type=='dragstart';});g.on('drop',function(e){var K=G(e);if(e.isDefaultPrevented()||h){return;}if(C(e,K)){return;}if(K&&g.settings.paste_filter_drop!==false){var L=A(e.dataTransfer);var M=L['mce-internal']||L['text/html']||L['text/plain'];if(M){e.preventDefault();g.undoManager.transact(function(){if(L['mce-internal']){g.execCommand('Delete');}g.selection.setRng(K);M=U.trimHtml(M);if(!L['text/html']){t(M);}else{q(M);}});}}});g.on('dragover dragend',function(e){if(g.settings.paste_data_images){e.preventDefault();}});}s.pasteHtml=q;s.pasteText=t;g.on('preInit',function(){J();g.parser.addNodeFilter('img',function(e,K,L){function M(L){return L.data&&L.data.paste===true;}function N(S){if(!S.attr('data-mce-object')&&Q!==E.transparentSrc){S.remove();}}function O(Q){return Q.indexOf("webkit-fake-url")===0;}function P(Q){return Q.indexOf("data:")===0;}if(!g.settings.paste_data_images&&M(L)){var i=e.length;while(i--){var Q=e[i].attributes.map.src;if(!Q){continue;}if(O(Q)){N(e[i]);}else if(!g.settings.allow_html_data_urls&&P(Q)){N(e[i]);}}}});});};});d("tinymce/pasteplugin/WordFilter",["tinymce/util/Tools","tinymce/html/DomParser","tinymce/html/Schema","tinymce/html/Serializer","tinymce/html/Node","tinymce/pasteplugin/Utils"],function(T,D,S,g,N,U){function h(e){return((/<font face="Times New Roman"|class="?Mso|style="[^"]*\bmso-|style='[^'']*\bmso-|w:WordDocument/i).test(e)||(/class="OutlineElement/).test(e)||(/id="?docs\-internal\-guid\-/.test(e)));}function j(t){var e,p;p=[/^[IVXLMCD]{1,2}\.[ \u00a0]/,/^[ivxlmcd]{1,2}\.[ \u00a0]/,/^[a-z]{1,2}[\.\)][ \u00a0]/,/^[A-Z]{1,2}[\.\)][ \u00a0]/,/^[0-9]+\.[ \u00a0]/,/^[\u3007\u4e00\u4e8c\u4e09\u56db\u4e94\u516d\u4e03\u516b\u4e5d]+\.[ \u00a0]/,/^[\u58f1\u5f10\u53c2\u56db\u4f0d\u516d\u4e03\u516b\u4e5d\u62fe]+\.[ \u00a0]/];t=t.replace(/^[\u00a0 ]+/,'');T.each(p,function(i){if(i.test(t)){e=true;return false;}});return e;}function k(t){return/^[\s\u00a0]*[\u2022\u00b7\u00a7\u25CF]\s*/.test(t);}function W(l){var s=l.settings;l.on('BeforePastePreProcess',function(e){var n=e.content,o,v;n=n.replace(/<b[^>]+id="?docs-internal-[^>]*>/gi,'');n=n.replace(/<br class="?Apple-interchange-newline"?>/gi,'');o=s.paste_retain_style_properties;if(o){v=T.makeMap(o.split(/[, ]/));}function p(z){var A,B,C=1;function E(z){var O='';if(z.type===3){return z.value;}if((z=z.firstChild)){do{O+=E(z);}while((z=z.next));}return O;}function F(z,O){if(z.type===3){if(O.test(z.value)){z.value=z.value.replace(O,'');return false;}}if((z=z.firstChild)){do{if(!F(z,O)){return false;}}while((z=z.next));}return true;}function G(z){if(z._listIgnore){z.remove();return;}if((z=z.firstChild)){do{G(z);}while((z=z.next));}}function H(O,P,M){var Q=O._listLevel||C;if(Q!=C){if(Q<C){if(A){A=A.parent.parent;}}else{B=A;A=null;}}if(!A||A.name!=P){B=B||A;A=new N(P,1);if(M>1){A.attr('start',''+M);}O.wrap(A);}else{A.append(O);}O.name='li';if(Q>C&&B){B.lastChild.append(A);}C=Q;G(O);F(O,/^\u00a0+/);F(O,/^\s*([\u2022\u00b7\u00a7\u25CF]|\w+\.)/);F(O,/^\u00a0+/);}var I=[],J=z.firstChild;while(typeof J!=='undefined'&&J!==null){I.push(J);J=J.walk();if(J!==null){while(typeof J!=='undefined'&&J.parent!==z){J=J.walk();}}}for(var i=0;i<I.length;i++){z=I[i];if(z.name=='p'&&z.firstChild){var K=E(z);if(k(K)){H(z,'ul');continue;}if(j(K)){var L=/([0-9]+)\./.exec(K);var M=1;if(L){M=parseInt(L[1],10);}H(z,'ol',M);continue;}if(z._listLevel){H(z,'ul',1);continue;}A=null;}else{B=A;A=null;}}}function q(i,z){var A={},B,C=l.dom.parseStyle(z);T.each(C,function(E,F){switch(F){case'mso-list':B=/\w+ \w+([0-9]+)/i.exec(z);if(B){i._listLevel=parseInt(B[1],10);}if(/Ignore/i.test(E)&&i.firstChild){i._listIgnore=true;i.firstChild._listIgnore=true;}break;case"horiz-align":F="text-align";break;case"vert-align":F="vertical-align";break;case"font-color":case"mso-foreground":F="color";break;case"mso-background":case"mso-highlight":F="background";break;case"font-weight":case"font-style":if(E!="normal"){A[F]=E;}return;case"mso-element":if(/^(comment|comment-list)$/i.test(E)){i.remove();return;}break;}if(F.indexOf('mso-comment')===0){i.remove();return;}if(F.indexOf('mso-')===0){return;}if(o=="all"||(v&&v[F])){A[F]=E;}});if(/(bold)/i.test(A["font-weight"])){delete A["font-weight"];i.wrap(new N("b",1));}if(/(italic)/i.test(A["font-style"])){delete A["font-style"];i.wrap(new N("i",1));}A=l.dom.serializeStyle(A,i.name);if(A){return A;}return null;}if(s.paste_enable_default_filters===false){return;}if(h(e.content)){e.wordContent=true;n=U.filter(n,[/<!--[\s\S]+?-->/gi,/<(!|script[^>]*>.*?<\/script(?=[>\s])|\/?(\?xml(:\w+)?|img|meta|link|style|\w:\w+)(?=[\s\/>]))[^>]*>/gi,[/<(\/?)s>/gi,"<$1strike>"],[/&nbsp;/gi,"\u00a0"],[/<span\s+style\s*=\s*"\s*mso-spacerun\s*:\s*yes\s*;?\s*"\s*>([\s\u00a0]*)<\/span>/gi,function(i,z){return(z.length>0)?z.replace(/./," ").slice(Math.floor(z.length/2)).split("").join("\u00a0"):"";}]]);var t=s.paste_word_valid_elements;if(!t){t=('-strong/b,-em/i,-u,-span,-p,-ol,-ul,-li,-h1,-h2,-h3,-h4,-h5,-h6,'+'-p/div,-a[href|name],sub,sup,strike,br,del,table[width],tr,'+'td[colspan|rowspan|width],th[colspan|rowspan|width],thead,tfoot,tbody');}var w=new S({valid_elements:t,valid_children:'-li[p]'});T.each(w.elements,function(i){if(!i.attributes["class"]){i.attributes["class"]={};i.attributesOrder.push("class");}if(!i.attributes.style){i.attributes.style={};i.attributesOrder.push("style");}});var x=new D({},w);x.addAttributeFilter('style',function(z){var i=z.length,A;while(i--){A=z[i];A.attr('style',q(A,A.attr('style')));if(A.name=='span'&&A.parent&&!A.attributes.length){A.unwrap();}}});x.addAttributeFilter('class',function(z){var i=z.length,A,B;while(i--){A=z[i];B=A.attr('class');if(/^(MsoCommentReference|MsoCommentText|msoDel)$/i.test(B)){A.remove();}A.attr('class',null);}});x.addNodeFilter('del',function(z){var i=z.length;while(i--){z[i].remove();}});x.addNodeFilter('a',function(z){var i=z.length,A,B,C;while(i--){A=z[i];B=A.attr('href');C=A.attr('name');if(B&&B.indexOf('#_msocom_')!=-1){A.remove();continue;}if(B&&B.indexOf('file://')===0){B=B.split('#')[1];if(B){B='#'+B;}}if(!B&&!C){A.unwrap();}else{if(C&&!/^_?(?:toc|edn|ftn)/i.test(C)){A.unwrap();continue;}A.attr({href:B,name:C});}}});var y=x.parse(n);if(s.paste_convert_word_fake_lists!==false){p(y);}e.content=new g({validate:s.validate},w).serialize(y);}});}W.isWordContent=h;return W;});d("tinymce/pasteplugin/Quirks",["tinymce/Env","tinymce/util/Tools","tinymce/pasteplugin/WordFilter","tinymce/pasteplugin/Utils"],function(E,T,W,U){"use strict";return function(g){function h(i){g.on('BeforePastePreProcess',function(e){e.content=i(e.content);});}function j(e){if(!W.isWordContent(e)){return e;}var i=[];T.each(g.schema.getBlockElements(),function(n,o){i.push(o);});var l=new RegExp('(?:<br>&nbsp;[\\s\\r\\n]+|<br>)*(<\\/?('+i.join('|')+')[^>]*>)(?:<br>&nbsp;[\\s\\r\\n]+|<br>)*','g');e=U.filter(e,[[l,'$1']]);e=U.filter(e,[[/<br><br>/g,'<BR><BR>'],[/<br>/g,' '],[/<BR><BR>/g,'<br>']]);return e;}function k(e){if(W.isWordContent(e)){return e;}var w=g.settings.paste_webkit_styles;if(g.settings.paste_remove_styles_if_webkit===false||w=="all"){return e;}if(w){w=w.split(/[, ]/);}if(w){var l=g.dom,n=g.selection.getNode();e=e.replace(/(<[^>]+) style="([^"]*)"([^>]*>)/gi,function(o,p,v,q){var s=l.parseStyle(v,'span'),t={};if(w==="none"){return p+q;}for(var i=0;i<w.length;i++){var x=s[w[i]],y=l.getStyle(n,w[i],true);if(/color/.test(w[i])){x=l.toHex(x);y=l.toHex(y);}if(y!=x){t[w[i]]=x;}}t=l.serializeStyle(t,'span');if(t){return p+' style="'+t+'"'+q;}return p+q;});}else{e=e.replace(/(<[^>]+) style="([^"]*)"([^>]*>)/gi,'$1$3');}e=e.replace(/(<[^>]+) data-mce-style="([^"]+)"([^>]*>)/gi,function(i,o,v,p){return o+' style="'+v+'"'+p;});return e;}if(E.webkit){h(k);}if(E.ie){h(j);}};});d("tinymce/pasteplugin/Plugin",["tinymce/PluginManager","tinymce/pasteplugin/Clipboard","tinymce/pasteplugin/WordFilter","tinymce/pasteplugin/Quirks"],function(P,C,W,Q){var g;P.add('paste',function(h){var s=this,i,j=h.settings;function t(){if(i.pasteFormat=="text"){this.active(false);i.pasteFormat="html";}else{i.pasteFormat="text";this.active(true);if(!g){var e=h.translate('Paste is now in plain text mode. Contents will now '+'be pasted as plain text until you toggle this option off.');h.notificationManager.open({text:e,type:'info'});g=true;}}}s.clipboard=i=new C(h);s.quirks=new Q(h);s.wordFilter=new W(h);if(h.settings.paste_as_text){s.clipboard.pasteFormat="text";}if(j.paste_preprocess){h.on('PastePreProcess',function(e){j.paste_preprocess.call(s,s,e);});}if(j.paste_postprocess){h.on('PastePostProcess',function(e){j.paste_postprocess.call(s,s,e);});}h.addCommand('mceInsertClipboardContent',function(e,v){if(v.content){s.clipboard.pasteHtml(v.content);}if(v.text){s.clipboard.pasteText(v.text);}});if(h.paste_block_drop){h.on('dragend dragover draggesture dragdrop drop drag',function(e){e.preventDefault();e.stopPropagation();});}if(!h.settings.paste_data_images){h.on('drop',function(e){var k=e.dataTransfer;if(k&&k.files&&k.files.length>0){e.preventDefault();}});}h.addButton('pastetext',{icon:'pastetext',tooltip:'Paste as text',onclick:t,active:s.clipboard.pasteFormat=="text"});h.addMenuItem('pastetext',{text:'Paste as text',selectable:true,active:i.pasteFormat,onclick:t});});});f(["tinymce/pasteplugin/Utils"]);})(this);
