VBI.SupportedUnitsOfLength=[{RequestedUnit:"km",DisplayUnitDefault:"m",DisplayUnit2:"km",ConvFactor:1000.0,ConvFactorMeter:1.0},{RequestedUnit:"mi",DisplayUnitDefault:"ft",DisplayUnit2:"mi",ConvFactor:5280.0,ConvFactorMeter:0.3048},{RequestedUnit:"nm",DisplayUnitDefault:"ft",DisplayUnit2:"nm",ConvFactor:6076.12,ConvFactorMeter:0.3048}];
VBI.Scale=function(){"use strict";var s={};s.scene=null;s.m_ID=null;s.m_Image=null;s.m_CurrentUnit=null;s.m_DisplayUnit=null;s.m_nDivider=0;s.m_nScalerLength=0;s.m_nDistance=0;s.m_bRtl=false;s.clear=function(){var i=document.getElementById(s.m_canvas.id);if(i){i.parentNode.removeChild(i);}s.m_Image=null;s.scene=null;};s.Awake=function(a,t){s.scene=a;var l=jQuery.sap.byId(t);s.m_ID=jQuery(l).attr('id');s.AppendCanvas();};s.getId=function(a,b){return b+'-'+a;};s.AppendCanvas=function(){s.m_bRtl=(document.dir=='rtl')?true:false;s.m_canvas=document.createElement('canvas');s.m_canvas.className="vbi-scale";s.m_canvas.id=s.getId('vbi-scale-canvas',s.m_ID);s.m_canvas.m_VBIType="S";s.scene.m_MapDecoDiv.appendChild(s.m_canvas);};s.getConfig=function(){if(s.m_CurrentUnit){return s.m_CurrentUnit;}else{var c=s.scene.m_Ctx;var a,u;if(c){a=c.GetConfig();}if(a){u=a.GetData("UnitOfLength");}if(u){for(var n=0;n<VBI.SupportedUnitsOfLength.length;++n){if(VBI.SupportedUnitsOfLength[n].RequestedUnit==u){s.m_CurrentUnit=VBI.SupportedUnitsOfLength[n];break;}}}}if(!s.m_CurrentUnit){s.m_CurrentUnit=VBI.SupportedUnitsOfLength[0];}return s.m_CurrentUnit;};s.getImage=function(l){if(s.m_Image){return s.m_Image;}var i=new Image();if(l){i.onload=function(){if(typeof l==='function'){l(i);}this.onload=null;};}i.src=sap.ui.resource("sap.ui.vbm","themes/base/img/sapvisualbusiness.png");s.m_Image=i;return i;};s.CalcScaleDimensions=function(){if(s.scene.m_Canvas[0].m_nCurrentLOD<1){return false;}var r=s.scene.GetInternalDivClientRect();var c=s.getConfig();var p=[parseInt(r.width/2-75,10),parseInt(r.height/2,10)];var a=[p[0]+180,p[1]];var d=s.scene.GetDistance(p,a);var b;d=d*(1.0/c.ConvFactorMeter);if(d>=c.ConvFactor){b=parseInt(d/c.ConvFactor,10);s.m_DisplayUnit=c.DisplayUnit2;}else{b=d;s.m_DisplayUnit=c.DisplayUnitDefault;}var l=parseInt(Math.log(b)/Math.LN10,10);b=parseInt(b/Math.pow(10,l),10);if(b<2){b=1;}else if(b<5){b=2;}else if(b<10){b=5;}b=parseInt(b*Math.pow(10,l),10);var e;if(d>=c.ConvFactor){e=b*c.ConvFactor;e=e*c.ConvFactorMeter;}else{e=b*c.ConvFactorMeter;}var f=s.scene.GetTargetPointForDistance(e,p);var g=[f[0]+s.scene.m_Canvas[0].getPixelLeft(),f[1]+s.scene.m_Canvas[0].getPixelTop()];var t=b;var n=0;while(n==0&&t>0){n=t%5;t/=10;}if(n!=2){n=5;}var h=Math.round(g[0]-p[0]);if(h>60&&h<(r.right-r.left)){s.m_nScalerLength=h;s.m_nDistance=b;s.m_nDivider=n;return true;}return false;};s.Update=function(){var r=[211,304,4,8];var a=[240,304,4,8];var b=[224,304,4,8];var c=[235,304,1,8];var d=[219,304,1,8];var e=document.getElementById(s.m_canvas.id);if(!e){return;}var f=e.getContext('2d');f.clearRect(0,0,s.m_canvas.width,s.m_canvas.height);if(!s.CalcScaleDimensions()){s.m_canvas.width=s.m_canvas.height=0;return;}s.m_canvas.width=s.m_nScalerLength+10;s.m_canvas.height=30;var i=s.getImage(s.scene.RenderAsync.bind(s.scene));if(i){var l=0;var t=20;f.drawImage(i,r[0],r[1],r[2],r[3],l,t,r[2],r[3]);l+=r[2];var n=0;while(n<s.m_nDivider){for(var g=0;g<s.m_nScalerLength/s.m_nDivider;g++){if(n%2){f.drawImage(i,c[0],c[1],c[2],c[3],l,t,c[2],c[3]);l+=c[2];}else{f.drawImage(i,d[0],d[1],d[2],d[3],l,t,d[2],d[3]);l+=d[2];}}n++;}if(s.m_nDivider%2){f.drawImage(i,b[0],b[1],b[2],b[3],l,t,b[2],b[3]);l+=b[2];}else{f.drawImage(i,a[0],a[1],a[2],a[3],l,t,a[2],a[3]);l+=a[2];}var o=f.fillStyle;var h=f.font;f.font="12px arial";f.fillStyle="#FFFFFF";f.textAlign="left";for(var j=0;j<2;++j){f.fillText("0",j,15+j);var k=s.m_canvas.width-(f.measureText(s.m_nDistance+s.m_DisplayUnit).width+1);f.fillText(s.m_nDistance+s.m_DisplayUnit,k+j,15+j);f.fillStyle="#212C34";}f.fillStyle=o;f.font=h;}};return s;};
