/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5) (c) Copyright 2009-2012 SAP AG. All rights reserved
 */
sap.ui.define(['sap/ui/core/Element','./library'],function(E,l){"use strict";var C=E.extend("sap.ui.vbm.ClusterBase",{metadata:{library:"sap.ui.vbm",properties:{areaAlwaysVisible:{type:"boolean",group:"Appearance",defaultValue:"false"},areaColor:{type:"sap.ui.core.CSSColor",group:"Appearance",defaultValue:"rgba(200,0,0,0.2)"},areaColorBorder:{type:"sap.ui.core.CSSColor",group:"Appearance",defaultValue:"rgba(220,220,220,0.5)"},textProperty:{type:"string",group:"Misc",defaultValue:"text"},rule:{type:"string",group:"Misc",defaultValue:null}},defaultAggregation:"vizTemplate",aggregations:{vizTemplate:{type:"sap.ui.core.Control",multiple:false},vizVO:{type:"sap.ui.vbm.Spot",multiple:false}},events:{}}});sap.ui.vbm.ClusterBase.prototype.init=function(){this.mVizObjMap={};};C.prototype.getTemplateObject=function(){var t={};var i=this.getId();if(this.getVizTemplate()){t={id:i,type:"{00100000-2012-0004-B001-2297943F0CE6}",datasource:i};}else if(this.getVizVO()){this.oSpotAggr=new sap.ui.vbm.Spots(i,{items:{path:"/",template:this.getVizVO().clone()}});t=this.oSpotAggr.getTemplateObject();}else{jQuery.sap.log.error("No visualization object given for cluster");}return t;};C.prototype.getTypeObject=function(){var d={};if(this.getVizTemplate()){d={name:this.getId(),key:"K",A:[{name:"K",alias:"K",type:"string"}]};}else if(this.getVizVO()){d=this.oSpotAggr.getTypeObject();}else{jQuery.sap.log.error("No visualization object given for cluster");}return d;};C.prototype.getClusterDefinition=function(){return{id:this.getId(),VO:this.getId(),rule:this.getRule(),areapermanent:this.getAreaAlwaysVisible().toString(),areabordersize:"2",areafillcol:this.getAreaColor(),areabordercol:this.getAreaColorBorder()};};C.prototype.handleOpenWindow=function(e){var c=e.mParameters.id;var i=this._getVizObjInst(c);if(i){var n=this.getParent().getInfoForCluster(c,sap.ui.vbm.ClusterInfoType.NodeInfo);i.setProperty(this.getTextProperty(),n.cnt.toString());var d=e.getParameter("contentarea").id;var t=this.getVizTemplate();this._propagateModels(t,i);i.placeAt(d,"only");i.setBindingContext(t.getBindingContext());}};C.prototype.handleCloseWindow=function(e){delete this.mVizObjMap[e.mParameters.id];};C.prototype._getVizObjInst=function(k){var r=this.mVizObjMap[k];if(!r){r=this.mVizObjMap[k]=this.getVizTemplate().clone();}return r;};C.prototype._propagateModels=function(s,t){var n="";for(n in s.oPropagatedProperties.oModels){if(n==="undefined"){t.setModel(s.oPropagatedProperties.oModels[n]);}else{t.setModel(s.oPropagatedProperties.oModels[n],n);}}for(n in s.oModels){if(n==="undefined"){t.setModel(s.oModels[n]);}else{t.setModel(s.oModels[n],n);}}};return C;});
