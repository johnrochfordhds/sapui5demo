/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5) (c) Copyright 2009-2012 SAP AG. All rights reserved
 */
sap.ui.define(['sap/ui/core/theming/Parameters','./GeoJsonLayer','./library'],function(P,G,l){"use strict";var F=G.extend("sap.ui.vbm.FeatureCollection",{metadata:{library:"sap.ui.vbm",properties:{},defaultAggregation:"items",aggregations:{items:{type:"sap.ui.vbm.Feature",multiple:true,singularName:"item"}},events:{click:{parameters:{featureId:{type:"string"}}},contextMenu:{parameters:{featureId:{type:"string"}}}}}});F.prototype.getDataObjects=function(){if(this.mbGeoJSONDirty){this._triggerFeatureCreation();}var e=[],p=[],L=[],a=[];jQuery.extend(e,this.mFeatureColl);var o={};if(e.length){var O=this.getItems();for(var n=0,b=O?O.length:0,i;n<b;++n){i=O[n];o[i.getFeatureId()]=i;}}for(var c=0,E,d,t;c<e.length;++c){E=e[c];if((d=o[E.K])){var C={};jQuery.extend(C,E);E=e[c]=C;E.C=d.getColor();if((t=d.getTooltip())){E.TT=t;}}switch(E.type){case"Polygon":case"MultiPolygon":p.push(E);break;case"LineString":case"MultiLineString":L.push(E);break;case"Point":case"MultiPoint":a.push(E);break;default:jQuery.sap.log.error("FeatureCollection: Unknown feature type: "+E.type);}}return[{"name":this.getId()+"_Polys","type":"N","E":p},{"name":this.getId()+"_Lines","type":"N","E":L},{"name":this.getId()+"_Points","type":"N","E":a}];};F.prototype.getDataRemoveObjects=function(){return[{"name":this.getId()+"_Polys","type":"N"},{"name":this.getId()+"_Lines","type":"N"},{"name":this.getId()+"_Points","type":"N"}];};F.prototype.getFeaturesInfo=function(f){var r=[];for(var n=0,a=f.length,b;n<a;++n){b=f[n];r[b]={};r[b].BBox=this.mFeatureBBox[b];r[b].Midpoint=[(this.mFeatureBBox[b][0]+this.mFeatureBBox[b][1])/2,(this.mFeatureBBox[b][2]+this.mFeatureBBox[b][3])/2];r[b].Name=this.mNames[b];r[b].Properties=this.mFeatureProps[b];}return r;};F.prototype.handleEvent=function(e){var s=e.Action.name;var f="fire"+s[0].toUpperCase()+s.slice(1);var o,i=e.Action.instance;if((o=this.findInstance(i))){if(o.mEventRegistry[s]){if(s==="click"){o.mClickGeoPos=e.Action.AddActionProperties.AddActionProperty[0]['#'];}if(s==="contextMenu"){o.mClickPos=[e.Action.Params.Param[0]['#'],e.Action.Params.Param[1]['#']];jQuery.sap.require("sap.ui.unified.Menu");if(this.oParent.mVBIContext.m_Menus){this.oParent.mVBIContext.m_Menus.deleteMenu("DynContextMenu");}var m=new sap.ui.unified.Menu();m.vbi_data={};m.vbi_data.menuRef="CTM";m.vbi_data.VBIName="DynContextMenu";o.fireContextMenu({menu:m});}else if(s==="handleMoved"){o[f]({data:e});}else{o[f]({});}}}if(this.mEventRegistry[s]){this[f]({featureId:i.split(".")[1]});}};F.prototype.openDetailWindow=function(f,p){var o=this.getParent();o.mDTWindowCxt.bUseClickPos=true;o.mDTWindowCxt.open=true;o.mDTWindowCxt.src=f;o.mDTWindowCxt.key=f.getFeatureId();o.mDTWindowCxt.params=p;o.m_bWindowsDirty=true;o.invalidate(this);};F.prototype.openContextMenu=function(f,m){this.oParent.openContextMenu("Area",f,m);};F.prototype.handleChangedData=function(e){if(e&&e.length){for(var n=0,E,i;n<e.length;++n){E=e[n];i=this.findInstance(E.K);if(i){i.handleChangedData(E);}}}};return F;});
