/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5)

(c) Copyright 2009-2016 SAP SE. All rights reserved
 */
sap.ui.define(['jquery.sap.global','sap/ui/model/odata/ODataModel','sap/ui/model/odata/ODataAnnotations'],function(q,O,a){"use strict";var M=function(r){if(typeof r==="object"){this.oModel=r;}else{this._sResourceRootUri=r;}this._oMetadata=null;if(!this.oModel&&this._sResourceRootUri){this.oModel=new O(this._sResourceRootUri);}if(this.oModel){this._oMetaModel=this.oModel.getMetaModel();}if(this._oMetaModel){this._oMetadata=this._oMetaModel.getProperty("/");}if(this._oMetadata&&this._oMetadata.dataServices){this._oSchemaDefinition=this._oMetadata.dataServices.schema[0];}};M.prototype.getNamespace=function(){if(this._oSchemaDefinition){return this._oSchemaDefinition.namespace;}};M.prototype.getSchemaDefinition=function(){return this._oSchemaDefinition;};M.prototype.getEntityContainerAttribute=function(A){var s=null,e;if(this._oMetaModel&&A){if(A.indexOf("sap:")<0){A="sap:"+A;}e=this._oMetaModel.getODataEntityContainer();s=e[A]||null;}return s;};M.prototype.getEntityLabelByEntityTypeName=function(e){var E=this._getEntityDefinition(e),r,R="";if(E){r=E["com.sap.vocabularies.Common.v1.Label"];if(r&&r.String){R=r.String;}}return R;};M.prototype._getEntityDefinition=function(e){var E=null;if(e){E=this._oMetaModel.getODataEntityType(this._getFullyQualifiedNameForEntity(e));}return E;};M.prototype._getComplexTypeDefinition=function(c){var C=null;if(c){C=this._oMetaModel.getODataComplexType(this._getFullyQualifiedNameForEntity(c));}return C;};M.prototype._getNameOfPropertyUsingComplexType=function(e,c){var C=this.getNamespace();if(e&&c&&C){var t=C+"."+c;var m=this._getEntityDefinition(e);if(m){var p=m.property;if(p&&p.length){var i=0;for(i=0;i<p.length;i++){var P=p[i];if(P&&P.type===t){return P.name;}}}}}return null;};M.prototype.removeNamespace=function(s){var i,r=s;if(s){i=s.lastIndexOf(".")+1;}if(i>0){r=s.substring(i);}return r;};M.prototype.getEntityTypeNameFromEntitySetName=function(e){var E=null,s=null;if(this._oMetaModel){E=this._oMetaModel.getODataEntitySet(e);if(E){s=E.entityType;}}return s;};M.prototype.getEntitySetNameFromEntityTypeName=function(e){var Q,E,b,i,l,o;if(this._oMetaModel&&e){Q=this._getFullyQualifiedNameForEntity(e);E=this._oMetaModel.getODataEntityContainer();if(E&&Q){b=E.entitySet;l=b.length;for(i=0;i<l;i++){o=b[i];if(o.entityType===Q){break;}o=null;}if(o){return o.name;}}}return null;};M.prototype.getKeysByEntitySetName=function(e){var k=null,E=null;if(!this._oMetaModel){return undefined;}E=this.getEntityTypeNameFromEntitySetName(e);if(E){k=this.getKeysByEntityTypeName(E);}return k;};M.prototype.getKeysByEntityTypeName=function(e){var k=null,p=null,i,l=0,E=null;if(!this._oMetaModel){return undefined;}E=this._getEntityDefinition(e);if(E){if(E.key){p=E.key.propertyRef;if(p){l=p.length;k=[];for(i=0;i<l;i++){k.push(p[i].name);}}}}return k;};M.prototype.getFieldsByEntitySetName=function(e){var f=null,E,s=null;if(!this._oMetaModel){return undefined;}E=this._oMetaModel.getODataEntitySet(e);if(E){s=E.entityType;}if(s){f=this.getFieldsByEntityTypeName(s);this._updateSortableOnFields(f,E);}return f;};M.prototype._updateSortableOnFields=function(f,e){var s,n,N=[],l,p,F;if(!e||!f){return;}s=e["Org.OData.Capabilities.V1.SortRestrictions"];if(s){n=s.NonSortableProperties;}if(n){l=n.length;while(l--){p=n[l].PropertyPath;if(p){N.push(p);}}}l=f.length;while(l--){F=f[l];if(N.indexOf(F.name)>-1){F.sortable=false;}else{F.sortable=true;}}};M.prototype.getFieldsByEntityTypeName=function(e){var E;if(!this._oMetaModel){return undefined;}E=this._getEntityDefinition(e);return this._getFieldsByEntityDefinition(E);};M.prototype.getFieldsByComplexTypeName=function(c,p){var C;if(!this._oMetaModel){return undefined;}C=this._getComplexTypeDefinition(c);return this._getFieldsByEntityDefinition(C,p);};M.prototype.getAllEntityTypeNames=function(){if(!this._oMetaModel){return undefined;}var s=this._oSchemaDefinition;if(s.entityType&&s.entityType.length>0){var i=0;var r=[];for(i=0;i<s.entityType.length;i++){r.push(s.entityType[i].name);}return r;}return null;};M.prototype.getFieldSemanticObjectMap=function(e){var m={};var o=this.getFieldsByEntitySetName(e);var i,l=o.length;for(i=0;i<l;i++){var f=o[i];var A=this.getSemanticObjectAnnotation(f.fullName);if(A&&A.semanticObject){m[f.name]=A.semanticObject;}}return m;};M.prototype._getFieldsByEntityDefinition=function(e,p){var f=null,P=null,i=0,l=0,o,F,r;if(e){P=e.property;}if(P){f=[];l=P.length;for(i=0;i<l;i++){o=P[i];if(o){F=q.extend({},o);r=o["com.sap.vocabularies.Common.v1.Label"];if(r){F.fieldLabel=r.String;}r=o["com.sap.vocabularies.Common.v1.QuickInfo"];if(r){F.quickInfo=r.String;}F.displayFormat=o["sap:display-format"];F.aggregationRole=o["sap:aggregation-role"];r=o["Org.OData.Measures.V1.ISOCurrency"];if(r){F.isCurrencyField=true;F.isMeasureField=true;F.unit=r.Path;}r=o["Org.OData.Measures.V1.Unit"];if(r){F.isMeasureField=true;F.unit=r.Path;}r=o["com.sap.vocabularies.Common.v1.Text"];if(r){F.description=r.Path;}F.displayBehaviour=this.getTextArrangementValue(o);F.filterRestriction=o["sap:filter-restriction"];r=o["sap:filterable"];F.filterable=r!=="false";r=o["sap:required-in-filter"];F.requiredField=r==="true";r=o["com.sap.vocabularies.Common.v1.FieldControl"];F.visible=!(r&&r.EnumMember==="com.sap.vocabularies.Common.v1.FieldControlType/Hidden");F.entityName=e.name;F.parentPropertyName=p;F.fullName=this._getFullyQualifiedNameForField(o.name,e);f.push(F);}}}return f;};M.prototype.getAllFilterableFieldsByEntitySetName=function(e){var f=[],E=null;if(!this._oMetaModel){return undefined;}E=this.getEntityTypeNameFromEntitySetName(e);if(E){f=this.getAllFilterableFieldsByEntityTypeName(E);}return f;};M.prototype.getAllFilterableFieldNamesByEntityTypeName=function(e){var g,i,b,j,f,r,G;r=[];g=this.getAllFilterableFieldsByEntityTypeName(e);if(g&&g.length){b=g.length;for(i=0;i<b;i++){G=g[i];if(G.fields&&G.fields.length){f=G.fields.length;for(j=0;j<f;j++){r.push(G.fields[j].name);}}}}return r;};M.prototype.getAllFilterableFieldsByEntityTypeName=function(e){var f=[],E=null,A=null,n=null,s=null;if(!this._oMetaModel){return undefined;}E=this._getEntityDefinition(e);if(E){f.push(this._getFilterableFieldsFromEntityDefinition(E));A=this._getFilterableAssociations(E);for(n in A){s=A[n];E=this._getEntityDefinition(s);if(E){f.push(this._getFilterableFieldsFromEntityDefinition(E,n));}}}return f;};M.prototype._getFilterableFieldsFromEntityDefinition=function(e,p){var f={},F=[],P=null,o,i,l,b=null;if(!this._oMetaModel||!e){return undefined;}o=e["com.sap.vocabularies.Common.v1.Label"];if(o){f.groupLabel=o.String;}f.groupEntityName=e.name;f.groupName=p;P=this._getFieldsByEntityDefinition(e,p);l=P.length;for(i=0;i<l;i++){b=P[i];if(b.visible&&b.filterable){F.push(b);}}f.fields=F;return f;};M.prototype._getFullyQualifiedNameForField=function(f,e){var n,E,r=f;if(e){n=e.namespace;E=e.name;}if(n&&E){r=n+"."+E+"/"+f;}return r;};M.prototype.getFieldNameByFullyQualifiedFieldName=function(f){var r,n;r=this.removeNamespace(f);n=r.indexOf("/");r=r.substring(n+1);return r;};M.prototype._getFilterableAssociations=function(e){var f={},n=null,N=null,i,l=0,E=null;if(!this._oMetaModel||!e){return undefined;}n=e.navigationProperty;if(n&&n.length){l=n.length;for(i=0;i<l;i++){N=n[i];if(N["sap:filterable"]==="false"){continue;}E=this._oMetaModel.getODataAssociationEnd(e,N.name);if(!E||E.type===(e.namespace+"."+e.name)){continue;}if(E.multiplicity==="1"||E.multiplicity==="0..1"){if(f[N.name]===undefined){f[N.name]=E.type;}}}}return f;};M.prototype.getValueListAnnotationLazy=function(p){var P,A={additionalAnnotations:[]},r,s,b,t,c,o,Q;P=new Promise(function(R,f){if(p&&this._oMetaModel){b=p.split("/");t=this._oMetaModel.getODataEntityType(b[0])||this._oMetaModel.getODataComplexType(b[0]);s=b[1];c=this._oMetaModel.getODataProperty(t,s,true);if(c){o=this._oMetaModel.createBindingContext(c);this._oMetaModel.getODataValueLists(o).then(function(v){for(Q in v){r={annotation:v[Q]};if(r.annotation){this._enrichValueHelpAnnotation(r,s);if(!Q){A.primaryValueListAnnotation=r;}else{r.qualifier=Q;A.additionalAnnotations.push(r);}}}R(A);}.bind(this),f);return;}}f();}.bind(this));return P;};M.prototype.getValueListAnnotation=function(p){var A={additionalAnnotations:[]},r,P,b,t,o,Q;if(p&&this._oMetaModel){b=p.split("/");t=this._oMetaModel.getODataEntityType(b[0])||this._oMetaModel.getODataComplexType(b[0]);o=this._oMetaModel.getODataProperty(t,b[1]);if(o){P=o.name;for(var s in o){if(s.indexOf("com.sap.vocabularies.Common.v1.ValueList")>-1){Q=null;r={annotation:o[s]};b=s.split("#");if(b.length===2){Q=b[1];}if(r.annotation){this._enrichValueHelpAnnotation(r,P);if(!Q){A.primaryValueListAnnotation=r;}else{r.qualifier=Q;A.additionalAnnotations.push(r);}}}}}}return A;};M.prototype._enrichValueHelpAnnotation=function(A,p){var r,R,e,k=[],K,I={},o={},b,c,f=[],v=[],d,P,V,l,g,L=0,i=0,F=0;if(A&&A.annotation){r=A.annotation;if(r){R=r["SearchSupported"];A.isSearchSupported=R?R.Bool==="true":false;R=r["CollectionPath"];if(R){A.valueListEntitySetName=R.String;if(this._oMetaModel){e=this._oMetaModel.getODataEntitySet(A.valueListEntitySetName);}if(e){A.valueListEntityName=e.entityType;A.semantics=e["sap:semantics"];k=this.getKeysByEntityTypeName(A.valueListEntityName);f=this.getFieldsByEntityTypeName(A.valueListEntityName);}}R=r["Label"];if(R){A.valueListTitle=R.String;}d=r["Parameters"];if(f&&d){L=d.length;}for(i=0;i<L;i++){g=d[i];V=undefined;l=undefined;P=g["ValueListProperty"];if(P){V=P.String;}P=g["LocalDataProperty"];if(P){l=P.PropertyPath;}b=false;if(g.RecordType==="com.sap.vocabularies.Common.v1.ValueListParameterInOut"||g.RecordType==="com.sap.vocabularies.Common.v1.ValueListParameterIn"){b=true;}c=false;if(g.RecordType==="com.sap.vocabularies.Common.v1.ValueListParameterInOut"||g.RecordType==="com.sap.vocabularies.Common.v1.ValueListParameterOut"){c=true;}if(b){I[l]=V;}if(c){o[l]=V;}if(c||g.RecordType==="com.sap.vocabularies.Common.v1.ValueListParameterDisplayOnly"){F=f.length;while(F--){if(f[F].name===V){v.push(f[F]);break;}}}if(!K&&c&&l===p){K=V;}}}A.inParams=I;A.outParams=o;A.fields=f;A.valueListFields=v;A.keys=k;A.keyField=K;A.descriptionField=this.getDescriptionFieldName(A.keyField,A.valueListEntitySetName);}};M.prototype.getDescriptionFieldName=function(k,e){var f,i=0,l,F,d;if(typeof k==="object"){F=k;}else{f=this.getFieldsByEntitySetName(e);if(f){l=f.length;for(i=0;i<l;i++){F=f[i];if(F.name===k){break;}F=null;}}}if(F&&F["com.sap.vocabularies.Common.v1.Text"]){d=F["com.sap.vocabularies.Common.v1.Text"].Path;}return d;};M.prototype.getIsSearchSupported=function(A){var i=false,p;if(A){p=A.SearchSupported;if(p&&p.Bool==="true"){i=true;}}return i;};M.prototype.getValueListSemantics=function(A){var e,E,s;if(A){e=A["CollectionPath"]?A["CollectionPath"].String:undefined;}if(e){E=this._oMetaModel.getODataEntitySet(e);if(E){s=E["sap:semantics"];}}return s;};M.prototype.getLineItemAnnotation=function(p){var e,A,r;if(p&&this._oMetaModel){e=this._oMetaModel.getODataEntityType(p);if(e){A=e["com.sap.vocabularies.UI.v1.LineItem"];if(A){r={annotation:A};this._enrichAnnotationWithUIDataField(r,A);}}}return r;};M.prototype.getPresentationVariantAnnotation=function(p){var e,A,l,i,r,L,c,I;if(p&&this._oMetaModel){e=this._oMetaModel.getODataEntityType(p);if(e){A=e["com.sap.vocabularies.UI.v1.PresentationVariant"];if(A){r={annotation:A,requestAtLeastFields:[],sortOrderFields:[]};if(A.Visualizations){l=A.Visualizations.length;for(i=0;i<l;i++){I=A.Visualizations[i].AnnotationPath;if(I.indexOf("com.sap.vocabularies.UI.v1.LineItem")>-1){L=e[I.substring(1)];r.lineItemAnnotation={annotation:L};this._enrichAnnotationWithUIDataField(r.lineItemAnnotation,L);break;}else if(I.indexOf("com.sap.vocabularies.UI.v1.Chart")>-1){c=e[I.substring(1)];r.chartAnnotation={annotation:c,semantics:e["sap:semantics"]};this._enrichChartAnnotation(r.chartAnnotation,c);break;}}}if(A.RequestAtLeast){l=A.RequestAtLeast.length;for(i=0;i<l;i++){r.requestAtLeastFields.push(A.RequestAtLeast[i].PropertyPath);}}if(A.SortOrder){l=A.SortOrder.length;for(i=0;i<l;i++){r.sortOrderFields.push({name:A.SortOrder[i].Property.PropertyPath,descending:A.SortOrder[i].Descending?A.SortOrder[i].Descending.Bool==="true":false});}}}}}return r;};M.prototype._enrichChartAnnotation=function(A,o){var i,l,b;if(A&&o){A.measureFields=[];A.dimensionFields=[];A.measureAttributes={};A.dimensionAttributes={};if(o.ChartType&&o.ChartType.EnumMember){A.chartType=o.ChartType.EnumMember;}if(o.Measures){l=o.Measures.length;for(i=0;i<l;i++){A.measureFields.push(o.Measures[i].PropertyPath);}}if(o.MeasureAttributes){l=o.MeasureAttributes.length;for(i=0;i<l;i++){b=o.MeasureAttributes[i];A.measureAttributes[b.Measure.PropertyPath]=b.Role.EnumMember;}}if(o.Dimensions){l=o.Dimensions.length;for(i=0;i<l;i++){A.dimensionFields.push(o.Dimensions[i].PropertyPath);}}if(o.DimensionAttributes){l=o.DimensionAttributes.length;for(i=0;i<l;i++){b=o.DimensionAttributes[i];A.dimensionAttributes[b.Dimension.PropertyPath]=b.Role.EnumMember;}}}};M.prototype.getChartAnnotation=function(p){var e,A,r;if(p&&this._oMetaModel){e=this._oMetaModel.getODataEntityType(p);if(e){A=e["com.sap.vocabularies.UI.v1.Chart"];if(A){r={annotation:A,semantics:e["sap:semantics"]};this._enrichChartAnnotation(r,A);}}}return r;};M.prototype.getFieldGroupAnnotation=function(p){var e,Q,P,r,A,R,b=[];if(p&&this._oMetaModel){e=this._oMetaModel.getODataEntityType(this._getFullyQualifiedNameForEntity(p));if(e){for(var s in e){if(s.indexOf("com.sap.vocabularies.UI.v1.FieldGroup")>-1){Q=null;A=e[s];P=s.split("#");if(P.length===2){Q=P[1];}if(A){R={annotation:A};if(Q){R.groupName=Q;}r=A["Label"];if(r){R.groupLabel=r.String;}r=A["Data"];if(r){this._enrichAnnotationWithUIDataField(R,r);}b.push(R);}}}}}return b;};M.prototype._enrichAnnotationWithUIDataField=function(A,r){var f=[],l={},I={},p,F,P,L=0,i=0;if(A&&r){L=r.length;f=[];l={};for(i=0;i<L;i++){P=r[i];if(P&&P.RecordType==="com.sap.vocabularies.UI.v1.DataField"){F=null;p=P["Value"];if(p){F=p.Path;f.push(F);}if(F){p=P["Label"];if(p&&p.String){l[F]=p.String;}I[F]=this._getImportanceAnnotation(P);}}}A.fields=f;A.labels=l;A.importance=I;}};M.prototype._getImportanceAnnotation=function(p){var i=null,r;r=p["com.sap.vocabularies.UI.v1.Importance"];if(r){i=r.EnumMember;}switch(i){case"com.sap.vocabularies.UI.v1.ImportanceType/Medium":return"Medium";case"com.sap.vocabularies.UI.v1.ImportanceType/Low":return"Low";default:return"High";}};M.prototype.getTextArrangementValue=function(p){var P,t,o,A,d;if(p&&this._oMetaModel){if(typeof(p)==="string"){p=this._getFullyQualifiedNameForEntity(p);P=p.split("/");if(P.length>1){t=this._oMetaModel.getODataEntityType(P[0])||this._oMetaModel.getODataComplexType(P[0]);o=this._oMetaModel.getODataProperty(t,P[1]);}else{o=this._oMetaModel.getODataEntityType(p)||this._oMetaModel.getODataComplexType(p);}}else{o=p;}if(o){A=o["com.sap.vocabularies.UI.v1.TextArrangement"];}if(A){switch(A.EnumMember){case"com.sap.vocabularies.UI.v1.TextArrangementType/TextFirst":d="descriptionAndId";break;case"com.sap.vocabularies.UI.v1.TextArrangementType/TextLast":d="idAndDescription";break;case"com.sap.vocabularies.UI.v1.TextArrangementType/TextSeparate":d="idOnly";break;}}}return d;};M.prototype.getSemanticObjectAnnotation=function(p){var P,t,o,A;if(p&&this._oMetaModel){P=p.split("/");t=this._oMetaModel.getODataEntityType(P[0])||this._oMetaModel.getODataComplexType(P[0]);o=this._oMetaModel.getODataProperty(t,P[1]);if(o){A=o["com.sap.vocabularies.Common.v1.SemanticObject"];}return this._prepareSemanticObjectAnnotationFromProperty(A);}return null;};M.prototype.getSemanticObjectAnnotationFromProperty=function(p){var A;if(p){A=p["com.sap.vocabularies.Common.v1.SemanticObject"];return this._prepareSemanticObjectAnnotationFromProperty(A);}return null;};M.prototype._prepareSemanticObjectAnnotationFromProperty=function(A){var r,R;if(A){r=A["String"];if(r){R={annotation:A};R.semanticObject=r;}}return R;};M.prototype._getFullyQualifiedNameForEntity=function(e){var n,r;if(!e){return undefined;}if(e.indexOf(".")>-1){return e;}n=this.getNamespace();if(n&&!(e.indexOf(n)>-1)){r=n+"."+e;}else{r=e;}return r;};M.prototype.destroy=function(){this.oModel=null;this._oMetaModel=null;this._oMetadata=null;this._oSchemaDefinition=null;this._sResourceRootUri=null;this.bIsDestroyed=true;};return M;},true);
