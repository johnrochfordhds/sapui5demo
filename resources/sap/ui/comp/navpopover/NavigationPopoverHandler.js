/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5)

(c) Copyright 2009-2016 SAP SE. All rights reserved
 */
sap.ui.define(['jquery.sap.global',"sap/ui/base/ManagedObject",'sap/ui/comp/navpopover/LinkData'],function(q,M,L){"use strict";var N=M.extend("sap.ui.comp.navpopover.NavigationPopoverHandler",{metadata:{library:"sap.ui.comp",properties:{semanticObject:{type:"string",group:"Misc",defaultValue:null},semanticObjectController:{type:"any",group:"Misc",defaultValue:null},fieldName:{type:"string",group:"Misc",defaultValue:null},semanticObjectLabel:{type:"string",group:"Misc",defaultValue:null},mapFieldToSemanticObject:{type:"boolean",group:"Misc",defaultValue:true}},associations:{control:{type:"sap.ui.core.Control",multiple:false}},events:{beforePopoverOpens:{parameters:{semanticObject:{type:"string"},semanticAttributes:{type:"object"},originalId:{type:"string"},setSemanticAttributes:{type:"function"},setAppStateKey:{type:"function"},open:{type:"function"}}},navigationTargetsObtained:{parameters:{actions:{type:"sap.ui.comp.navpopover.LinkData[]"},mainNavigation:{type:"sap.ui.comp.navpopover.LinkData"},ownNavigation:{type:"sap.ui.comp.navpopover.LinkData"},semanticObject:{type:"string"},originalId:{type:"string"},show:{type:"function"}}},innerNavigate:{parameters:{text:{type:"string"},href:{type:"string"},semanticObject:{type:"string"},semanticAttributes:{type:"object"},originalId:{type:"string"}}}}}});N.prototype.init=function(){this._oSemanticAttributes=null;};N.prototype.setSemanticObjectLabel=function(l){this.setProperty("semanticObjectLabel",l);if(this._oPopover){this._oPopover.setTitle(l);}};N.prototype._handlePressed=function(e){if(this._processingPressed){window.console.warn("SmartLink is still processing last press event. This press event is omitted.");return;}this._processingPressed=true;var a;this._calculateSemanticAttributes();var t=this;var o=function(){t._createPopover();t._oPopover.setTitle(t.getSemanticObjectLabel());t._oPopover.setSemanticObjectName(t.getSemanticObject());if(t._oSemanticAttributes){t._oPopover.setSemanticAttributes(t._oSemanticAttributes);}if(a){t._oPopover.setAppStateKey(a);}t._oPopover.retrieveNavTargets();};if(this.hasListeners("beforePopoverOpens")){this.fireBeforePopoverOpens({semanticObject:this.getSemanticObject(),semanticAttributes:t._oSemanticAttributes,setSemanticAttributes:function(m){t._oSemanticAttributes=m;},setAppStateKey:function(k){a=k;},originalId:this.getId(),open:o});}else{o();}};N.prototype._onTargetsObtainedOpenDialog=function(){var t=this;if(!this._oPopover.getMainNavigation()){this._oPopover.setMainNavigation(new L({text:this.getSemanticObjectLabel()}));}this.fireNavigationTargetsObtained({actions:this._oPopover.getAvailableActions(),mainNavigation:this._oPopover.getMainNavigation(),ownNavigation:this._oPopover.getOwnNavigation(),semanticObject:this.getSemanticObject(),semanticAttributes:this.getSemanticAttributes(),originalId:this.getId(),show:function(m,o,a,e){if(m!=null&&typeof m==="string"){t._oPopover.setMainNavigationId(m);}else{e=a;a=o;o=m;}if(o){t._oPopover.setMainNavigation(o);}if(a){t._oPopover.removeAllAvailableActions();if(a&&a.length){var i,l=a.length;for(i=0;i<l;i++){t._oPopover.addAvailableAction(a[i]);}}}if(e){t._oPopover.setExtraContent(e);}t._oPopover.show();t._processingPressed=false;}});if(!this.hasListeners("navigationTargetsObtained")){this._oPopover.show();this._processingPressed=false;}};N.prototype._onInnerNavigate=function(e){var p=e.getParameters();this.fireInnerNavigate({text:p.text,href:p.href,originalId:this.getId(),semanticObject:this.getSemanticObject(),semanticAttributes:this.getSemanticAttributes()});};N.prototype._createPopover=function(){if(this._oPopover){this._oPopover.destroy();this._oPopover=null;}if(!this._oPopover){var c=this._getComponent();q.sap.require("sap.ui.comp.navpopover.NavigationPopover");var a=sap.ui.require("sap/ui/comp/navpopover/NavigationPopover");this._oPopover=new a({title:this.getSemanticObjectLabel(),semanticObjectName:this.getSemanticObject(),targetsObtained:q.proxy(this._onTargetsObtainedOpenDialog,this),navigate:q.proxy(this._onInnerNavigate,this),component:c});this._oPopover.setSource(this._getControl());}};N.prototype._getControl=function(){var h=this.getControl();if(h){return sap.ui.getCore().byId(h);}return null;};N.prototype._getComponent=function(){var h=this._getControl();if(h){var p=h.getParent();while(p){if(p instanceof sap.ui.core.Component){return p;}p=p.getParent();}}return null;};N.prototype._calculateSemanticAttributes=function(){var r=null;var c=this.getBindingContext();if(c){r={};var s=c.getObject(c.getPath());var k,v;var t=this;var m;if(this.getMapFieldToSemanticObject()){m=function(k){return t._mapFieldToSemanticObject(k);};}else{var S=this.getSemanticObject();m=function(k){var f=t._mapFieldToSemanticObject(k);if(f===S){return k;}return f;};}for(k in s){if(k!=="__metadata"){v=s[k];if(v){k=m(k);r[k]=v;}}}}this._oSemanticAttributes=r;};N.prototype.getSemanticAttributes=function(){if(this._oSemanticAttributes===null){this._calculateSemanticAttributes();}return this._oSemanticAttributes;};N.prototype._mapFieldToSemanticObject=function(f){var s=this.getSemanticObjectController();if(s){var m=s.getFieldSemanticObjectMap();if(m){var S=m[f];if(S){return S;}}}return f;};N.prototype.setFieldName=function(f){this.setProperty("fieldName",f);var s=this.getSemanticObjectController();if(s){s.setIgnoredState(this);}};N.prototype.setSemanticObjectController=function(c){var o=this.getProperty("semanticObjectController");if(o){o.unregisterControl(this);}this.setProperty("semanticObjectController",c,true);if(c){c.registerControl(this);}};N.prototype.getSemanticObjectController=function(){var c=this.getProperty("semanticObjectController");if(!c){var p=this.getParent();while(p){if(p.getSemanticObjectController){c=p.getSemanticObjectController();if(c){this.setSemanticObjectController(c);break;}}p=p.getParent();}}return c;};N.prototype.getSemanticObjectValue=function(){var s=this.getSemanticAttributes();if(s){var S=this.getSemanticObject();return s[S];}return null;};N.prototype.exit=function(){this.setSemanticObjectController(null);if(this._oPopover){this._oPopover.destroy();this._oPopover=null;}};return N;},true);
