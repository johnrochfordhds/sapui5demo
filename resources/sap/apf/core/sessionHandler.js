/*!
 * SAP APF Analysis Path Framework
 * 
 * (c) Copyright 2012-2014 SAP AG. All rights reserved
 */
jQuery.sap.declare("sap.apf.core.sessionHandler");jQuery.sap.require("sap.apf.core.ajax");jQuery.sap.require("sap.apf.utils.filter");jQuery.sap.require("sap.apf.core.constants");(function(){'use strict';sap.apf.core.SessionHandler=function(i){var t=this;var d=false;var p='';var x="";var s="";var h=new sap.apf.utils.Hashtable(i.messageHandler);var n=0;var c=i.coreApi;var m=i.messageHandler;var o=function(j,S,e){if((x.length===0||x==="unsafe")&&n<2){setTimeout(t.fetchXcsrfToken,500+Math.random()*1500);}else{m.check(false,"No XSRF Token available!",5101);}};var a=function(D,S,X){x=X.getResponseHeader("x-csrf-token");if(x===null){x="";}else if((x.length===0||x==="unsafe")&&n<2){setTimeout(t.fetchXcsrfToken,500+Math.random()*1500);}};this.type="sessionHandler";this.ajax=function(S){sap.apf.core.ajax(S);};this.getXsrfToken=function(b){s=b;if(h.hasItem(s)){return h.getItem(s);}t.fetchXcsrfToken();h.setItem(s,x);return x;};this.fetchXcsrfToken=function(){t.ajax({url:c.getUriGenerator().getAbsolutePath(s),type:"GET",beforeSend:function(b){b.setRequestHeader("x-csrf-token","Fetch");},success:a,error:o,async:false});n=n+1;};this.setDirtyState=function(b){d=b;};this.isDirty=function(){return d;};this.setPathName=function(b){if(typeof b!='string'){p='';return;}p=b;};this.getPathName=function(){return p;};};}());
