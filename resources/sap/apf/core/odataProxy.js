/*!
 * SAP APF Analysis Path Framework
 *
 * (c) Copyright 2012-2014 SAP SE. All rights reserved
 */
jQuery.sap.declare("sap.apf.core.odataProxy");jQuery.sap.require('sap.apf.utils.utils');jQuery.sap.require("sap.ui.thirdparty.datajs");jQuery.sap.require('sap.apf.core.constants');(function(){'use strict';sap.apf.core.OdataProxy=function(s,a){var c=a.instance.coreApi;var m=a.instance.messageHandler;var b=s.serviceRoot;var e="";function d(i){if(i===undefined){return true;}return i;}function g(b,i){return c.getEntityTypeMetadata(b,i);}function f(j){var i,u,v;if(!j){return"";}u=j.length;if(u===1){return"('"+j[0].value+"')";}v="(";for(i=0;i<u;i++){if(i>0){v=v+",";}v=v+j[i].name+"='"+j[i].value+"'";}return v+")";}function h(E){var i;if(E.messageObject&&E.messageObject.getCode){i=E.messageObject;}else if(E.response&&E.response.statusCode&&E.response.statusCode>=400){i=m.createMessageObject({code:'11005',aParameters:[E.response.statusCode.toString(),E.response.statusText]});}else{i=m.createMessageObject({code:'5201'});}m.putMessage(i);return i;}function k(E,i){var j=h(E);i(undefined,undefined,j);}function l(D,b,i,j){var u;var v;if(D&&D.results){u=D.results;}else if(D){u=D;}else{v=m.createMessageObject({code:'5201'});}j(u,g(b,i),v);}this.readEntity=function(i,j,u,v,w,x){var A=d(w);var y=sap.apf.core.constants.entitySets[i];var z=c.getXsrfToken(b);var B=b+'/'+y;B=B+f(u);if(v&&v.length>0){B=B+"?$select="+v.join();}var C={requestUri:B,async:A,method:"GET",headers:{"x-csrf-token":z}};c.odataRequest(C,function(D){l(D,b,y,j);},function(E){k(E,j);});};function n(P,v){var i="'";var E=g(b,e).getPropertyMetadata(P);if(E&&E.dataType){return sap.apf.utils.formatValue(v,E.dataType.type);}if(typeof v==='number'){return v;}return i+sap.apf.utils.escapeOdata(v)+i;}function o(j){var x=c.getXsrfToken(b);var u=[];var i,v=j.length;var w,y,S,z,A;for(i=0;i<v;i++){S=false;y=sap.apf.core.constants.entitySets[j[i].entitySetName];w=y;w=w+f(j[i].inputParameters);if(j[i].selectList&&j[i].selectList.length>0){w=w+"?$select="+j[i].selectList.join();S=true;}if(j[i].filter){if(S){w=w+'&';}else{w=w+'?';}e=y;w=w+'$filter='+j[i].filter.toUrlParam({formatValue:n});}z=j[i].method||'GET';A={requestUri:w,method:z,headers:{"Accept-Language":sap.ui.getCore().getConfiguration().getLanguage(),"x-csrf-token":x}};if(z!=="GET"){A.data=j[i].data;}u.push(A);}return u;}function p(i,j,u,v){var Q='';var w=i+f(j);if(u&&u.length>0){Q="$select="+u.join();}if(v){if(Q){Q=Q+'&';}e=i;Q=Q+'$filter='+v.toUrlParam({formatValue:n});}if(i===sap.apf.core.constants.entitySets.application){if(Q){Q=Q+'&';}Q=Q+'$orderby=ApplicationName';}if(Q){w=w+'?'+Q;}return w;}function q(i,j){var u="unknown error";var v="unknown error";var w="";if(i.message!==undefined){u=i.message;}var x="unknown";if(i.response&&i.response.statusCode){x=i.response.statusCode;v=i.response.statusText||"";w=i.response.requestUri;}if(i.messageObject&&i.messageObject.type==="messageObject"){j([],i.messageObject);}else{j([],m.createMessageObject({code:"5001",aParameters:[x,u,v,w]}));}}this.doChangeOperationsInBatch=function(u,v){var x=c.getXsrfToken(b);var w=o(u);var y={requestUri:b+'/'+'$batch',method:"POST",headers:{"x-csrf-token":x},data:{__batchRequests:[{__changeRequests:w}]}};var S=function(z,A){var B;var C;var D,F,G;var H="";var i,j;if(z&&z.__batchResponses){for(i=0;i<z.__batchResponses.length;i++){if(z.__batchResponses[i].message){D=z.__batchResponses[i].message;F="";H=A.requestUri;B=m.createMessageObject({code:"5001",aParameters:[F,D,"",H]});break;}for(j=0;j<z.__batchResponses[i].__changeResponses.length;j++){C=z.__batchResponses[i].__changeResponses[j];if(C.message){D=C.message;G=C.data;F=C.statusCode;H=A.requestUri;B=m.createMessageObject({code:"5001",aParameters:[F,D,G,H]});break;}}}v(B);}};var E=function(i){q(i,v);};c.odataRequest(y,S,E,OData.batchHandler);};this.readCollectionsInBatch=function(j,u,v){var x=c.getXsrfToken(b);var w=o(j);var A=d(v);var y={requestUri:b+'/'+'$batch',async:A,method:"POST",headers:{"x-csrf-token":x},data:{__batchRequests:w}};var S=function(z){var B=[];var C,D,F,G,H;var i;if(z&&z.__batchResponses){for(i=0;i<z.__batchResponses.length;i++){if(z.__batchResponses[i].data&&z.__batchResponses[i].data.results){B.push(z.__batchResponses[i].data.results);}else if(z.__batchResponses[i].message){D=z.__batchResponses[i].message;F=z.__batchResponses[i].response.body;G=z.__batchResponses[i].response.statusCode;H=B.requestUri;C=m.createMessageObject({code:"5001",aParameters:[G,D,F,H]});break;}else{H=B.requestUri;C=m.createMessageObject({code:"5001",aParameters:["unknown","unknown error","unknown error",H]});break;}}u(B,C);}};var E=function(i){q(i,u);};c.odataRequest(y,S,E,OData.batchHandler);};this.readCollection=function(i,j,u,v,w,x){var A=d(x);if(A){t(i,j,u,v,w);}else{r(i,j,u,v,w);}};function r(i,j,u,v,w){var x=sap.apf.core.constants.entitySets[i];var y=c.getXsrfToken(b);var z=b+'/'+p(x,u,v,w);var A={requestUri:z,async:false,method:"GET",headers:{"x-csrf-token":y}};c.odataRequest(A,function(D){l(D,b,x,j);},function(E){k(E,j);});}function t(i,j,u,v,w){var x=sap.apf.core.constants.entitySets[i];var y=function(B,C){var D;var E;var F="";if(B&&B.__batchResponses){if(B.__batchResponses[0].data&&B.__batchResponses[0].data.results){D=B.__batchResponses[0].data.results;}else if(B.__batchResponses[0].message){var G=B.__batchResponses[0].message;var H=B.__batchResponses[0].response.body;var I=B.__batchResponses[0].response.statusCode;F=C.requestUri;E=m.createMessageObject({code:"5001",aParameters:[I,G,H,F]});}else{F=C.requestUri;E=m.createMessageObject({code:"5001",aParameters:["unknown","unknown error","unknown error",F]});}j(D,g(b,x),E);}};var z=c.getXsrfToken(b);var A={requestUri:b+'/'+'$batch',async:true,method:"POST",headers:{"x-csrf-token":z},data:{__batchRequests:[{requestUri:p(x,u,v,w),method:"GET",headers:{"x-csrf-token":z,"Accept-Language":sap.ui.getCore().getConfiguration().getLanguage()}}]}};c.odataRequest(A,y,function(E){k(E,j);},OData.batchHandler);}this.create=function(i,j,u,v){var A=d(v);var w=sap.apf.core.constants.entitySets[i];var x=c.getXsrfToken(b);var y=b+'/'+w;var z={requestUri:y,async:A,method:"POST",headers:{"x-csrf-token":x},data:j};function B(D,R){var E;var F;if(D&&R.statusText==="Created"){E=D;}else{F=m.createMessageObject({code:'5201'});}u(E,g(b,w),F);}function C(E){var D=h(E);u(undefined,undefined,D);}c.odataRequest(z,B,C);};this.update=function(i,j,u,v){var w=sap.apf.core.constants.entitySets[i];var x=c.getXsrfToken(b);var y=b+'/'+w+f(v);var z={requestUri:y,method:"PUT",headers:{"x-csrf-token":x},data:j};function A(D,R){var C;if(R.statusCode!==204){C=m.createMessageObject({code:'5201'});}u(g(b,w),C);}function B(E){var C=h(E);u(undefined,C);}c.odataRequest(z,A,B);};this.remove=function(i,j,u,v){var w=sap.apf.core.constants.entitySets[i];var x=c.getXsrfToken(b);var y=b+'/'+w+f(j);if(v){e=w;y=y+'$filter='+v.toUrlParam({formatValue:n});}var z={requestUri:y,method:"DELETE",headers:{"x-csrf-token":x}};function A(D,R){var C;var E;if(R.statusText==="No Content"){E=g(b,w);}else{C=m.createMessageObject({code:'5201'});}u(E,C);}function B(E){var C=h(E);u(undefined,C);}c.odataRequest(z,A,B);};};}());
