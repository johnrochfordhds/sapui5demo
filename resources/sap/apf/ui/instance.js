/*!
 * SAP APF Analysis Path Framework
 * 
 * (c) Copyright 2012-2014 SAP AG. All rights reserved
 */
jQuery.sap.declare("sap.apf.ui.instance");jQuery.sap.require('sap.apf.ui.utils.print');jQuery.sap.require('sap.apf.ui.utils.constants');jQuery.sap.require('sap.apf.ui.representations.lineChart');jQuery.sap.require('sap.apf.ui.representations.columnChart');jQuery.sap.require('sap.apf.ui.representations.scatterPlotChart');jQuery.sap.require('sap.apf.ui.representations.stackedColumnChart');jQuery.sap.require('sap.apf.ui.representations.table');jQuery.sap.require('sap.apf.ui.representations.pieChart');jQuery.sap.require('sap.apf.ui.representations.percentageStackedColumnChart');jQuery.sap.require('sap.apf.ui.representations.bubbleChart');jQuery.sap.require('sap.apf.ui.representations.barChart');jQuery.sap.require('sap.apf.ui.representations.stackedBarChart');jQuery.sap.require('sap.apf.ui.representations.percentageStackedBarChart');jQuery.sap.require('sap.apf.ui.representations.heatmapChart');jQuery.sap.require('sap.apf.ui.representations.lineChartWithTwoVerticalAxes');jQuery.sap.require('sap.apf.ui.representations.lineChartWithTimeAxis');
sap.apf.ui.Instance=function(i){'use strict';i.uiApi=this;var c=i.oCoreApi;var s=i.oStartFilterHandler;var a;var b;var m;var f;var d=c.getUriGenerator().getApfLocation();this.oEventCallbacks={};jQuery.sap.includeStyleSheet(d+"resources/css/apfUi.css","apfCss");jQuery.sap.includeStyleSheet(d+"resources/css/apfPrint.css","printCss");jQuery("#printCss").attr("media","print");this.getAnalysisPath=function(){if(b===undefined){b=sap.ui.view({viewName:"sap.apf.ui.reuse.view.analysisPath",type:sap.ui.core.mvc.ViewType.JS,viewData:i});}return b;};this.getNotificationBar=function(){if(m===undefined){m=sap.ui.view({viewName:"sap.apf.ui.reuse.view.messageHandler",type:sap.ui.core.mvc.ViewType.JS,viewData:i});}return m;};this.getStepContainer=function(){if(a===undefined){a=sap.ui.view({viewName:"sap.apf.ui.reuse.view.stepContainer",type:sap.ui.core.mvc.ViewType.JS,viewData:i});}return a;};this.selectionChanged=function(r){if(r){this.getAnalysisPath().getController().refresh(0);}else{var n=c.getSteps().indexOf(c.getActiveStep());this.getAnalysisPath().getController().refresh(n+1);}c.updatePath(this.getAnalysisPath().getController().callBackForUpdatePath.bind(this.getAnalysisPath().getController()));};var e;var g=new sap.m.App().addStyleClass("sapApf");var I=false;this.createApplicationLayout=function(){if(!I){g.addPage(this.getLayoutView());I=true;}return g;};this.getLayoutView=function(){if(e===undefined){e=sap.ui.view({viewName:"sap.apf.ui.reuse.view.layout",type:sap.ui.core.mvc.ViewType.XML,viewData:i});}return e;};this.addDetailFooterContent=function(C){this.getLayoutView().getController().addDetailFooterContentLeft(C);};this.addMasterFooterContentRight=function(C){this.getLayoutView().getController().addMasterFooterContentRight(C);};this.setEventCallback=function(E,C){this.oEventCallbacks[E]=C;};this.getEventCallback=function(E){return this.oEventCallbacks[E];};this.drawFacetFilter=function(C){if(C&&C.length){f=sap.ui.view({viewName:"sap.apf.ui.reuse.view.facetFilter",type:sap.ui.core.mvc.ViewType.JS,viewData:{oCoreApi:c,oUiApi:this,aConfiguredFilters:C,oStartFilterHandler:s}});var k=this.getLayoutView().byId("subHeader");k.addItem(f.byId("idAPFFacetFilter"));}};this.contextChanged=function(r){var C=this.getEventCallback(sap.apf.core.constants.eventTypes.contextChanged);if(typeof C==="function"){C();}};this.getFacetFilterForPrint=function(){if(f){return f.byId("idAPFFacetFilter");}};this.handleStartup=function(k){var t=this;var p=jQuery.Deferred();k.done(function(l){var n=s.getStartFilters();n.done(function(C){t.contextChanged();t.drawFacetFilter(C);if(l.navigationMode==="backward"){t.getAnalysisPath().getController().bIsBackNavigation=true;c.updatePath(t.getAnalysisPath().getController().callBackForUpdatePath.bind(t.getAnalysisPath().getController()));t.getAnalysisPath().getController().setPathTitle();}if(l.navigationMode==="forward"){if(c.getStartParameterFacade().getSteps()){var o=c.getStartParameterFacade().getSteps()[0].stepId;var r=c.getStartParameterFacade().getSteps()[0].representationId;var q=t.getAnalysisPath().getController().callBackForUpdatePathAndSetLastStepAsActive.bind(t.getAnalysisPath().getController());c.createFirstStep(o,r,q);}}p.resolve();});});return p.promise();};this.destroy=function(){f=undefined;this.getAnalysisPath().getToolbar().getController().oPrintHelper=undefined;this.getAnalysisPath().getCarousel().dndBox=undefined;h(this);};function h(k){var t=k.getAnalysisPath().getToolbar().getController();var l=k.getAnalysisPath().getCarousel().getStepGallery().getController();var n=k.getStepContainer().getController().getView().getStepToolbar().getController();j(t.saveDialog);j(t.newOpenDilog);j(t.newDialog);j(t.delConfirmDialog);j(t.confirmDialog);j(t.confrimLogoffDialog);j(t.errorMsgDialog);j(t.noPathAddedDialog);j(l.oHierchicalSelectDialog);j(n.selectionDisplayDialog);if(t.deleteAnalysisPath!==undefined){j(t.deleteAnalysisPath.getController().oDialog);}if(t.pathGallery!==undefined){j(t.pathGallery.getController().oDialog);}v(k);}function j(k){if(k!==undefined){if(k instanceof sap.m.ViewSettingsDialog){k.destroy();}else{if(k.isOpen()){k.close();}}}}function v(k){var l=false;var n=false;var o;if(k.getStepContainer().getController().oCoreApi.getActiveStep()!==undefined){l=true;}if(l){o=k.getStepContainer().getController().oCoreApi.getActiveStep().getSelectedRepresentation();if(o!==undefined){n=true;}}if(n){if(o.type!==sap.apf.ui.utils.CONSTANTS.representationTypes.TABLE_REPRESENTATION){if(o.toggleInstance!==undefined){j(o.toggleInstance.viewSettingsDialog);}}else{j(o.viewSettingsDialog);}}}};
