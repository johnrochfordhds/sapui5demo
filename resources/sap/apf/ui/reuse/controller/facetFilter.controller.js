/*!
* SAP APF Analysis Path Framework
* 
 * (c) Copyright 2012-2014 SAP SE. All rights reserved
*/
jQuery.sap.require('sap.apf.ui.utils.facetFilterListHandler');jQuery.sap.require('sap.apf.ui.utils.facetFilterListConverter');jQuery.sap.require('sap.apf.ui.utils.facetFilterValueFormatter');(function(){'use strict';var c={};var f={};var s;var F=new sap.apf.ui.utils.FacetFilterListConverter();function _(o,g){var h=o.getModel();var i=new sap.apf.ui.utils.FacetFilterValueFormatter();g.oFormatterArgs.aFilterValues=g.aFilterValues;var j=i.getFormattedFFData(g.oFormatterArgs);var m=F.getFFListDataFromFilterValues(j,g.oFormatterArgs.sSelectProperty);g.oFilterRestrictionPropagationPromiseForValues.done(function(n,N){_(o,{aFilterValues:n,oFilterRestrictionPropagationPromiseForValues:N,oFormatterArgs:g.oFormatterArgs});});h.setSizeLimit(m.length);h.setData(m);h.updateBindings();}function a(o){var C=this;C.getView().byId("idAPFFacetFilter").removeList(o);}function b(g,o){var i;g.forEach(function(h){h.selected=false;});o.forEach(function(h){for(i=0;i<g.length;i++){if(h===g[i].key){g[i].selected=true;break;}}});return g;}function d(o,g){var h=o.getId();var i=o.getModel();var j=i.getData();g.oFilterRestrictionPropagationPromiseForSelectedValues.done(function(n,N){o.removeSelectedKeys();d(o,{aSelectedFilterValues:n,oFilterRestrictionPropagationPromiseForSelectedValues:N});});c[h]=g.aSelectedFilterValues;j=b(j,g.aSelectedFilterValues);i.setData(j);i.updateBindings();o.getParent().rerender();}function e(C){var g=C.getView().byId("idAPFFacetFilter").getLists();g.forEach(function(o){(f[o.getId()].getFacetFilterListData().then(_.bind(null,o),a.bind(C,o))).then(function(){f[o.getId()].getSelectedFFValues().then(d.bind(null,o));});});}sap.ui.controller("sap.apf.ui.reuse.controller.facetFilter",{onInit:function(){var C=this,g;if(sap.ui.Device.system.desktop){C.getView().addStyleClass("sapUiSizeCompact");}s=false;var v=C.getView().getViewData();v.aConfiguredFilters.forEach(function(o,n){g=C.getView().byId("idAPFFacetFilter").getLists()[n].getId();f[g]=new sap.apf.ui.utils.FacetFilterListHandler(v.oCoreApi,v.oUiApi,o,F);});e(C);},onListClose:function(E){var C=this;var o=E.getSource();var S=[],g,h,i,j,k,l;g=o.getSelectedItems();S=g.map(function(I){return I.getKey();});h=o.getId();i=c[h];if(i!==undefined){j=JSON.stringify(S.sort());k=JSON.stringify(i.sort());l=(j===k);if(!l){c[h]=S;s=true;f[h].setSelectedFFValues(S);C.getView().getViewData().oUiApi.selectionChanged(true);}}},onResetPress:function(){var C=this;if(s){C.getView().getViewData().oStartFilterHandler.resetVisibleStartFilters();C.getView().getViewData().oUiApi.selectionChanged(true);s=false;}}});}());
