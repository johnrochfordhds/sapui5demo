/*!
 * SAP APF Analysis Path Framework
 * 
 * (c) Copyright 2012-2014 SAP AG. All rights reserved
 */
sap.ui.controller("sap.apf.ui.reuse.controller.messageHandler",{onInit:function(){this.oCoreApi=this.getView().getViewData().oCoreApi;this.oUiApi=this.getView().getViewData().uiApi;if(sap.ui.Device.system.desktop){this.getView().addStyleClass("sapUiSizeCompact");}},showMessage:function(m){var t=m.getMessage();var c=m.getCode();var s=m.getSeverity();var d=m.getTimestampAsdateObject();var M=new sap.ui.core.Message({text:t,timestamp:d});var f=sap.apf.core.constants.message.severity.fatal;var w=sap.apf.core.constants.message.severity.warning;var a=sap.apf.core.constants.message.severity.technError;var e=sap.apf.core.constants.message.severity.error;var b=this;switch(s){case f:M.setLevel(sap.ui.core.MessageType.Error);this.oUiApi.getLayoutView().setBusy(false);b.showDialog(t,c);break;case w:M.setLevel(sap.ui.core.MessageType.Warning);break;case e:this.oUiApi.getLayoutView().setBusy(false);M.setLevel(sap.ui.core.MessageType.Error);break;case a:break;default:jQuery.sap.log.error("Error type not defined");break;}if(s===f||s===w||s===e){jQuery.sap.require("sap.m.MessageToast");sap.m.MessageToast.show(M.getText(),{duration:3000,width:"40%",my:"center bottom",at:"center bottom",of:window,offset:"0 -50",collision:"fit fit",onClose:null,autoClose:true,animationTimingFunction:"ease",animationDuration:2000});}},showDialog:function(t){var s=this;var b=this.oCoreApi.getTextNotHtmlEncoded("application-logout");var d=this.oCoreApi.getTextNotHtmlEncoded("fatal-error");var l=this.oCoreApi.getLogMessages();var a=false;var i;for(i=0;i<l.length;i++){if(l[i].search(5021)!==-1){a=true;break;}}if(a===true){t=this.oCoreApi.getTextNotHtmlEncoded("application-reload");b=this.oCoreApi.getTextNotHtmlEncoded("reload-button");d=this.oCoreApi.getTextNotHtmlEncoded("sessionTimeout");}var D;for(i=0;i<l.length;i++){if(D){D=D+"\n"+l[i];}else{D=l[i];}}var I=false;s.fnClose=function(){I=true;if(window.location.hash){window.location.hash="";}};sap.ca.ui.message.showMessageBox({type:sap.ca.ui.message.Type.ERROR,message:t,details:D},s.fnClose);}});
