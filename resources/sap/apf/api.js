/*!
 * SAP APF Analysis Path Framework
 * 
 * (c) Copyright 2012-2014 SAP AG. All rights reserved
 */
(function(){'use strict';jQuery.sap.declare('sap.apf.api');jQuery.sap.require('sap.apf.core.messageHandler');jQuery.sap.require('sap.apf.core.instance');jQuery.sap.require('sap.apf.utils.filter');jQuery.sap.require('sap.apf.utils.externalContext');jQuery.sap.require('sap.apf.utils.startFilterHandler');jQuery.sap.require('sap.apf.utils.startFilter');jQuery.sap.require('sap.apf.utils.filterIdHandler');jQuery.sap.require('sap.apf.utils.serializationMediator');jQuery.sap.require('sap.apf.utils.startParameter');jQuery.sap.require('sap.apf.utils.navigationHandler');jQuery.sap.require('sap.apf.ui.instance');jQuery.sap.require('sap.apf.ui.representations.representationInterface');jQuery.sap.require("sap.apf.ui.representations.lineChart");jQuery.sap.require("sap.apf.ui.representations.columnChart");jQuery.sap.require("sap.apf.ui.representations.scatterPlotChart");jQuery.sap.require("sap.apf.ui.representations.table");jQuery.sap.require("sap.apf.ui.representations.stackedColumnChart");jQuery.sap.require("sap.apf.ui.representations.pieChart");jQuery.sap.require("sap.apf.ui.representations.percentageStackedColumnChart");jQuery.sap.require('sap.apf.ui.representations.bubbleChart');sap.apf.Api=function(c,i,m){var M;var C;var s;var n;var S;var e;var f;var a;var b;var d;this.type='api';this.constants={};this.constants.eventTypes=sap.apf.core.constants.eventTypes;s=new sap.apf.utils.StartParameter(c,m);M=new sap.apf.core.MessageHandler();M.activateOnErrorHandling(true);C=new sap.apf.core.Instance({startParameter:s,messageHandler:M,manifests:m,getCumulativeFilter:function(){return S.getCumulativeFilter();}});this.destroy=function(){if(u&&u.destroy){u.destroy();}if(C){C.destroy();}u=undefined;M.activateOnErrorHandling(false);M=undefined;C=undefined;s=undefined;n=undefined;};this.activateOnErrorHandling=function(h){return C.activateOnErrorHandling(h);};this.getStartParameterFacade=function(){return C.getStartParameterFacade();};this.setCallbackForMessageHandling=function(h){return C.setCallbackForMessageHandling(h);};this.setApplicationCallbackForMessageHandling=function(h){return C.setApplicationCallbackForMessageHandling(h);};this.getLogMessages=function(){return C.getLogMessages();};this.createStep=function(h,j,r){return C.createStep(h,j,r);};this.getActiveStep=function(){return C.getActiveStep();};this.getCategories=function(){return C.getCategories();};this.getSteps=function(){return C.getSteps();};this.getStepTemplates=function(){return C.getStepTemplates();};this.getFacetFilterConfigurations=function(){return C.getFacetFilterConfigurations();};this.getApplicationConfigProperties=function(){return C.getApplicationConfigProperties();};this.moveStepToPosition=function(h,j,k){return C.moveStepToPosition(h,j,k);};this.removeStep=function(h,j){return C.removeStep(h,j);};this.resetPath=function(){return C.resetPath();};this.setActiveStep=function(h){return C.setActiveStep(h);};this.stepIsActive=function(h){return C.stepIsActive(h);};this.updatePath=function(h){return C.updatePath(h);};this.getApfLocation=function(){return C.getUriGenerator().getApfLocation();};this.readPaths=function(h){return C.readPaths(h);};this.savePath=function(p,N,h){C.savePath(p,N,h);};this.openPath=function(p,h,j){return C.openPath(p,h,j);};this.deletePath=function(p,h){return C.deletePath(p,h);};this.addFacetFilter=function(h){u.getLayoutView().getController().addFacetFilter(h);};this.getEventCallback=function(E){return u.getEventCallback(E);};this.putMessage=function(h){return C.putMessage(h);};this.createMessageObject=function(h){return C.createMessageObject(h);};this.getTextHtmlEncoded=function(l,p){return C.getTextHtmlEncoded(l,p);};this.getTextNotHtmlEncoded=function(l,p){return C.getTextNotHtmlEncoded(l,p);};if(!m){this.loadApplicationConfig=function(F){C.loadApplicationConfig(F);};}else{this.loadApplicationConfig=function(F){};}this.createFilter=function(){return C.createFilter();};this.addPathFilter=function(h){return f.add(h);};this.updatePathFilter=function(h,j){f.update(h,j);};this.getPathFilter=function(h){return f.get(h);};this.createReadRequest=function(r){return C.createReadRequest(r);};this.createReadRequestByRequiredFilter=function(r){return C.createReadRequestByRequiredFilter(r);};b={instance:{startParameter:s,component:c,messageHandler:M},functions:{getConfigurationProperties:C.getApplicationConfigProperties}};e=new sap.apf.utils.ExternalContext(b);a={functions:{getFacetFilterConfigurations:this.getFacetFilterConfigurations,getCombinedContext:e.getCombinedContext,createRequest:C.getFunctionCreateRequest()},instance:{messageHandler:M},constructor:{StartFilter:sap.apf.utils.StartFilter}};S=new sap.apf.utils.StartFilterHandler(a);d={functions:{setRestrictionByProperty:S.setRestrictionByProperty,getRestrictionByProperty:S.getRestrictionByProperty},instance:{messageHandler:M}};f=new sap.apf.utils.FilterIdHandler(d);var g={functions:{getCumulativeFilterUpToActiveStep:C.getCumulativeFilterUpToActiveStep,getNavigationTargets:C.getNavigationTargets,getActiveStep:C.getActiveStep,serializePath:C.serializePath,serializeFilterIds:f.serialize,isDirty:C.isDirty,getPathName:C.getPathName,deserializePath:C.deserializePath,deserializeFilterIds:f.deserialize,setDirtyState:C.setDirtyState,setPathName:C.setPathName,createRequest:C.getFunctionCreateRequest(),getXappStateId:C.getStartParameterFacade().getXappStateId,isFilterReductionActive:C.getStartParameterFacade().isFilterReductionActive,getAllParameterEntitySetKeyProperties:C.getMetadataFacade().getAllParameterEntitySetKeyProperties},instances:{messageHandler:M,component:c,startFilterHandler:S}};n=new sap.apf.utils.NavigationHandler(g);var o=new sap.apf.utils.SerializationMediator({coreApi:C,filterIdHandler:f,startFilterHandler:S});var u=new sap.apf.ui.Instance({oCoreApi:C,oFilterIdHandler:f,oSerializationMediator:o,oNavigationHandler:n,oComponent:c,oStartParameter:s,oStartFilterHandler:S});C.createRepresentation=function(r,h){var j=new sap.apf.ui.representations.RepresentationInterfaceProxy(C,u);var R=sap.apf.utils.extractFunctionFromModulePathString(r);return new R(j,h);};this.selectionChanged=function(r){u.selectionChanged(r);};this.createApplicationLayout=function(){return u.createApplicationLayout();};this.startApf=function(){var t=this;if(this.fnBeforeApfStartupCallback&&typeof this.fnBeforeApfStartupCallback==="function"){this.fnBeforeApfStartupCallback.apply(c,[this]);}var A=this.createApplicationLayout();var h=n.checkMode();var p=u.handleStartup(h);p.done(function(){if(t.fnAfterApfStartupCallback&&typeof t.fnAfterApfStartupCallback==="function"){t.fnAfterApfStartupCallback.apply(c,[t]);}});return A;};this.addMasterFooterContent=function(h){return u.addMasterFooterContentRight(h);};this.setEventCallback=function(E,h){switch(E){case sap.apf.core.constants.eventTypes.contextChanged:u.setEventCallback(E,h);return true;case sap.apf.core.constants.eventTypes.printTriggered:u.setEventCallback(E,h);return true;case sap.apf.core.constants.eventTypes.format:u.setEventCallback(E,h);return true;default:return false;}};this.setCallbackBeforeApfStartup=function(h){this.fnBeforeApfStartupCallback=h;};this.setCallbackAfterApfStartup=function(h){this.fnAfterApfStartupCallback=h;};this.getPropertyValuesOfExternalContext=function(p){var h=jQuery.Deferred();e.getCombinedContext().then(function(j){var t=j.getFilterTermsForProperty(p);var k=[];t.forEach(function(l){var q={Low:l.getValue(),Option:l.getOp(),High:l.getHighValue()};k.push(q);});h.resolve(k);});return h.promise();};if(i){if(i.probe){new i.probe({coreApi:C,component:c,uiApi:u,serializationMediator:o,navigationHandler:n,startParameter:s,injectedFunctionsNavigationHandler:g.functions,startFilterHandler:S});}}};}());
