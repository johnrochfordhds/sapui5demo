/*!
 * SAP APF Analysis Path Framework
 * 
 * (c) Copyright 2012-2014 SAP SE. All rights reserved
 */
sap.ui.getCore().loadLibrary("sap.viz");jQuery.sap.require("sap.apf.ui.representations.utils.vizDatasetHelper");jQuery.sap.require("sap.apf.ui.utils.constants");jQuery.sap.require("sap.apf.core.representationTypes");jQuery.sap.require("sap.apf.utils.utils");sap.ui.controller("sap.apf.modeler.ui.controller.previewContent",{onInit:function(){this.oView=this.getView();this.oView.addStyleClass("sapUiSizeCompact");this.oMainChartHolder=this.oView.byId("idMainChart");this.oThumbnailChartHolder=this.oView.byId("idThumbnailChartLayout");this.mParam=this.oView.getViewData();this._prepareRepresentationInstance();this._drawContent();if(this.mParam.sChartType===sap.apf.ui.utils.CONSTANTS.representationTypes.TABLE_REPRESENTATION){this.oView.byId("idMainChart").getItems()[0].getContent()[0].getContent()[0].addEventDelegate({onAfterRendering:function(){document.querySelector('.tableWithoutHeaders').style.cssText+="height : "+"400px";}});}},_drawContent:function(){this._drawMainChart();this._drawThumbnailContent();this._addStyleClasses();},_drawMainChart:function(){var m=this.oRepresentationInstance.getMainContent(this.mParam.sStepLongTitle,480,330);this.oMainChartHolder.addItem(m);},_drawThumbnailContent:function(){this._drawThumbnailChart();this.oView.byId("idStepTitleText").setText(this.mParam.sStepTitle);this._drawCornerTexts();},_drawThumbnailChart:function(){var t=this.oRepresentationInstance.getThumbnailContent();this.oThumbnailChartHolder.addItem(t);},_drawCornerTexts:function(){this.oView.byId("idLeftUpperCornerText").setText(this.mParam.aCornerTexts.sLeftUpper);this.oView.byId("idRightUpperCornerText").setText(this.mParam.aCornerTexts.sRightUpper);this.oView.byId("idLeftLowerCornerText").setText(this.mParam.aCornerTexts.sLeftLower);this.oView.byId("idRightLowerCornerText").setText(this.mParam.aCornerTexts.sRightLower);},_addStyleClasses:function(){this.oView.byId("idChartHolder").addStyleClass("supressDialogPadding");this.oView.byId("idMainChart").addStyleClass("previewMainChartHolder");this.oView.byId("idThumbnail").addStyleClass("previewThumbnailHolder");this.oView.byId("idThumbnailLayout").addStyleClass("previewThumbnailLayout");this.oView.byId("idThumbnailChartLayout").addStyleClass("previewThumbnailChartLayout");this.oView.byId("idTopLayout").addStyleClass("previewThumbnailTopLayout");this.oView.byId("idBottomLayout").addStyleClass("previewThumbnailBottomLayout");this.oView.byId("idLeftUpperCornerText").addStyleClass("previewThumbnailText");this.oView.byId("idRightUpperCornerText").addStyleClass("previewThumbnailText");this.oView.byId("idLeftLowerCornerText").addStyleClass("previewThumbnailText");this.oView.byId("idRightLowerCornerText").addStyleClass("previewThumbnailText");},_generateSampleData:function(){var s=[];var n=3;var i=0;var d=this.mParam.aDimensions;var m=this.mParam.aMeasures;var p=this.mParam.aProperties;var S=this.mParam.oChartParameter.dimensions;var a=this.mParam.oChartParameter.measures;var b=this.mParam.oChartParameter.properties;var c=this.mParam.sChartType;var I=function(e,f,v,r){var C=e.filter(function(o){return o.fieldName===f;});C.forEach(function(o){if(!o.fieldDesc||!o.fieldDesc.length){o.fieldDesc=o.fieldName;}r[o.fieldDesc]=v;});};var l=c!==sap.apf.ui.utils.CONSTANTS.representationTypes.TABLE_REPRESENTATION?Math.pow(n,this.mParam.aDimensions.length):Math.pow(n,this.mParam.aProperties.length);for(i=0;i<l;i++){var r={};d.forEach(function(D,e){var f=D+" - "+(Math.floor(i/Math.pow(n,e))%n+1);r[D]=f;I(S,D,f,r);});m.forEach(function(M){var e=Math.round(Math.random()*500);r[M]=e;I(a,M,e,r);});p.forEach(function(P){var e=Math.round(Math.random()*500);r[P]=e;I(b,P,e,r);});s.push(r);}if(this.mParam.aSort&&this.mParam.aSort.length){s=this._sortData(s,this.mParam.aSort);}return s;},_sortData:function(d,p){return d.sort(function(r,R){var n,i;for(i=0;i<p.length;i++){n=0;if(r[p[i].sSortField]<R[p[i].sSortField]){n=-1;}else if(r[p[i].sSortField]>R[p[i].sSortField]){n=1;}n=n*[1,-1][+!!p[i].bDescending];if(n!==0){return n;}}});},_getRepresentationConstructor:function(c){var r=sap.apf.core.representationTypes();var R=r.filter(function(R){return R.id===c;})[0];var C=R.constructor;return C;},_prepareRepresentationInstance:function(){var r=this._getRepresentationConstructor(this.mParam.sChartType);jQuery.sap.require(r);var F=sap.apf.utils.extractFunctionFromModulePathString(r);var e=function(){};var a={getTextNotHtmlEncoded:function(t){return t;},getTextHtmlEncoded:function(t){return t;},getEventCallback:e,createFilter:function(){return{getOperators:function(){return{EQ:true};},getTopAnd:function(){return{addOr:e};},getInternalFilter:function(){return{getProperties:function(){return[];}};}};},createMessageObject:e,putMessage:e,updatePath:e,selectionChanged:e,getActiveStep:function(){return{getSelectedRepresentation:function(){return{bIsAlternateView:true};}};}};this.oRepresentationInstance=new F(a,this.mParam.oChartParameter);var m={getPropertyMetadata:function(){return{label:undefined};}};var s=this._generateSampleData();this.oRepresentationInstance.setData(s,m);}});
