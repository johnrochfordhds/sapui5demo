/*!
* SAP APF Analysis Path Framework
*
* (c) Copyright 2012-2014 SAP SE. All rights reserved
*/
sap.ui.controller("sap.apf.modeler.ui.controller.toolbar",{onInit:function(){this.oCoreApi=this.getView().getViewData().oConfigListInstance.oCoreApi;this.oConfigListInstance=this.getView().getViewData().oConfigListInstance;this._setDisplayText();},_setDisplayText:function(){this.byId("idAddButton").setText(this.oCoreApi.getText("addButton"));this.byId("idCopyButton").setText(this.oCoreApi.getText("copyButton"));this.byId("idDeleteButton").setText(this.oCoreApi.getText("deleteButton"));},enableCopyDeleteButton:function(){if(!this.byId("idCopyButton").getEnabled()){this.byId("idCopyButton").setEnabled(true);}if(!this.byId("idDeleteButton").getEnabled()){this.byId("idDeleteButton").setEnabled(true);}},disableCopyDeleteButton:function(){if(this.byId("idCopyButton").getEnabled()){this.byId("idCopyButton").setEnabled(false);}if(this.byId("idDeleteButton").getEnabled()){this.byId("idDeleteButton").setEnabled(false);}},_setAddMenuText:function(){sap.ui.core.Fragment.byId("idAddMenuFragment","idNewConfig").setText(this.oCoreApi.getText("newConfiguration"));sap.ui.core.Fragment.byId("idAddMenuFragment","idNewFacetFilter").setText(this.oCoreApi.getText("newFacetFilter"));sap.ui.core.Fragment.byId("idAddMenuFragment","idNewCategory").setText(this.oCoreApi.getText("newCategory"));sap.ui.core.Fragment.byId("idAddMenuFragment","idNewNavigationTarget").setText(this.oCoreApi.getText("newNavigationTarget"));sap.ui.core.Fragment.byId("idAddMenuFragment","idStep").setText(this.oCoreApi.getText("step"));sap.ui.core.Fragment.byId("idAddMenuFragment","idNewStep").setText(this.oCoreApi.getText("newStep"));sap.ui.core.Fragment.byId("idAddMenuFragment","idExistingStep").setText(this.oCoreApi.getText("existingStep"));sap.ui.core.Fragment.byId("idAddMenuFragment","idNewRepresentation").setText(this.oCoreApi.getText("newRepresentation"));},_setExistingStepDialogText:function(){sap.ui.core.Fragment.byId("idExistingStepDialogFragment","idExistingStepDialog").setTitle(this.oCoreApi.getText("existingStepDialogTitle"));},_enableDisableAddMenuItems:function(s,a){var A=a.getItems();var n;if(this.oConfigListInstance.configurationHandler.getList().length===0||s===null){n="default";}else{n=s.nodeObjectType;}var m={};m["default"]=1;m[sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.CONFIGURATION]=4;m[sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.FACETFILTER]=4;m[sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.CATEGORY]=5;m[sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.STEP]=6;m[sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.REPRESENTATION]=6;m[sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.NAVIGATIONTARGET]=4;A.forEach(function(M,i){if(i<m[n]){M.setEnabled(true);}else{M.setEnabled(false);}});},_handlePressAddButton:function(e){var s;var S=this,i=true;if(this.oConfigListInstance.getView().byId("idConfigDetailData").getContent().length>=1){s=(typeof this.oConfigListInstance.getView().byId("idConfigDetailData").getContent()[0].getController==="function")?this.oConfigListInstance.getView().byId("idConfigDetailData").getContent()[0].getController():undefined;}e.getSource().$().blur();var n=sap.apf.modeler.ui.utils.navigationHandler.getInstance();if(s!==undefined){i=typeof s.getValidationState==="function"?s.getValidationState.call(s):true;}var c=this.oConfigListInstance.configEditor?jQuery.extend(true,{},this.oConfigListInstance.configEditor):undefined;this.oConfigListInstance.bIsSaved=c?c.isSaved():undefined;var a=false;var o=this.oConfigListInstance.oTreeInstance.getAPFTreeNodeContext(this.oConfigListInstance.oTreeInstance.getSelection());var A=e.getSource();var b=function(){if(!this.addMenu){this.addMenu=new sap.ui.xmlfragment("idAddMenuFragment","sap.apf.modeler.ui.fragment.addMenu",this);this.getView().addDependent(this.addMenu);this._setAddMenuText();}var d=sap.ui.core.Popup.Dock;this._enableDisableAddMenuItems(o,this.addMenu);this.addMenu.open(false,A,d.BeginTop,d.BeginBottom,A);};if(!i){n.throwMandatoryPopup(S.oConfigListInstance,{yes:function(){var p=S.oConfigListInstance.oTreeInstance.getParentNodeContext(o);S.oConfigListInstance.configEditor=S.oConfigListInstance.configurationHandler.restoreMemorizedConfiguration(p.configId);if(S.oConfigListInstance.bIsSaved===false&&S.oConfigListInstance.configEditor){S.oConfigListInstance.configEditor.setIsUnsaved();}var N=S.oConfigListInstance._navMandatoryResetState(S.oConfigListInstance);if(!N.isNewView){b.call(S);}}});a=true;}if(!a){b.call(S);}},_handleAddMenuItemPress:function(e){var i=this.addMenu.getItems();var a=e.getParameters("item");var n;var N={"idAddMenuFragment--idNewFacetFilter":sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.FACETFILTER,"idAddMenuFragment--idNewCategory":sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.CATEGORY,"idAddMenuFragment--idNewStep":sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.STEP,"idAddMenuFragment--idNewRepresentation":sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.REPRESENTATION,"idAddMenuFragment--idNewConfig":sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.CONFIGURATION,"idAddMenuFragment--idNewNavigationTarget":sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.NAVIGATIONTARGET,"default":sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.CONFIGURATION};i.forEach(function(I){if(I.getId()===a.id){n=N[I.getId()];}else if(I.getSubmenu()){I.getSubmenu().getItems().forEach(function(I){if(I.getId()===a.id){n=N[I.getId()];}});}});if(a.id==="idAddMenuFragment--idExistingStep"){this._handleAddExistingStepPress();}else if(a.id!=="idAddMenuFragment--idStep"&&n!==undefined){this.oConfigListInstance.oTreeInstance.addNodeInTree(n);}},_copyConfiguration:function(c,n){var C=this.oConfigListInstance.configurationHandler.getConfiguration(c);var o={},a;o.AnalyticalConfiguration=C.AnalyticalConfiguration;o.name="< "+C.AnalyticalConfigurationName+" >";o.Application=C.Application;o.type=sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.CONFIGURATION;o.bIsLoaded=false;o.bToggleState=false;o.isSelected=true;o.expanded=true;o.selectable=true;o.hasExpander=true;this.oConfigListInstance.oModel.getData().aConfigDetails.push(o);this.oConfigListInstance.oModel.updateBindings();a=this.oConfigListInstance.oTreeInstance.getModel().getContext(n);this.oConfigListInstance.selectedNode=this.oConfigListInstance.oTreeInstance.getNodeByContext(a);this.oConfigListInstance.modelUpdateDeferred[this.oConfigListInstance.oModel.getData().aConfigDetails.length-1]=new jQuery.Deferred();var b={appId:this.oConfigListInstance.appId,configId:c};sap.ui.core.UIComponent.getRouterFor(this.oConfigListInstance).navTo(o.type,b,true);},_handlePressCopyButton:function(e){var s;var S=this,a=true;if(this.oConfigListInstance.getView().byId("idConfigDetailData").getContent().length>=1){s=(typeof this.oConfigListInstance.getView().byId("idConfigDetailData").getContent()[0].getController==="function")?this.oConfigListInstance.getView().byId("idConfigDetailData").getContent()[0].getController():undefined;}e.getSource().$().blur();var n=sap.apf.modeler.ui.utils.navigationHandler.getInstance();if(s!==undefined){a=typeof s.getValidationState==="function"?s.getValidationState.call(s):true;}var c=this.oConfigListInstance.configEditor?jQuery.extend(true,{},this.oConfigListInstance.configEditor):undefined;this.oConfigListInstance.bIsSaved=c?c.isSaved():undefined;var b=false;var d=function(){var C=this;var h=this.oTreeInstance.getAPFTreeNodeContext(this.oTreeInstance.getSelection()||this.selectedNode);this.selectedNode=this.oTreeInstance.getSelection()||this.selectedNode;var k,l,m,p,O,q,r,t,u,v,w;m=h.nodeContext;switch(h.nodeObjectType){case sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.FACETFILTER:var F=this.oCoreApi.getText("copyOf")+"  "+h.nodeTitle;var x=this.configEditor.copyFacetFilter(h.nodeAPFId);var y=this.configEditor.getFacetFilter(x);var T=sap.apf.modeler.ui.utils.TranslationFormatMap.FACETFILTER_LABEL;var z=this.oTextPool.setText(F,T);y.setLabelKey(z);O=m.split("/");q=O[2];r=O[6];var A=this.oModel.getData().aConfigDetails[q].configData[0].filters[r];A.isSelected=false;var B=jQuery.extend(true,{},A);B.id=x;B.name="< "+F+" >";B.isSelected=true;p=this.oModel.getData().aConfigDetails[q].configData[0].filters.length;this.oModel.getData().aConfigDetails[q].configData[0].filters.push(B);O[6]=p;l=O.join("/");break;case sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.CATEGORY:var D=this.oCoreApi.getText("copyOf")+"  "+h.nodeTitle;var E=this.configEditor.copyCategory(h.nodeAPFId);var G=sap.apf.modeler.ui.utils.TranslationFormatMap.CATEGORY_TITLE;var H=this.oTextPool.setText(D,G);var I={labelKey:H};this.configEditor.setCategory(I,E);O=m.split("/");q=O[2];t=O[6];var N=[];var J=this.configEditor.getSteps();J.forEach(function(x1){if(C.configEditor.getCategoriesForStep(x1.getId())[0]===E){N.push(x1.getId());}});var K=this.oModel.getData().aConfigDetails[q].configData[1].categories[t];K.isSelected=false;var L=jQuery.extend(true,{},K);if(L.steps){for(var i=0;i<L.steps.length;i++){L.steps[i].id=N[i];var M=C.configEditor.getStep(N[i]);var P=M.getRepresentations();if(L.steps[i].representations){for(var j=0;j<L.steps[i].representations.length;j++){L.steps[i].representations[j].id=P[j].getId();}}}}L.id=E;L.name="< "+D+" >";L.isSelected=true;p=this.oModel.getData().aConfigDetails[q].configData[1].categories.length;this.oModel.getData().aConfigDetails[q].configData[1].categories.push(L);O[6]=p;l=O.join("/");break;case sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.NAVIGATIONTARGET:var Q=this.oCoreApi.getText("copyOf")+"  "+h.nodeTitle;var R=this.configEditor.copyNavigationTarget(h.nodeAPFId);O=m.split("/");q=O[2];u=O[6];var U=this.oModel.getData().aConfigDetails[q].configData[2].navTargets[u];U.isSelected=false;var V=jQuery.extend(true,{},U);V.id=R;V.name="< "+Q+" >";V.isSelected=true;p=this.oModel.getData().aConfigDetails[q].configData[2].navTargets.length;this.oModel.getData().aConfigDetails[q].configData[2].navTargets.push(V);O[6]=p;l=O.join("/");break;case sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.STEP:var W=this.oCoreApi.getText("copyOf")+"  "+h.nodeTitle;var X=this.configEditor.copyStep(h.nodeAPFId);var Y=this.configEditor.getCategoriesForStep(X);var Z=this.configEditor.getStep(X);var $=sap.apf.modeler.ui.utils.TranslationFormatMap.STEP_TITLE;var _=this.oTextPool.setText(W,$);Z.setTitleId(_);O=m.split("/");q=O[2];t=O[6];v=O[8];var a1=this.oModel.getData().aConfigDetails[q].configData[1].categories[t].steps[v];a1.isSelected=false;var b1=jQuery.extend(true,{},a1);P=Z.getRepresentations();b1.id=X;b1.name="< "+W+" >";if(b1.representations){for(j=0;j<b1.representations.length;j++){b1.representations[j].id=P[j].getId();}}p=this.oModel.getData().aConfigDetails[q].configData[1].categories[t].steps.length;O[8]=p;l=O.join("/");for(var c1=0;c1<Y.length;c1++){var d1=jQuery.extend(true,{},b1);var e1={arguments:{configId:S.oConfigListInstance.configId,categoryId:Y[c1]}};var f1=S.oConfigListInstance.getSPathFromURL(e1).sPath.split("/");var g1=f1[6];this.oModel.getData().aConfigDetails[q].configData[1].categories[g1].steps.push(d1);}this.oModel.getData().aConfigDetails[q].configData[1].categories[t].steps[p].isSelected=true;break;case sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.REPRESENTATION:O=m.split("/");q=O[2];t=O[6];v=O[8];w=O[10];var h1=this.oModel.getData().aConfigDetails[q].configData[1].categories[t].steps[v].id;var i1=this.configEditor.getStep(h1);var j1=this.configEditor.getCategoriesForStep(h1);this.oModel.getData().aConfigDetails[q].configData[1].categories[t].steps[v].representations[w].isSelected=false;var k1=this.oModel.getData().aConfigDetails[q].configData[1].categories[t].steps[v].representations[w];var l1=jQuery.extend(true,{},k1);var m1=i1.copyRepresentation(l1.id);l1.id=m1;p=this.oModel.getData().aConfigDetails[q].configData[1].categories[t].steps[v].representations.length;O[10]=p;l=O.join("/");for(var n1=0;n1<j1.length;n1++){var o1=jQuery.extend(true,{},l1);var p1={arguments:{configId:S.oConfigListInstance.configId,categoryId:j1[n1],stepId:h1}};var q1=S.oConfigListInstance.getSPathFromURL(p1).sPath.split("/");var r1=q1[6];var s1=q1[8];this.oModel.getData().aConfigDetails[q].configData[1].categories[r1].steps[s1].representations.push(o1);}this.oModel.getData().aConfigDetails[q].configData[1].categories[t].steps[v].representations[p].isSelected=true;break;case sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.CONFIGURATION:var t1=this.oCoreApi.getText("copyOf")+"  "+h.nodeTitle;O=m.split("/");q=O[2];var u1=this.oModel.getData().aConfigDetails[q];u1.isSelected=false;O[2]=this.oModel.getData().aConfigDetails.length;l=O.join("/");this.configurationHandler.copyConfiguration(h.nodeAPFId,function(x1){var y1={AnalyticalConfigurationName:t1};var z1=C.configurationHandler.setConfiguration(y1,x1);C.configTitle=t1;C.configurationHandler.loadConfiguration(z1,function(A1){var t1=C.configTitle;var B1=sap.apf.modeler.ui.utils.TranslationFormatMap.APPLICATION_TITLE;var C1=C.configurationHandler.getTextPool().setText(t1,B1);A1.setApplicationTitle(C1);});S._copyConfiguration(x1,l);});break;default:break;}if(h.nodeObjectType!==sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.CONFIGURATION){this.oModel.updateBindings();k=this.oTreeInstance.getModel().getContext(l);this.selectedNode=this.oTreeInstance.getNodeByContext(k);var v1=this.oTreeInstance.getAPFTreeNodeContext(this.selectedNode);var w1=this.oTreeInstance.getParentNodeContext(v1);this.navigateToDifferntView(w1,v1);this.configEditor.setIsUnsaved();}};var f=function(){var h=new sap.m.Label().addStyleClass("noConfigSelected");h.setText(S.oConfigListInstance.oCoreApi.getText("noConfigSelected"));h.placeAt(S.oConfigListInstance.byId("idConfigDetailData"));S.oConfigListInstance.toolbarController.disableCopyDeleteButton();S.oConfigListInstance._enableDisableExportAndExecuteButton();};var o;if(!a){n.throwMandatoryPopup(S.oConfigListInstance,{yes:function(){var h=S.oConfigListInstance.oTreeInstance.getAPFTreeNodeContext(S.oConfigListInstance.oTreeInstance.getSelection());var p=S.oConfigListInstance.oTreeInstance.getParentNodeContext(h);S.oConfigListInstance.bIsDifferntConfig=S.oConfigListInstance.oTreeInstance.isConfigurationSwitched(S.oConfigListInstance.oPreviousSelectedNode,S.oConfigListInstance.selectedNode);S.oConfigListInstance.configEditor=S.oConfigListInstance.configurationHandler.restoreMemorizedConfiguration(p.configId);if(S.oConfigListInstance.bIsSaved===false&&S.oConfigListInstance.configEditor){S.oConfigListInstance.configEditor.setIsUnsaved();}if(S.oConfigListInstance.bIsDifferntConfig===false){var s=(typeof S.oConfigListInstance.getView().byId("idConfigDetailData").getContent()[0].getController==="function")?S.oConfigListInstance.getView().byId("idConfigDetailData").getContent()[0].getController():undefined;var i=S.oConfigListInstance._isNewSubView(s.getView().getViewData().oParams);if(!i){d.call(S.oConfigListInstance);S.oConfigListInstance._navHandleExpandDelete.call(S.oConfigListInstance,S.oConfigListInstance.oSelectedNodeDetails,p);}else{S.oConfigListInstance.handleConfirmDeletion();}}else{var N=S.oConfigListInstance._navMandatoryResetState(S.oConfigListInstance);if(!N.isNewView){if(N.bIsSaved===false){o(S.oConfigListInstance);}else{d.call(S.oConfigListInstance);}}}}});b=true;}var g;if(s.getView().getViewData().oParams.name==="configuration"){g=true;}o=function(h){n.throwLossOfDataPopup(h,{yes:function(i){S.oConfigListInstance._navSaveState(function(){i(function(j){if(S.oConfigListInstance.selectedNode){var B=S.oConfigListInstance.selectedNode.getBindingContext().sPath;var C=B.split("/");var k=C[2];}S.oConfigListInstance.oModel.getData().aConfigDetails[k].AnalyticalConfiguration=S.oConfigListInstance.configId;S.oConfigListInstance.oModel.updateBindings();d.call(S.oConfigListInstance);});});},no:function(){var h={appId:S.oConfigListInstance.appId,configId:S.oConfigListInstance.configId};var s=(typeof S.oConfigListInstance.getView().byId("idConfigDetailData").getContent()[0].getController==="function")?S.oConfigListInstance.getView().byId("idConfigDetailData").getContent()[0].getController():undefined;var g=(s.getView().getViewData().oParams.name==="configuration")?true:false;if(S.oConfigListInstance.configId.indexOf(sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.ISNEWCONFIG)===0){S.oConfigListInstance._navHandleExpandDelete.call(S.oConfigListInstance,{},h,g);S.oConfigListInstance.clearTitleAndBreadCrumb();S.oConfigListInstance.byId("idConfigDetailData").removeAllContent();f();}else{S.oConfigListInstance._navConfigResetState(S.oConfigListInstance,function(){d.call(S.oConfigListInstance);});}}});};if(S.oConfigListInstance.bIsSaved===false&&a&&g){o(S.oConfigListInstance);b=true;}if(!b){d.call(S.oConfigListInstance);}},_handlePressDeleteButton:function(e){var d;var s=this.oConfigListInstance.oTreeInstance.getAPFTreeNodeContext(this.oConfigListInstance.oTreeInstance.getSelection());var n=this.oCoreApi.getText(s.nodeObjectType);e.getSource().$().blur();if(s.nodeObjectType===sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.STEP){d=this.oCoreApi.getText("confirmStepDeletion",[s.nodeTitle]);}else{d=this.oCoreApi.getText("confirmDeletion",[n,s.nodeTitle]);}this._openDeleteConfirmationDialog(d);},_openDeleteConfirmationDialog:function(d){var s=this;var c=jQuery.extend(s.oConfigListInstance,{closeDialog:s.closeDialog.bind(s)});if(!this.confirmationDialog){this.confirmationDialog=sap.ui.xmlfragment("idConfigConfirmationDialogFragment","sap.apf.modeler.ui.fragment.confirmationDialog",c);this.getView().addDependent(this.confirmationDialog);this._setConfirmationDialogText();}var a=new sap.m.Label();a.addStyleClass("dialogText");a.setText(d);this.confirmationDialog.removeAllContent();this.confirmationDialog.addContent(a);jQuery.sap.syncStyleClass("sapUiSizeCompact",this.getView(),this.confirmationDialog);this.confirmationDialog.open();},closeDialog:function(){if(this.confirmationDialog&&this.confirmationDialog.isOpen()){this.confirmationDialog.close();}},_setConfirmationDialogText:function(){sap.ui.core.Fragment.byId("idConfigConfirmationDialogFragment","idDeleteConfirmation").setTitle(this.oCoreApi.getText("confirmation"));sap.ui.core.Fragment.byId("idConfigConfirmationDialogFragment","idDeleteButton").setText(this.oCoreApi.getText("deleteButton"));sap.ui.core.Fragment.byId("idConfigConfirmationDialogFragment","idCancelButtonDialog").setText(this.oCoreApi.getText("cancel"));},_handlePressMoveUpButton:function(){this.bIsDown=false;var s=this.oConfigListInstance.oTreeInstance.getSelection();if(s!==null){var a=this.oConfigListInstance.oTreeInstance.getAPFTreeNodeContext(s);if(a!==undefined){this._moveUpOrDown(a,this.bIsDown);}}},_handlePressMoveDownButton:function(){this.bIsDown=true;var s=this.oConfigListInstance.oTreeInstance.getSelection();if(s!==null){var a=this.oConfigListInstance.oTreeInstance.getAPFTreeNodeContext(s);if(a!==undefined){this._moveUpOrDown(a,this.bIsDown);}}},_moveUpOrDown:function(s,i){var a=s.nodeObjectType;var b=s.nodeAPFId;var n=s.nodeContext;var c=n.split('/')[2];var o,d,t,T,l;var S=false;var e=n.split('/')[n.split('/').length-1];switch(a){case sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.FACETFILTER:o=this.oConfigListInstance.oModel.getData().aConfigDetails[c].configData[0].filters;l=o.length;if(i){if(parseInt(e,10)!==(l-1)){this.oConfigListInstance.configEditor.moveFacetFilterUpOrDown(b,1);d=parseInt(e,10)+1;S=true;}}else{if(parseInt(e,10)!==0){this.oConfigListInstance.configEditor.moveFacetFilterUpOrDown(b,-1);d=parseInt(e,10)-1;S=true;}}break;case sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.CATEGORY:o=this.oConfigListInstance.oModel.getData().aConfigDetails[c].configData[1].categories;l=o.length;if(i){if(parseInt(e,10)!==(l-1)){this.oConfigListInstance.configEditor.moveCategoryUpOrDown(b,1);d=parseInt(e,10)+1;S=true;}}else{if(parseInt(e,10)!==0){this.oConfigListInstance.configEditor.moveCategoryUpOrDown(b,-1);d=parseInt(e,10)-1;S=true;}}break;case sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.NAVIGATIONTARGET:o=this.oConfigListInstance.oModel.getData().aConfigDetails[c].configData[2].navTargets;l=o.length;if(i){if(parseInt(e,10)!==(l-1)){this.oConfigListInstance.configEditor.moveNavigationTargetUpOrDown(b,1);d=parseInt(e,10)+1;S=true;}}else{if(parseInt(e,10)!==0){this.oConfigListInstance.configEditor.moveNavigationTargetUpOrDown(b,-1);d=parseInt(e,10)-1;S=true;}}break;case sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.STEP:var f=n.split('/')[6];var g=this.oConfigListInstance.oModel.getData().aConfigDetails[c].configData[1].categories[f];o=g.steps;l=o.length;if(i){if(parseInt(e,10)!==(l-1)){this.oConfigListInstance.configEditor.moveCategoryStepAssignmentUpOrDown(g.id,b,1);d=parseInt(e,10)+1;S=true;}}else{if(parseInt(e,10)!==0){this.oConfigListInstance.configEditor.moveCategoryStepAssignmentUpOrDown(g.id,b,-1);d=parseInt(e,10)-1;S=true;}}break;case sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.REPRESENTATION:var h=this.oConfigListInstance.oTreeInstance.getSelection();var j=sap.ui.getCore().byId(h.getId());var k=j.getParent();var m=this.oConfigListInstance.oTreeInstance.getAPFTreeNodeContext(k).nodeAPFId;var p=this.oConfigListInstance.configEditor.getStep(m);f=n.split('/')[6];var q=n.split('/')[8];o=this.oConfigListInstance.oModel.getData().aConfigDetails[c].configData[1].categories[f].steps[q].representations;l=o.length;if(i){if(parseInt(e,10)!==(l-1)){p.moveRepresentationUpOrDown(b,1);d=parseInt(e,10)+1;S=true;}}else{if(parseInt(e,10)!==0){p.moveRepresentationUpOrDown(b,-1);d=parseInt(e,10)-1;S=true;}}break;default:break;}if(S){t=o[e];T=o[d];o[d]=t;o[e]=T;this.oConfigListInstance.oModel.updateBindings();this.oConfigListInstance.configEditor.setIsUnsaved();}},_handleAddExistingStepPress:function(){var s=this;var a=this.oConfigListInstance.oTreeInstance.getAPFTreeNodeContext(this.oConfigListInstance.oTreeInstance.getSelection());var c=this.oConfigListInstance.oTreeInstance.getParentNodeContext(a).categoryId;var S=this.oConfigListInstance.configEditor.getStepsNotAssignedToCategory(c);var b;var d=[];S.forEach(function(e){var o={};var f=s.oConfigListInstance.configEditor.getStep(e);b=s.oConfigListInstance.oTextPool.get(f.getTitleId()).TextElementDescription;o.id=e;o.name=b;d.push(o);});var m=new sap.ui.model.json.JSONModel({existingStepData:d});if(!this.addExistingStepDialog){this.addExistingStepDialog=sap.ui.xmlfragment("idExistingStepDialogFragment","sap.apf.modeler.ui.fragment.existingStepDialog",this);this._setExistingStepDialogText();}this.getView().addDependent(this.addExistingStepDialog);this.addExistingStepDialog.setModel(m);this.addExistingStepDialog.open();},_handleExistingStepDialogOK:function(e){var n=sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.STEP;var s=e.getParameters("listItem").selectedItems;var a=s.length;var b=this.oConfigListInstance.oTreeInstance.getAPFTreeNodeContext(this.oConfigListInstance.oTreeInstance.getSelection());var c=this.oConfigListInstance.oTreeInstance.getParentNodeContext(b).categoryId;var E=[];for(var i=0;i<a;i++){var p=e.getParameters("selectedItems").selectedContexts[i].sPath.split('/')[2];var o=e.getSource().getModel().getData().existingStepData[p];var d=this.oConfigListInstance.configEditor.getStep(o.id);this.oConfigListInstance.configEditor.addCategoryStepAssignment(c,o.id);var r=d.getRepresentations();var f=r.length;var R=[];for(var j=0;j<f;j++){var g={};g.id=r[j].getId();g.name=r[j].getRepresentationType();g.icon=this._getRepresentationIcon(g.name);R.push(g);}var S={};S.step=o;S.representations=R;S.noOfReps=f;E.push(S);}if(a!==0){var h={noOfSteps:a,aExistingStepsToBeAdded:E};this.oConfigListInstance.oTreeInstance.addNodeInTree(n,h);}},_getRepresentationIcon:function(r){var i;var R=this.oCoreApi.getRepresentationTypes();for(var a=0;a<R.length;a++){if(r===R[a].id){i=R[a].picture;break;}}return i;},_handleExistingStepDialogSearch:function(e){var v=e.getParameter("value");var f=new sap.ui.model.Filter("name",sap.ui.model.FilterOperator.Contains,v);var b=e.getSource().getBinding("items");b.filter([f]);},_handleExistingStepDialogClose:function(e){if(this.addExistingStepDialog){e.getSource().getBinding("items").filter([]);}}});
