/*!
 * SAP APF Analysis Path Framework
 *
 * (c) Copyright 2012-2014 SAP AG. All rights reserved
 */
jQuery.sap.require("sap.apf.modeler.ui.utils.nullObjectChecker");jQuery.sap.require("sap.apf.modeler.ui.utils.optionsValueModelBuilder");jQuery.sap.require("sap.apf.modeler.ui.utils.viewValidator");sap.ui.define(["sap/ui/core/mvc/Controller"],function(C){"use strict";var n=new sap.apf.modeler.ui.utils.NullObjectChecker();var o=new sap.apf.modeler.ui.utils.OptionsValueModelBuilder();function _(f){var t=new sap.apf.modeler.ui.utils.TextPoolHelper(f.getView().getViewData().oConfigurationHandler.getTextPool());var D={oConfigurationEditor:f.oConfigurationEditor,type:"service"};t.setAutoCompleteOn(f.byId("idSource"),D);}function a(f){var s=f.getSource();f.byId("idSource").setValue("");if(!n.checkIsNotNullOrUndefinedOrBlank(s)){f.addOrRemoveMandatoryFieldsAndRequiredFlag(false);return;}f.byId("idSource").setValue(s);f.addOrRemoveMandatoryFieldsAndRequiredFlag(true);}function b(f){var m,s,E,A;s=f.byId("idSource").getValue();f.byId("idEntity").setModel(null);f.byId("idEntity").clearSelection();if(!n.checkIsNotNullOrUndefinedOrBlank(s)){return;}if(!f.oConfigurationEditor.registerService(s)){return;}A=f.getAllEntities(s);m=o.convert(A);f.byId("idEntity").setModel(m);E=f.getEntity();if(!n.checkIsNotNullOrUndefinedOrBlank(E)||A.indexOf(E)===-1){if(n.checkIsNotNullOrUndefinedOrBlank(A)){E=f.getAllEntities(s)[0];}}f.byId("idEntity").setSelectedKey(E);}function c(f){var s,E,S,p,m,g;s=f.byId("idSource").getValue();f.byId("idSelectProperties").setModel(null);f.byId("idSelectProperties").setSelectedKeys([]);if(!n.checkIsNotNullOrUndefinedOrBlank(s)){return;}E=f.byId("idEntity").getSelectedKey();if(!n.checkIsNotNullOrUndefinedOrBlank(E)){return;}p=f.getAllEntitySetProperties(s,E);m=o.convert(p);f.byId("idSelectProperties").setModel(m);S=f.getSelectProperties();if(n.checkIsNotNullOrUndefinedOrBlank(S)){g=e(S,p);S=g;}f.byId("idSelectProperties").setSelectedKeys(S);}function d(f){f.byId("idSource").attachEvent("selectService",f.handleSelectionOfService.bind(f));}function e(E,t){var r=[];if(!n.checkIsNotNullOrUndefinedOrBlank(E)||!n.checkIsNotNullOrUndefinedOrBlank(t)){return r;}E.forEach(function(p){if(t.indexOf(p)!==-1){r.push(p);}});return r;}return C.extend("sap.apf.modeler.ui.controller.requestOptions",{viewValidator:{},oConfigurationEditor:{},oParentObject:{},onInit:function(){var f=this;f.viewValidator=new sap.apf.modeler.ui.utils.ViewValidator(f.getView());f.oConfigurationEditor=f.getView().getViewData().oConfigurationEditor;f.oParentObject=f.getView().getViewData().oParentObject;_(f);f.setDetailData();f.setDisplayText();d(f);},setDetailData:function(){var f=this;a(f);b(f);c(f);},updateSubViewInstancesOnReset:function(E){var f=this;f.oConfigurationEditor=E.mParameters[0];f.oParentObject=E.mParameters[1];f.setDetailData();},setDisplayText:function(){},handleChangeForSource:function(){var f=this,E,s;var S=f.byId("idSource").getValue().trim();if(n.checkIsNotNullOrUndefinedOrBlank(S)&&f.oConfigurationEditor.registerService(S)){f.addOrRemoveMandatoryFieldsAndRequiredFlag(true);f.updateSource(S);}else{f.clearSource();f.addOrRemoveMandatoryFieldsAndRequiredFlag(false);}b(f);E=f.byId("idEntity").getSelectedKey();f.updateEntity(E);c(f);s=f.byId("idSelectProperties").getSelectedKeys();f.updateSelectProperties(s);f.oConfigurationEditor.setIsUnsaved();f.fireRelevantEvents();},handleChangeForEntity:function(){var f=this,E,s;E=f.byId("idEntity").getSelectedKey();f.updateEntity(E);c(f);s=f.byId("idSelectProperties").getSelectedKeys();f.updateSelectProperties(s);f.oConfigurationEditor.setIsUnsaved();f.fireRelevantEvents();},handleChangeForSelectProperty:function(){var f=this;var s=f.byId("idSelectProperties").getSelectedKeys();f.updateSelectProperties(s);f.oConfigurationEditor.setIsUnsaved();f.fireRelevantEvents();},fireRelevantEvents:function(){},addOrRemoveMandatoryFieldsAndRequiredFlag:function(r){var f=this;f.byId("idEntityLabel").setRequired(r);f.byId("idSelectPropertiesLabel").setRequired(r);if(r){f.viewValidator.addFields(["idEntity","idSelectProperties"]);}else{f.viewValidator.removeFields(["idEntity","idSelectProperties"]);}},handleSelectionOfService:function(E){var s=E.getParameters()[0];E.getSource().setValue(s);E.getSource().fireEvent("change");},handleShowValueHelpRequest:function(E){var f=this;var v={oTextReader:f.getView().getViewData().oTextReader,parentControl:E.getSource(),getCalatogServiceUri:f.getView().getViewData().getCalatogServiceUri};sap.ui.view({id:f.createId("idCatalogServiceView"),viewName:"sap.apf.modeler.ui.view.catalogService",type:sap.ui.core.mvc.ViewType.XML,viewData:v});},getSource:function(){},getAllEntities:function(s){},getAllEntitySetProperties:function(s,E){},getEntity:function(){},clearSource:function(){},clearEntity:function(){},clearSelectProperties:function(){},updateSource:function(s){},updateEntity:function(E){},updateSelectProperties:function(s){},getSelectProperties:function(){}});});
