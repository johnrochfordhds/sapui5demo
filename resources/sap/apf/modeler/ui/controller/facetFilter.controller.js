/*!
 * SAP APF Analysis Path Framework
 *
 * (c) Copyright 2012-2014 SAP AG. All rights reserved
 */
jQuery.sap.require("sap.apf.modeler.ui.utils.textPoolHelper");jQuery.sap.require("sap.apf.modeler.ui.utils.nullObjectChecker");jQuery.sap.require("sap.apf.modeler.ui.utils.optionsValueModelBuilder");jQuery.sap.require("sap.apf.modeler.ui.utils.viewValidator");(function(){"use strict";var p,t,c,C,T,f,v;var n=new sap.apf.modeler.ui.utils.NullObjectChecker();var o=new sap.apf.modeler.ui.utils.OptionsValueModelBuilder();function _(i){var I=new sap.apf.modeler.ui.utils.TextPoolHelper(T);var J=sap.apf.modeler.ui.utils.TranslationFormatMap.FACETFILTER_LABEL;var K={oTranslationFormat:J,type:"text"};var L=i.byId("idLabel");I.setAutoCompleteOn(L,K);}function a(i){i.byId("idFacetFilterBasicData").setTitle(t("basicData"));i.byId("idFFLabel").setText(t("ffLabel"));i.byId("idLabel").setPlaceholder(t("New Filter"));i.byId("idFFPropertyLabel").setText(t("ffProperty"));i.byId("idDoNotShowAtRuntimeLabel").setText(t("doNotShowAtRuntime"));i.byId("idSelectionModeLabel").setText(t("ffSelectionMode"));i.byId("idValueHelpLabel").setText(t("valueHelpMode"));i.byId("idVHNone").setText(t("none"));i.byId("idValueHelpRequest").setText(t("valueHelpRequest"));i.byId("idConfigListOfValues").setText(t("configListOfValues"));i.byId("idConfigListOfValuesLabel").setText(t("configListOfValuesLabel"));i.byId("idSingleSelectionMode").setText(t("singleSelection"));i.byId("idMultiSelectionMode").setText(t("multipleSelection"));i.byId("idDefaultValuesTitle").setTitle(t("vhDefaultValues"));i.byId("idPreselectionModeLabel").setText(t("vhDefaultValueMode"));i.byId("idAutomaticSelection").setText(t("automaticValue"));i.byId("idFixedValue").setText(t("fixedValues"));i.byId("idFunction").setText(t("function"));i.byId("idPreselectionDefaultsLabel").setText(t("vhDefaultValues"));i.byId("idPreselectionFunctionLabel").setText(t("function"));i.byId("idValueHelpTitle").setTitle(t("valueHelp"));i.byId("idFFAliasLabel").setText(t("ffAlias"));i.byId("idFilterResolutionTitle").setTitle(t("filterResolution"));i.byId("idUseVHRAsFRRCheckBoxLabel").setText(t("vhCheckBoxLabel"));}function b(i,I){var J={id:f.getId(),icon:"sap-icon://filter"};if(I){delete J.icon;J.name=I;}i.getView().getViewData().updateSelectedNode(J);}function d(i,I){var J=t("facetFilter")+": "+I;i.getView().getViewData().updateTitleAndBreadCrumb(J);}function e(i){var I;if(p&&p.arguments&&p.arguments.facetFilterId){f=C.getFacetFilter(p.arguments.facetFilterId);}if(!n.checkIsNotUndefined(f)){I=C.createFacetFilter();f=C.getFacetFilter(I);b(i);}}function g(i){var I,J,V,K;var L={oTextReader:t,oConfigurationHandler:c,oConfigurationEditor:C,oParentObject:f,getCalatogServiceUri:i.getView().getViewData().getCalatogServiceUri};I=new sap.ui.controller("sap.apf.modeler.ui.controller.facetFilterVHR");V=new sap.ui.view({viewName:"sap.apf.modeler.ui.view.requestOptions",type:sap.ui.core.mvc.ViewType.XML,id:i.createId("idVHRView"),viewData:L,controller:I});J=new sap.ui.controller("sap.apf.modeler.ui.controller.facetFilterFRR");K=new sap.ui.view({viewName:"sap.apf.modeler.ui.view.requestOptions",type:sap.ui.core.mvc.ViewType.XML,id:i.createId("idFRRView"),viewData:L,controller:J});i.getView().attachEvent("useSameAsVHREvent",K.getController().handleCopy.bind(K.getController()));i.getView().attachEvent("enableDisableFRRFieldsEvent",K.getController().enableOrDisableView.bind(K.getController()));V.attachEvent("useSameAsVHREvent",K.getController().handleCopy.bind(K.getController()));i.getView().attachEvent("updateSubViewInstancesOnResetEvent",V.getController().updateSubViewInstancesOnReset.bind(V.getController()));i.getView().attachEvent("updateSubViewInstancesOnResetEvent",K.getController().updateSubViewInstancesOnReset.bind(K.getController()));i.getView().attachEvent("doNotShowAtRuntimeEvent",V.getController().clearVHRFields.bind(V.getController()));i.getView().attachEvent("clearVHRFieldsIfValueListEvent",V.getController().clearVHRFields.bind(V.getController()));i.getView().attachEvent("doNotShowAtRuntimeEvent",K.getController().clearFRRFields.bind(K.getController()));V.addStyleClass("formTopPadding");V.addStyleClass("formBottomPadding");K.addStyleClass("formTopPadding");}function h(i,V){i.byId("idSelectionMode").setVisible(V);i.byId("idSelectionModeLabel").setVisible(V);i.byId("idSelectionModeRadioGroup").setSelectedButton(i.byId("idMultiSelectionMode"));i.byId("idValueHelp").setVisible(V);i.byId("idValueHelpLabel").setVisible(V);i.byId("idValueHelpRadioGroup").setSelectedButton(i.byId("idVHNone"));i.byId("idValueHelpTitle").setVisible(V);i.byId("idFFForm1").setVisible(V);if(V){i.byId("idFRRVBox").insertItem(i.byId("idFRRView"));i.byId("idDoNotShowAtRuntimeCheckBox").setSelected(false);}else{A(i,V);z(i,V);i.byId("idFRRVBox").removeItem(i.byId("idFRRView"));i.byId("idUseVHRAsFRRCheckBox").setSelected(V);}}function j(i){if(!f.isVisible()){i.byId("idDoNotShowAtRuntimeCheckBox").setSelected(true);}h(i,f.isVisible());}function k(i){var M=o.convert(C.getAllKnownProperties());i.byId("idFFProperty").setModel(M);if(n.checkIsNotNullOrUndefinedOrBlank(f.getProperty())){i.byId("idFFProperty").setValue(f.getProperty());}}function l(i){if(!n.checkIsNotNullOrUndefinedOrBlank(C.getFacetFilter(p.arguments.facetFilterId))){return;}if(n.checkIsNotNullOrUndefinedOrBlank(f.getLabelKey())&&T.get(f.getLabelKey())){i.byId("idLabel").setValue(T.get(f.getLabelKey()).TextElementDescription);}else{i.byId("idLabel").setValue(f.getId());}}function m(i){var M=o.convert(C.getAllKnownProperties());i.byId("idFFAlias").setModel(M);if(n.checkIsNotNullOrUndefinedOrBlank(f.getAlias())){i.byId("idFFAlias").setValue(f.getAlias());}}function q(i){if(!n.checkIsNotNullOrUndefinedOrBlank(C.getFacetFilter(p.arguments.facetFilterId))){f.setMultiSelection(true);}if(f.isMultiSelection()){i.byId("idSelectionModeRadioGroup").setSelectedButton(i.byId("idMultiSelectionMode"));}else{i.byId("idSelectionModeRadioGroup").setSelectedButton(i.byId("idSingleSelectionMode"));}}function r(i){i.byId("idPreselectionFunction").setValue("");if(n.checkIsNotNullOrUndefinedOrBlank(f.getPreselectionFunction())){i.byId("idPreselectionFunction").setValue(f.getPreselectionFunction());}}function s(i){var I=false,J=false;if(f.getAutomaticSelection()){i.byId("idPreselectionModeRadioGroup").setSelectedButton(i.byId("idAutomaticSelection"));}else{if(n.checkIsNotNullOrUndefinedOrBlank(f.getPreselectionFunction())){i.byId("idPreselectionModeRadioGroup").setSelectedButton(i.byId("idFunction"));r(i);I=true;}else{i.byId("idPreselectionModeRadioGroup").setSelectedButton(i.byId("idFixedValue"));x(i);J=true;}}u(i,I);w(i,J);}function u(i,V){i.byId("idPreselectionFunctionLabel").setVisible(V);i.byId("idPreselectionFunction").setVisible(V);if(V){v.addField("idPreselectionFunction");}else{i.byId("idPreselectionFunction").setValue("");v.removeField("idPreselectionFunction");}}function w(i,V){i.byId("idPreselectionDefaultsLabel").setVisible(V);i.byId("idPreselectionDefaults").setVisible(V);if(V){v.addField("idPreselectionDefaults");}else{v.removeField("idPreselectionDefaults");}}function x(i){i.byId("idPreselectionDefaults").setTokens([]);var I=f.getPreselectionDefaults();if(n.checkIsNotNullOrUndefinedOrBlank(I)){I.forEach(function(J){i.byId("idPreselectionDefaults").addToken(new sap.m.Token({text:J}));});}}function y(i){i.byId("idConfigListOfValuesMultiInput").setTokens([]);var I=f.getValueList();if(n.checkIsNotNullOrUndefinedOrBlank(I)){I.forEach(function(J){i.byId("idConfigListOfValuesMultiInput").addToken(new sap.m.Token({text:J}));});}}function z(i,I){i.byId("idConfigListOfValuesLabel").setVisible(I);i.byId("idConfigListOfValuesMultiInput").setVisible(I);if(I){v.addField("idConfigListOfValuesMultiInput");}else{v.removeField("idConfigListOfValuesMultiInput");}}function A(i,I){i.byId("idFFAliasLabel").setVisible(I);i.byId("idFFAlias").setVisible(I);if(I){i.byId("idVHRVBox").insertItem(i.byId("idVHRView"));}else{i.getView().fireEvent("clearVHRFieldsIfValueListEvent");i.byId("idFFAlias").setValue("");i.byId("idVHRVBox").removeItem(i.byId("idVHRView"));}}function B(i){if(f.getUseSameRequestForValueHelpAndFilterResolution()){i.byId("idUseVHRAsFRRCheckBox").setSelected(true);i.getView().fireEvent("enableDisableFRRFieldsEvent");}}function D(i){var I=false,J=false;if(n.checkIsNotNullOrUndefinedOrBlank(f.getServiceOfValueHelp())){I=true;E(i,true);i.byId("idValueHelpRadioGroup").setSelectedButton(i.byId("idValueHelpRequest"));}else if(n.checkIsNotNullOrUndefinedOrBlank(f.getValueList())){y(i);J=true;i.byId("idValueHelpRadioGroup").setSelectedButton(i.byId("idConfigListOfValues"));}else{i.byId("idValueHelpRadioGroup").setSelectedButton(i.byId("idVHNone"));}A(i,I);z(i,J);}function E(i,I){i.byId("idUseVHRAsFRRCheckBox").setVisible(I);i.byId("idUseVHRAsFRRCheckBoxLabel").setVisible(I);}function F(i,I){I.byId("idPreselectionDefaults").setValueState(sap.ui.core.ValueState.Warning);I.byId("idPreselectionDefaults").setValueStateText(t(i));I.byId('idPreselectionDefaults').focus();}function G(i,M){var P=new sap.m.Token({text:i});M.addToken(P);C.setIsUnsaved();}function H(M,i){if(M.mEventRegistry.tokenChange===undefined){M.attachTokenChange(i);}}sap.ui.controller("sap.apf.modeler.ui.controller.facetFilter",{onInit:function(){var i=this;var V=i.getView().getViewData();t=V.getText;p=V.oParams;c=V.oConfigurationHandler;T=c.getTextPool();C=V.oConfigurationEditor;if(!C){c.loadConfiguration(p.arguments.configId,function(I){C=I;});}v=new sap.apf.modeler.ui.utils.ViewValidator(i.getView());a(i);_(i);e(i);g(i);i.setDetailData();v.addFields(["idFFProperty","idLabel"]);},onAfterRendering:function(){var i=this;H(i.byId("idConfigListOfValuesMultiInput"),i.handleTokenChangeForConfigListOfValues.bind(i));H(i.byId("idPreselectionDefaults"),i.handleTokenChangeForPreselectionDefaults.bind(i));},setDetailData:function(){var i=this;j(i);k(i);l(i);m(i);q(i);s(i);D(i);B(i);},updateSubViewInstancesOnReset:function(i){var I=this;C=i;f=C.getFacetFilter(f.getId());I.getView().fireEvent("updateSubViewInstancesOnResetEvent",[C,f]);},handleChangeForVisibilityAtRuntime:function(){var i=this,V=true;if(i.byId("idDoNotShowAtRuntimeCheckBox").getSelected()){V=false;f.setInvisible();f.setUseSameRequestForValueHelpAndFilterResolution(false);i.getView().fireEvent("enableDisableFRRFieldsEvent");i.getView().fireEvent("doNotShowAtRuntimeEvent");f.setValueList([]);y(i);}else{f.setVisible();}f.setMultiSelection(true);C.setIsUnsaved();h(i,V);},handleChangeForProperty:function(){var i=this;var I=i.byId("idFFProperty").getValue().trim();if(n.checkIsNotNullOrUndefinedOrBlank(I)){f.setProperty(I);}C.setIsUnsaved();},handleChangeForLabel:function(){var i=this;var I;var J=i.byId("idLabel").getValue().trim();var K=sap.apf.modeler.ui.utils.TranslationFormatMap.FACETFILTER_LABEL;if(n.checkIsNotNullOrUndefinedOrBlank(J)){I=T.setText(J,K);f.setLabelKey(I);b(i,J);d(i,J);}C.setIsUnsaved();},handleChangeForAlias:function(){var i=this;var I=i.byId("idFFAlias").getValue().trim();f.setAlias(undefined);if(n.checkIsNotNullOrUndefinedOrBlank(I)){f.setAlias(I);}C.setIsUnsaved();},handleChangeForSelectionMode:function(){var i=this,P,I;var S=i.byId("idSelectionModeRadioGroup").getSelectedButton();if(S===i.byId("idSingleSelectionMode")){f.setMultiSelection(false);if(i.byId("idPreselectionDefaultsLabel").getVisible()){P=f.getPreselectionDefaults();if(P&&P.length>1){f.setPreselectionDefaults([P[0]]);I=new sap.m.Token({text:P[0]});i.byId("idPreselectionDefaults").setTokens([I]);F("singleToMultipleSelectionWarningMessage",i);}}}else{i.byId("idPreselectionDefaults").setValueState(sap.ui.core.ValueState.None);f.setMultiSelection(true);}C.setIsUnsaved();},handleChangeForPreselectionMode:function(){var i=this,I=false,P=false,J=false;switch(i.byId("idPreselectionModeRadioGroup").getSelectedButton()){case i.byId("idFunction"):P=true;f.removePreselectionDefaults();break;case i.byId("idFixedValue"):J=true;f.removePreselectionFunction();break;default:I=true;}f.setAutomaticSelection(I);x(i);r(i);w(i,J);u(i,P);C.setIsUnsaved();},handleChangeForPreselectionDefaults:function(i){var I=this;I.byId("idPreselectionDefaults").setValue("");I.byId("idPreselectionDefaults").setValueState(sap.ui.core.ValueState.None);if(!f.isMultiSelection()){if(I.byId("idPreselectionDefaults").getTokens().length<1){I.byId("idPreselectionDefaults").setValueState(sap.ui.core.ValueState.None);G(i.getParameter("value"),I.byId("idPreselectionDefaults"));}else{F("singleSelectionWarningMessage",I);}}else{G(i.getParameter("value"),I.byId("idPreselectionDefaults"));}},handleTokenChangeForPreselectionDefaults:function(I){var J=this;var i,K=[];var L=J.byId("idPreselectionDefaults").getTokens();J.byId("idPreselectionDefaults").setValueState(sap.ui.core.ValueState.None);if(I.getParameters().type==="removed"||I.getParameters().type==="added"){for(i=0;i<L.length;i++){K[i]=L[i].getText();}if(f.isMultiSelection()){f.setPreselectionDefaults(K);}else{f.setPreselectionDefaults([K[0]]);}if(I.getParameters().type==="removed"){C.setIsUnsaved();}}},handleChangeForPreselectionFunction:function(){var i=this;var P=i.byId("idPreselectionFunction").getValue().trim();f.removePreselectionFunction();if(n.checkIsNotNullOrUndefinedOrBlank(P)){f.setPreselectionFunction(P);}C.setIsUnsaved();},handleChangeForUseVHRAsFRRCheckBox:function(){var i=this;if(i.byId("idUseVHRAsFRRCheckBox").getSelected()){f.setUseSameRequestForValueHelpAndFilterResolution(true);}else{f.setUseSameRequestForValueHelpAndFilterResolution(false);}i.getView().fireEvent("enableDisableFRRFieldsEvent");i.getView().fireEvent("useSameAsVHREvent");C.setIsUnsaved();},handleChangeForValueHelpOption:function(){var i=this,V=false,I=false;switch(i.byId("idValueHelpRadioGroup").getSelectedButton()){case i.byId("idValueHelpRequest"):V=true;f.setValueList([]);break;case i.byId("idConfigListOfValues"):I=true;f.setAlias(undefined);break;default:f.setAlias(undefined);f.setValueList([]);}if(f.getUseSameRequestForValueHelpAndFilterResolution()===true){f.setUseSameRequestForValueHelpAndFilterResolution(false);i.byId("idUseVHRAsFRRCheckBox").setSelected(false);}i.getView().fireEvent("enableDisableFRRFieldsEvent");E(i,V);y(i);A(i,V);z(i,I);C.setIsUnsaved();},handleChangeForConfigListOfValues:function(i){var I=this;I.byId("idConfigListOfValuesMultiInput").setValue("");G(i.getParameter("value"),I.byId("idConfigListOfValuesMultiInput"));},handleTokenChangeForConfigListOfValues:function(I){var J=this;var i,K=[];var L=J.byId("idConfigListOfValuesMultiInput").getTokens();if(I.getParameters().type==="removed"||I.getParameters().type==="added"){for(i=0;i<L.length;i++){K[i]=L[i].getText();}f.setValueList(K);if(I.getParameters().type==="removed"){C.setIsUnsaved();}}},getValidationState:function(){var i=this;return v.getValidationState()&&i.byId("idVHRView").getController().getValidationState()&&i.byId("idFRRView").getController().getValidationState();},onExit:function(){var i=this;i.byId("idVHRView").destroy();i.byId("idFRRView").destroy();}});}());
